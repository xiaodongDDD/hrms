function jsonFormat(e){var t=angular.toJson(e,!0);return t}function getCurrentDate(e){var t=e.getFullYear(),o=e.getMonth()+1,a=e.getDate();o=10>o?"0"+o:o,a=10>a?"0"+a:a;var n=t.toString()+o.toString()+a.toString();return n}function getLastMonthDate(e){var t=e.getFullYear(),o=e.getMonth(),a=new Date(t,o,1),n=new Date(a.getTime()-864e5).getDate();o=10>o?"0"+o:o,n=10>n?"0"+n:n;var l=t.toString()+o.toString()+n.toString();return l}function getCurrentMonthLastDate(e){var t=e.getFullYear(),o=e.getMonth()+1,a=new Date(t,o,1),n=new Date(a.getTime()-864e5).getDate();o=10>o?"0"+o:o,n=10>n?"0"+n:n;var l=t.toString()+o.toString()+n.toString();return l}function getMonthDay(e){var t=e.substring(4,6)+"月"+e.substring(6,8)+"日";return t}function unique_normal(e){for(var t=[],o=0;o<e.length;o++){var a=e[o];-1===t.indexOf(a)&&t.push(a)}return t}function unique(e){for(var t=[],o=0;o<e.length;o++){var a=e[o];-1===indexOf(t,a)&&t.push(a)}return t}function unique_better(e,t){for(var o=[],a={},n=0;n<e.length;n++){if("object"==typeof e[n])var l=e[n][t];else var l=e[n];var i=e[n],r=typeof l+l;1!==a[r]&&(o.push(i),a[r]=1)}return o}angular.module("baseConfig",[]).constant("baseConfig",{debug:!0,isMobilePlatform:!1,clearTable:!0,nativeScreenFlag:!1,basePath:"http://wechat.hand-china.com/hmbms_hand/api",businessPath:"http://wechat.hand-china.com/hmbms_hand/api/dataEngine",currentVersion:"2.0.0",url:"",pkgIdentifier:"",versionName:"此版本为dev测试环境 2.0.0",appEnvironment:"UAT"});var utilModule=angular.module("utilModule",[]),HmsModule=angular.module("HmsModule",[]),loginModule=angular.module("loginModule",[]),messageModule=angular.module("messageModule",[]),contactModule=angular.module("contactModule",[]),applicationModule=angular.module("applicationModule",[]),myInfoModule=angular.module("myInfoModule",[]),tsApproveModule=angular.module("tsApproveModule",[]);HmsModule.directive("hideTabs",function(e){return{restrict:"A",link:function(t,o,a){t.$on("$ionicView.beforeEnter",function(){t.$watch(a.hideTabs,function(t){console.log("$ionicView.beforeEnter value "+t),t?e.hideTabs=!1:e.hideTabs=!0})}),t.$on("$ionicView.beforeLeave",function(){e.hideTabs=!0,console.log("$ionicView.beforeLeave value ")})}}}),HmsModule.directive("footerSelect",function(){return{restrict:"E",scope:{selectAllItem:"&",passThrough:"&",refuse:"&"},template:'<ion-footer-bar class="foot-bar"><div class="row buttons"><button class="button button-clear ts-button-left" ng-click="selectAllItem()">全选</button><button class="button button-clear ts-button-center" ng-click="passThrough()">通过</button><button class="button button-clear ts-button-right" ng-click="refuse()">拒绝</button></div></ion-footer-bar>',replace:!0,transclude:!1,controller:["$scope",function(e){}],link:function(e,t,o,a){}}}),HmsModule.directive("customHeadBar",function(){return{restrict:"E",scope:{actionName:"@",customTitle:"@",goBackPage:"&",doAction:"&"},template:'<div class="custom-head custom-head-background"><div class="row custom-first-head"><button class="button button-clear back-button" ng-click="goBackPage()"><i class="ion-ios-arrow-back"></i><span class="back-text">返回</span></button><button class="button button-clear action-button" ng-click="doAction()" ng-bind="actionName"></button></div><div class="ts-list-title" ng-bind="customTitle"></div><div class="custom-second-head" ng-transclude></div></div>',replace:!0,transclude:!0,controller:["$scope",function(e){}],link:function(e,t,o,a){}}}),HmsModule.directive("hmsWorkflowList",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{title:"=workflowTitle",icon:"=workflowIcon",type:"=workflowType",typeValue:"=workflowTypeValue",node:"=workflowNode",nodeValue:"=workflowNodeValue",submit:"=workflowSubmit",submitPerson:"=workflowSubmitPerson"},template:'<a class="workflow-list"><div class="workflow-list-logo"><img src="{{icon}}"/></div><div class="workflow-list-header">{{title}}</div><div class="workflow-list-content"><div class="row no-padding"><div class="col col-90 no-padding"><div class="row no-padding"> <div class="col col-33 no-padding color-type">{{type}}</div><div class="col col-67 no-padding color-content">{{typeValue}}</div></div><div class="row no-padding"><div class="col col-33 no-padding color-type">{{node}}</div><div class="col col-67 no-padding color-content">{{nodeValue}}</div></div><div class="row no-padding"><div class="col col-33 no-padding color-type">{{submit}}</div><div class="col col-67 no-padding color-content">{{submitPerson}}</div></div></div><div class="col col-10 no-padding col-center workflow-list-select"><img src="build/img/workflow/select@3x.png"/></div></div></div></a>',controller:["$scope",function(e){}],link:function(e,t,o){}}}),angular.module("HmsModule").directive("hmsslidecalendar",["$animate","$timeout","$compile","$ionicHistory","$ionicScrollDelegate",function(e,t,o,a,n){return{restrict:"E",replace:!0,transclude:!0,scope:{autoPlay:"=",doesContinue:"@",slideInterval:"@",showPager:"@",pagerClick:"&",disableScroll:"@",onSlideChanged:"&",activeSlide:"=?",bounce:"@"},controller:["$scope","$element","$attrs",function(e,o,a){function n(e){return"undefined"!=typeof e}console.log("$element[0] "+angular.toJson(o[0]));var l=e.$eval(e.doesContinue)===!0,i=e.$eval(e.bounce)!==!1,r=n(a.autoPlay)?!!e.autoPlay:!1,s=r?e.$eval(e.slideInterval)||4e3:0;console.log("continuous "+l),console.log("bouncing "+i),console.log("shouldAutoPlay "+r),console.log("slideInterval "+s);var c=new ionic.views.calendar({el:o[0],auto:s,continuous:l,startSlide:e.activeSlide,bouncing:i,slidesChanged:function(){e.currentSlide=c.currentIndex(),t(function(){})},callback:function(o){e.currentSlide=o,e.onSlideChanged({index:e.currentSlide,$index:e.currentSlide}),e.$parent.$broadcast("slideBox.slideChanged",o),e.activeSlide=o,t(function(){})},onDrag:function(){console.log("slider.onDrag "),freezeAllScrolls(!0)},onDragEnd:function(){console.log("slider.onDragEnd "),freezeAllScrolls(!1)}});e.$watch("activeSlide",function(e){console.log("slider.scope.activeSlide "),n(e)&&c.slide(e)}),e.$on("slideBox.nextSlide",function(){console.log("slider.slideBox.nextSlide "),c.next()}),e.$on("slideBox.prevSlide",function(){console.log("slider.slideBox.prevSlide "),c.prev()}),e.$on("slideBox.setSlide",function(e,t){console.log("slider.slideBox.setSlide "),c.slide(t)}),this.__slider=c,e.$on("$destroy",function(){console.log("$destroy ")}),t(function(){})}],template:'<div class="slider"><div class="slider-slides" ng-transclude></div></div>',link:function(t,o,a){e.enabled(o,!1)}}}]),angular.module("utilModule").factory("httpRequestHeader",function(){var e={request:function(e){if(window.localStorage.token&&window.localStorage.empno){var t=(new Date).getTime(),o=CryptoJS.MD5(window.localStorage.token+t);e.headers.timestamp=t,e.headers.token=o,e.headers.loginName=window.localStorage.empno}return e}};return e}),HmsModule.filter("weekDay",function(){return function(e){if(""==e)return e;var t=new Date(e),o=t.getDay();switch(o){case 0:e+="　星期天";break;case 1:e+="　星期一";break;case 2:e+="　星期二";break;case 3:e+="　星期三";break;case 4:e+="　星期四";break;case 5:e+="　星期五";break;case 6:e+="　星期六"}return e}});var log=console.log.bind(console),warn=console.warn.bind(console),error=console.error.bind(console),indexOf=[].indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var o=0;o<e.length;o++)if(e[o]===t)return o;return-1};angular.module("HmsModule").factory("hmsHttp",["$log","$http","hmsPopup",function(e,t,o){var a="HmsHttp",n="isSucessfull",l=a+".noAuthorPost",i=a+".post",r=a+".get",s=function(e){Prompter.hideLoading(),e.go("login")},c={goBackLogin:function(e){s(e)},isSuccessfull:function(t){return e.debug(n+" Start!"),e.debug(l+" status "+t),"S"==t||"SW"==t},post:function(o,a){e.debug(i+" Start!"),e.debug(i+" url "+o),e.debug(i+" paramter "+angular.toJson(a));var n=t.post(o,a).success(function(t){e.debug(i+" success"),e.debug(i+" End!")}).error(function(t,o){e.debug(i+" error"),e.debug(i+" response "+t),e.debug(i+" status "+o),e.debug(i+" End!")});return n},get:function(o){e.debug(r+" Start!"),e.debug(r+" url "+o);var a=t.get(o).success(function(t){e.debug(r+" success"),e.debug(r+" response "+angular.toJson(t)),e.debug(r+" End!")}).error(function(t,o){e.debug(r+" error"),e.debug(r+" response "+t),e.debug(r+" status "+o),e.debug(r+" End!")});return a}};return c}]).service("hmsPopup",["$ionicLoading","$cordovaToast","$ionicPopup","baseConfig",function(e,t,o,a){this.showLoading=function(t){e.show({template:'<ion-spinner icon="ios" class="spinner spinner-ios spinner-stable"></ion-spinner><div style="color: white;font-size: 12px;text-align: center;height:25px;line-height: 25px;">'+t+"</div>"})},this.hideLoading=function(){e.hide()},this.showShortCenterToast=function(o){a.nativeScreenFlag?t.showLongBottom(angular.isDefined(o)?o:"操作失败").then(function(e){},function(e){}):e.show({template:angular.isDefined(o)?o:"操作失败",animation:"fade-in",showBackdrop:!1,maxWidth:200,duration:2e3})},this.showPopup=function(e,t){if(a.nativeScreenFlag){var n=function(){};navigator.notification.alert(e,n,"提示","确定")}else o.show({title:"提示",template:e,buttons:[{text:"确定",type:"button button-cux-popup-confirm"}]})},this.prompt=function(e,t,n,l){if(a.nativeScreenFlag)navigator.notification.prompt(t,l,"填写信息",["确定","退出"],"");else{var i=o.show({template:'<input type="type" ng-model="myScope.data.city">',title:t,subTitle:t,scope:e,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(t){return e.myScope.data.city?e.myScope.data.city:void t.preventDefault()}}]});i.then(n)}},this.confirm=function(e,t,n){if(a.nativeScreenFlag)navigator.notification.confirm(e,n,t,["确定","取消"]);else{var l=o.confirm({title:angular.isDefined(t)?t:"提示",template:e,cancelText:"取消",cancelType:"button-cux-popup-cancel",okText:"确定",okType:"button-cux-popup-confirm"});l.then(n)}}}]).factory("hmsReturnView",["$ionicHistory","baseConfig",function(e,t){var o=(window.screen.width-50,{width:""});return{go:function(t){var o=e.currentHistoryId(),a=e.viewHistory().histories[o],n=a.stack.length-1-t;e.backView(a.stack[n]),e.goBack()},returnToState:function(o){var a=e.currentHistoryId(),n=e.viewHistory().histories[a];t.debug&&console.log("history.stack.length : "+n.stack.length);for(var l=n.stack.length-1;l>=0;l--)t.debug&&console.log("history.stack[i].stateName : "+n.stack[l].stateName),n.stack[l].stateName==o&&(e.backView(n.stack[l]),e.goBack())},getStackList:function(e,o){var a=[],n=e.currentHistoryId(),l=e.viewHistory().histories[n];t.debug&&console.log(e.viewHistory());for(var i="#F99D32",r=0;r<l.stack.length;r++){r==l.stack.length-1&&(i="black");var s={viewId:l.stack[r].viewId,stateName:l.stack[r].stateName,title:l.stack[r].title,color:{color:i}};t.debug&&console.log(l.stack[r]),a.push(s)}return a[a.length-1].title=o,a},getWidth:function(){return o}}}]).factory("hmsBackLine",["$ionicHistory","baseConfig",function(e){var t,o=window.screen.width-50,a={width:""},n=0,l=[];return{getViews:function(e){t=e.toString().length,ROOTCONFIG.debug&&console.log(t);for(var i=0;i<l.length;i++)if(e==l[i].name){l=l.slice(0,i+1),n=0;for(var r=0;r<l.length;r++)n=r==l.length-1?n+14*l[r].name.toString().length+8:n+14*l[r].name.toString().length+18+8;console.log(n),o>n?a.width="":a.width=n+"px";for(var s=0;s<l.length-1;s++)l[s].myStyle.color="#F99D32";return console.log(l),l[l.length-1].myStyle.color="black",l}var c={name:e,myStyle:{color:""}};l.push(c),n=0;for(var p=0;i<l.length;p++)n=p==l.length-1?n+14*l[p].name.toString().length+8:n+14*l[p].name.toString().length+18+8;n>o&&(a.width=n+"px");for(var d=0;d<l.length-1;i++)l[d].myStyle.color="#F99D32";return l},getWidth:function(){return a}}}]).factory("$hmsHelp",["$ionicTemplateLoader","$ionicBackdrop","$q","$timeout","$rootScope","$ionicBody","$compile","$ionicPlatform","$ionicModal","IONIC_BACK_PRIORITY",function(e,t,o,a,n,l,i,r,s,c){function p(e,t){t?e.$$hashKey=t:delete e.$$hashKey}function d(e,t){var o=e.$$hashKey;baseConfig.debug&&console.log(arguments);for(var a=1,n=arguments.length;n>a;a++){var l=arguments[a];if(l)for(var i=Object.keys(l),r=0,s=i.length;s>r;r++){var c=i[r];e[c]=l[c]}}return p(e,o),e}function u(){var e={};return e.scope=n.$new(),e.element=angular.element(h),e.responseDeferred=o.defer(),l.get().appendChild(e.element[0]),baseConfig.debug&&debug(e.element),i(e.element)(e.scope),d(e.scope,{title:"",$buttonTapped:function(){baseConfig.debug&&debug("$buttonTapped"),e.responseDeferred.resolve(1)}}),e.show=function(){e.isShown||e.removed||(s.stack.add(e),e.isShown=!0,ionic.requestAnimationFrame(function(){e.isShown&&f(e.element)}))},e.hide=function(t){return baseConfig.debug&&console.log("4 self.hide "+t),t=t||function(){},e.isShown?(s.stack.remove(e),e.isShown=!1,void a(t,250,!1)):t()},e.remove=function(){baseConfig.debug&&console.log("5 self.remove "),!e.removed&&s.stack.isHighest(e)&&(e.hide(function(){e.element.remove(),e.scope.$destroy()}),e.removed=!0)},e}function g(){var e=b[b.length-1];e&&e.responseDeferred.resolve()}function m(){function e(){b.push(t),baseConfig.debug&&console.log("popupStack.push(popup)"),a(t.show,o,!1),t.responseDeferred.promise.then(function(e){var o=b.indexOf(t);return-1!==o&&b.splice(o,1),baseConfig.debug&&console.log("popupStack.length"),b.length>0?b[b.length-1].show():(a(function(){!b.length},400,!1),(_._backButtonActionDone||function(){})()),t.remove(),e})}var t=$HmsHelp._createPopup(),o=0;return b.length>0?(b[b.length-1].hide(),o=y.stackPushDelay):_._backButtonActionDone=r.registerBackButtonAction(g,c.popup),t.responseDeferred.promise.close=function(e){t.removed||t.responseDeferred.resolve(e)},t.responseDeferred.notify({close:t.responseDeferred.close}),e(),t.responseDeferred.promise}function f(e){var t=e[0].querySelector("[autofocus]");t&&t.focus()}var h,y={stackPushDelay:75};h=ionic.Platform.isIOS()?'<div style="position: absolute;top:2px;left: -4px;bottom: 0;right: 0;background: url(img/mainHide.png); background-size: cover;;z-index: 12;"><div style="height: 100%;width: 100%;background: none" ng-click="$buttonTapped()"></div></div>':'<div style="position: absolute;top: -14px;left: -4px;bottom: 0;right: 0;background: url(img/mainHide.png); background-size: cover;;z-index: 12;"><div style="height: 100%;width: 100%;background: none" ng-click="$buttonTapped()"></div></div>';var b=[],_={showPopup:m,_createPopup:u,_popupStack:b};return _}]).factory("hmsFastPath",function(){var e={configFastPath:function(e,t,o){e.screenWidth={width:window.screen.width-50+"px"},e.scrollWidth=t.getWidth();var a=document.getElementsByTagName("ion-view"),n=a[a.length-1].attributes[0].value;e.currentStackList=t.getStackList(o,n),e.goStack=function(e){t.returnToState(e.stateName)}}};return e}),angular.module("myApp",["ionic","ngCordova","loginModule","baseConfig","messageModule","contactModule","applicationModule","myInfoModule","utilModule","tsApproveModule","HmsModule"]),angular.module("myApp").run(function(e){e.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!1),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}),angular.module("myApp").config(["$stateProvider","$urlRouterProvider","$httpProvider","$ionicConfigProvider",function(e,t,o,a){o.interceptors.push("httpRequestHeader"),a.platform.ios.tabs.style("standard"),a.platform.ios.tabs.position("bottom"),a.platform.android.tabs.style("standard"),a.platform.android.tabs.position("standard"),a.platform.ios.navBar.alignTitle("center"),a.platform.android.navBar.alignTitle("center"),a.platform.android.backButton.previousTitleText("").icon("ion-android-arrow-back"),a.platform.ios.views.transition("ios"),a.platform.android.views.transition("android"),e.state("tab",{url:"/tab","abstract":!0,templateUrl:"build/pages/tab/tabs.html",controller:"TabsCtrl"}).state("tab.message",{url:"/message",views:{"tab-message":{templateUrl:"build/pages/message/message.html",controller:"messageCtrl"}}}).state("tab.messageDetail",{url:"/messageDetail",params:{message:{}},views:{"tab-message":{templateUrl:"build/pages/message/detail/messageDetail.html",controller:"messageDetailCtrl"}}}).state("tab.contact",{url:"/contact",views:{"tab-contact":{templateUrl:"build/pages/contact/contact.html",controller:"contactCtrl"}}}).state("tab.application",{url:"/application",views:{"tab-application":{templateUrl:"build/pages/application/application.html",controller:"applicationCtrl"}}}).state("tab.myInfo",{url:"/myInfo",views:{"tab-myInfo":{templateUrl:"build/pages/myInfo/myInfo.html",controller:"myInfoCtrl"}}}).state("guide",{url:"/guide",templateUrl:"build/pages/guide/guide.html",controller:"guideCtrl"}).state("login",{url:"/login",templateUrl:"build/pages/login/login.html",controller:"loginCtrl"}),window.localStorage.token&&""!=window.localStorage.token?t.otherwise("/tab/message"):t.otherwise("/login")}]),angular.module("applicationModule").controller("applicationCtrl",["$scope","$state","baseConfig",function(e,t,o){e.animationsEnabled=!1,e.officeApp=[{list:[{appName:"会议管理",imageUrl:"build/img/application/meetingManage@3x.png",destUrl:""},{appName:"个人申请",imageUrl:"build/img/application/meetingManage@3x.png",destUrl:""},{appName:"报表分析",imageUrl:"build/img/application/meetingManage@3x.png",destUrl:""},{appName:"人事政策",imageUrl:"build/img/application/meetingManage@3x.png",destUrl:""}]},{list:[{appName:"假期管理",imageUrl:"build/img/application/holidayManage@3x.png",destUrl:"tab.time-off-manage"},{appName:"住宿申请",imageUrl:"build/img/application/dorm-apply/dorm-apply.png",destUrl:"tab.dorm-apply"},{appName:"Timesheet填写",imageUrl:"build/img/application/timesheet@3x.png",destUrl:"tab.timesheet"},{appName:"Timesheet审批",imageUrl:"build/img/application/timesheetExamine@3x.png",destUrl:"tab.tsApproveList"}]}],e.projectApp=[{list:[{appName:"机票预定",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:"tab.flyback"},{appName:"代办事项",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:"tab.workflow-list"},{appName:"报销单查询",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"首款查询",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""}]},{list:[{appName:"外勤汇报",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"",imageUrl:"",destUrl:""},{appName:"",imageUrl:"",destUrl:""},{appName:"",imageUrl:"",destUrl:""}]}],e.employeeApp=[{list:[{appName:"在线培训",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"知识门户",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"新闻",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"分享社区",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""}]}],e.openSetting=function(){e.animationsEnabled?e.animationsEnabled=!1:e.animationsEnabled=!0},e.goPage=function(e){o.debug&&console.log("appItem "+angular.toJson(e)),t.go(e.destUrl)},console.log("applicationCtrl.enter"),e.$on("$ionicView.enter",function(e){console.log("applicationCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){console.log("applicationCtrl.$destroy")})}]),angular.module("contactModule").controller("contactCtrl",["$scope","$state",function(e,t){console.log("contactCtrl.enter"),e.$on("$ionicView.enter",function(e){console.log("contactCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){console.log("contactCtrl.$destroy")})}]),angular.module("loginModule").controller("guideCtrl",["$scope","$state",function(e,t){console.log("loginCtrl.enter"),e.toLogin=function(){console.log("跳过导航页到登陆页"),t.go("login")},e.$on("$ionicView.enter",function(e){console.log("guideCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){console.log("guideCtrl.$destroy")})}]),angular.module("loginModule").controller("loginCtrl",["$scope","$state","baseConfig","$ionicLoading","$http","$timeout","$ionicHistory","hmsPopup",function(e,t,o,a,n,l,i,r){e.loginData={},e.currentVersionNum=o.versionName,window.localStorage.empno&&(e.loginData.username=window.localStorage.empno),window.localStorage.checkboxSavePwd||(e.checkboxSavePwd=!0,window.localStorage.checkboxSavePwd="true"),"true"==window.localStorage.checkboxSavePwd?(e.checkboxSavePwd=!0,e.loginData.password=window.localStorage.password):e.checkboxSavePwd=!1,o.debug&&console.log("loginCtrl.enter"),e.savePassword=function(){e.checkboxSavePwd=!e.checkboxSavePwd,o.debug&&console.log("此时密码框的状态为 :",angular.toJson(e.checkboxSavePwd)),""!==e.loginData.password&&(e.checkboxSavePwd===!0?window.localStorage.password=e.loginData.password:window.localStorage.password="")},e.clearUser=function(){e.loginData.username=""},e.clearPassword=function(){e.loginData.password=""},e.doLogin=function(){if(window.localStorage.empno=e.loginData.username,e.checkboxSavePwd?window.localStorage.password=e.loginData.password:window.localStorage.password="",!e.loginData.username||""==e.loginData.username)return void r.showPopup("用户名不能为空");if(!e.loginData.password||""==e.loginData.password)return void r.showPopup("密码不能为空");var a=o.basePath+"/appLogin/user_login/login",l={params:{p_user_name:+e.loginData.username,p_password:e.loginData.password}};r.showLoading("登陆中..."),n.post(a,l).success(function(a){r.hideLoading(),o.debug&&console.log("result success "+angular.toJson(a)),a.status||"S"!=a.con_status?r.showPopup("登陆失败,可能是密码不对!"):(window.localStorage.token=a.pre_token+a.token_key,window.localStorage.empno=e.loginData.username,window.localStorage.checkboxSavePwd=e.checkboxSavePwd,t.go("tab.message"))}).error(function(e,t){r.hideLoading(),o.debug&&console.log("response error "+angular.toJson(e))})},e.$on("$ionicView.enter",function(e){o.debug&&console.log("loginCtrl.$ionicView.enter"),l(function(){i.clearCache(),i.clearHistory()},400)}),e.$on("$destroy",function(e){o.debug&&console.log("loginCtrl.$destroy")})}]),angular.module("messageModule").controller("messageCtrl",["$scope","$state","$timeout","$ionicPlatform",function(e,t,o,a){e.messageList=[],a.ready(function(){window.StatusBar&&StatusBar.styleLightContent()}),e.talk=function(e){console.log("$scope.talk"),t.go("tab.messageDetail",{message:e})},e.refresh=function(){o(function(){e.$broadcast("scroll.refreshComplete")},2e3)},console.log("messageCtrl.enter"),e.$on("$ionicView.enter",function(e){console.log("messageCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){console.log("messageCtrl.$destroy")})}]),angular.module("loginModule").controller("TabsCtrl",["$scope","$rootScope","$state","baseConfig",function(e,t,o,a){t.$on("$ionicView.beforeEnter",function(){var t=o.current.name;a.debug&&console.log("$ionicView.beforeEnter statename "+t),"tab.message"!=t&&"tab.application"!=t&&"tab.contact"!=t&&"tab.myInfo"!=t&&(e.hideTabs=!0)}),t.$on("$ionicView.afterEnter",function(){var t=o.current.name;a.debug&&console.log("$ionicView.afterEnter statename "+t),"tab.message"!==t&&"tab.application"!==t&&"tab.contact"!==t&&"tab.myInfo"!==t||(e.hideTabs=!1,e.$apply())})}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.feedback",{url:"/feedback",views:{"tab-myInfo":{templateUrl:"build/pages/myInfo/feedback.html",controller:"FeedbackCtrl"}}})}]),angular.module("myInfoModule").controller("FeedbackCtrl",["$scope","baseConfig","$ionicHistory","hmsHttp","hmsPopup",function(e,t,o,a,n){e.qualityIssue=[!1,!1,!1,!1],e.feedbackInfo={info:""},e.selectQualityIssue=function(t){angular.forEach(e.qualityIssue,function(e,t,o){o[t]=!1}),e.qualityIssue[t]=!0},e.goBack=function(){o.goBack()},e.commit=function(){var t=0;angular.forEach(e.qualityIssue,function(e,o,a){0==a[o]&&t++}),t==e.qualityIssue.length?n.showShortCenterToast("请选择反馈问题类型"):""==e.feedbackInfo.info&&n.showShortCenterToast("请填写产品质量问题反馈")}}]),angular.module("myInfoModule").controller("myInfoCtrl",["$scope","$state","baseConfig",function(e,t,o){o.debug&&console.log("myInfoCtrl.enter"),e.logout=function(){window.localStorage.token="",window.localStorage.password="",window.localStorage.timesheetAuto="",window.localStorage.messagePush="",t.go("login")},e.setup=function(){t.go("tab.setup")},e.feedback=function(){t.go("tab.feedback")},e.checkMyInfo=function(){},e.$on("$ionicView.enter",function(e){o.debug&&console.log("myInfoCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){o.debug&&console.log("myInfoCtrl.$destroy")})}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.setup",{url:"/setup",views:{"tab-myInfo":{templateUrl:"build/pages/myInfo/setup.html",controller:"SetupCtrl"}}})}]),angular.module("myInfoModule").controller("SetupCtrl",["$scope","baseConfig","$ionicHistory",function(e,t,o){window.localStorage.timesheetAuto||(e.timesheetAuto=!1,window.localStorage.timesheetAuto="false",t.debug&&console.log("timesheet自动填写功能默认关闭")),window.localStorage.messagePush||(e.messagePush=!1,window.localStorage.messagePush="false",t.debug&&console.log("消息推送功能默认关闭")),"true"==window.localStorage.timesheetAuto?(e.timesheetAuto=!0,t.debug&&console.log("打开timesheet自动填写功能")):(e.timesheetAuto=!1,t.debug&&console.log("关闭timesheet自动填写功能")),"true"==window.localStorage.messagePush?(e.messagePush=!0,t.debug&&console.log("打开消息推送功能")):(e.messagePush=!1,t.debug&&console.log("关闭消息推送功能")),e.clickTimesheetAuto=function(){e.timesheetAuto=!e.timesheetAuto,1==e.timesheetAuto?(window.localStorage.timesheetAuto="true",t.debug&&console.log("打开timesheet自动填写功能")):0==e.timesheetAuto&&(window.localStorage.timesheetAuto="false",t.debug&&console.log("关闭timesheet自动填写功能"))},e.clickMessagePush=function(){e.messagePush=!e.messagePush,1==e.messagePush?(window.localStorage.messagePush="true",t.debug&&console.log("打开消息推送功能")):0==e.messagePush&&(window.localStorage.messagePush="false",t.debug&&console.log("关闭消息推送功能"))},e.goBack=function(){o.goBack()}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.dorm-apply-detail-a",{url:"/dorm-apply-detail-a",views:{"tab-application":{templateUrl:"build/pages/application/dorm-apply/dorm-apply-detail-a.html",controller:"DormApplyDetailFirstCtrl"}},params:{dormApplyDetailInfo:""}})}]),angular.module("applicationModule").controller("DormApplyDetailFirstCtrl",["$scope","$state","baseConfig","$ionicHistory","hmsHttp","hmsPopup","$rootScope","$timeout","$stateParams",function(e,t,o,a,n,l,i,r,s){e.applyInfo=s.dormApplyDetailInfo,e.approving=!1,e.rejected=!1,e.checkingin=!1,e.approvedResult="","审批中"==e.applyInfo.status?(e.approving=!0,e.rejected=!1,e.checkingin=!1,e.approvedResult=""):"已拒绝"==e.applyInfo.status?(e.approving=!1,e.rejected=!0,e.checkingin=!1,e.approvedResult="已拒绝"):"未入住"==e.applyInfo.status&&(e.approving=!1,e.rejected=!1,e.checkingin=!0,e.approvedResult="已通过"),e.goBack=function(){a.goBack()},e.cancelApply=function(){var t=o.businessPath+"/wfl_apply_room/cancel_application",r={params:{p_apply_id:e.applyInfo.applyId,p_employee_number:window.localStorage.empno}};l.showLoading("请稍候"),n.post(t,r).success(function(e){l.hideLoading();var t=e.message;l.showShortCenterToast(t),"S"==e.status&&(i.$broadcast("APPLY_CANCELLED"),a.goBack()),o.debug&&console.log("result success "+angular.toJson(e))}).error(function(e,t){l.hideLoading(),o.debug&&console.log("response error "+angular.toJson(e))})}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.dorm-apply-detail-b",{url:"/dorm-apply-detail-b",views:{"tab-application":{templateUrl:"build/pages/application/dorm-apply/dorm-apply-detail-b.html",controller:"DormApplyDetailSecondCtrl"}},params:{dormApplyDetailInfo:""}})}]),angular.module("applicationModule").controller("DormApplyDetailSecondCtrl",["$scope","$state","baseConfig","$ionicHistory","hmsHttp","hmsPopup","$rootScope","$timeout","$stateParams",function(e,t,o,a,n,l,i,r,s){e.applyInfo=s.dormApplyDetailInfo,e.checkIn=!1,e.checkOut=!1,e.buttonText="",e.leftDays=e.applyInfo.leftDays,e.totalDays=parseInt(e.applyInfo.checkinDays),"已入住"==e.applyInfo.status?(e.checkIn=!0,e.checkOut=!1,e.buttonText="续住"):"已退房"==e.applyInfo.status&&(e.checkIn=!1,e.checkOut=!0,e.buttonText="再次预定"),e.goBack=function(){a.goBack()},e.renewContract=function(){var t=o.businessPath+"/wfl_apply_room/overstay_apply_room",r={params:{p_employee_number:window.localStorage.empno,p_pro_id:"",p_checkin_date:"2016-08-15",p_checkout_date:"2016-09-20",p_room_number:e.applyInfo.roomNumber,p_bed_number:e.applyInfo.bedNumber,p_apply_type:e.applyInfo.applyType,p_reason:""}};"项目申请"==e.applyInfo.applyType&&(r.params.p_pro_id=e.applyInfo.projectId),l.showLoading("请稍候"),n.post(t,r).success(function(e){l.hideLoading();var t=e.message;l.showShortCenterToast(t),"S"==e.status&&(i.$broadcast("APPLY_SUCCESS"),a.goBack()),o.debug&&console.log("result success "+angular.toJson(e))}).error(function(e,t){l.hideLoading(),o.debug&&console.log("response error "+angular.toJson(e))})}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.dorm-apply-vacant-room",{url:"/dorm-apply-vacant-room",views:{"tab-application":{templateUrl:"build/pages/application/dorm-apply/dorm-apply-vacant-room.html",controller:"DormApplyVacantRoomCtrl"}},params:{dormApplySearchResult:"",projectId:"",applyType:""}})}]),angular.module("applicationModule").controller("DormApplyVacantRoomCtrl",["$scope","$rootScope","$state","baseConfig","$ionicHistory","hmsHttp","hmsPopup","$timeout","$stateParams",function(e,t,o,a,n,l,i,r,s){var c=s.dormApplySearchResult,p=s.projectId,d=s.applyType;e.roomlist=c.result,e.goBack=function(){n.goBack()},e.applyRoom=function(o){var r=a.businessPath+"/wfl_apply_room/apply_room",s={params:{p_employee_number:window.localStorage.empno,p_pro_id:"",p_checkin_date:c.checkinDate,p_checkout_date:c.checkoutDate,p_room_number:e.roomlist[o].room_number,p_bed_number:e.roomlist[o].bed_number,p_apply_type:c.applyType,p_reason:""}};"项目申请"==d&&(s.params.p_pro_id=p),i.showLoading("请稍候"),l.post(r,s).success(function(e){i.hideLoading();var o=e.message;i.showShortCenterToast(o),"S"==e.status&&(n.goBack(-2),t.$broadcast("APPLY_SUCCESS")),a.debug&&console.log("result success "+angular.toJson(e))}).error(function(e,t){i.hideLoading(),a.debug&&console.log("response error "+angular.toJson(e))})}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.dorm-apply",{url:"/dorm-apply",views:{"tab-application":{templateUrl:"build/pages/application/dorm-apply/dorm-apply.html",controller:"DormApplyCtrl"}}})}]),angular.module("applicationModule").controller("DormApplyCtrl",["$scope","$rootScope","$state","baseConfig","$ionicHistory","hmsHttp","hmsPopup","$ionicScrollDelegate","$timeout",function(e,t,o,a,n,l,i,r,s){function c(){e.items=[];var t=a.businessPath+"/wfl_apply_room/query_room_history_list",o={params:{p_employee_number:window.localStorage.empno}};l.post(t,o).success(function(t){a.debug&&console.log("result success "+angular.toJson(t)),e.items=t.result,angular.forEach(e.items,function(e,t,o){"已入住"==o[t].apply_status?(o[t].modeCheckIn=!0,o[t].modeCheckOut=!1,o[t].modeApproving=!1,o[t].modeRejected=!1,o[t].modeCheckingIn=!1):"已退房"==o[t].apply_status?(o[t].modeCheckIn=!1,o[t].modeCheckOut=!0,o[t].modeApproving=!1,o[t].modeRejected=!1,o[t].modeCheckingIn=!1):"审批中"==o[t].apply_status?(o[t].modeCheckIn=!1,o[t].modeCheckOut=!1,o[t].modeApproving=!0,o[t].modeRejected=!1,o[t].modeCheckingIn=!1):"已拒绝"==o[t].apply_status?(o[t].modeCheckIn=!1,o[t].modeCheckOut=!1,o[t].modeApproving=!1,o[t].modeRejected=!0,o[t].modeCheckingIn=!1):"未入住"==o[t].apply_status&&(o[t].modeCheckIn=!1,o[t].modeCheckOut=!1,o[t].modeApproving=!1,o[t].modeRejected=!1,o[t].modeCheckingIn=!0)})}).error(function(e,t){i.hideLoading(),a.debug&&console.log("response error "+angular.toJson(e))})}e.descriptionAppearance=!1,e.items=[],c(),e.goBack=function(){n.goBack()},e.createNewDormApply=function(){o.go("tab.new-dorm-apply")},e.viewApplyDetail=function(t){var a=e.items[t],n={status:a.apply_status,checkinDate:a.checkin_date,checkoutDate:a.checkout_date,applyType:a.apply_type,floorNumber:a.floor_number,roomNumber:a.room_number,roomType:a.room_type,bedNumber:a.bed_number,applyId:a.apply_id,projectId:a.project_id,checkinDays:a.checkin_days,leftDays:a.left_days
};"已入住"==n.status||"已退房"==n.status?o.go("tab.dorm-apply-detail-b",{dormApplyDetailInfo:n}):"审批中"!=n.status&&"已拒绝"!=n.status&&"未入住"!=n.status||o.go("tab.dorm-apply-detail-a",{dormApplyDetailInfo:n})},e.judgeApplyType=function(e){var t=e.apply_status;return"已入住"==t||"已退房"==t||"未入住"==t?!0:"审批中"==t||"已拒绝"==t?!1:void 0},e.showDescription=function(){e.descriptionAppearance=!0},e.hideDescription=function(){e.descriptionAppearance=!1},t.$on("APPLY_SUCCESS",function(){s(function(){r.$getByHandle("dormScroll").scrollTop(!1)},200),c()}),t.$on("APPLY_CANCELLED",function(){s(function(){r.$getByHandle("dormScroll").scrollTop(!1)},200),c()})}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.new-dorm-apply",{url:"/new-dorm-apply",views:{"tab-application":{templateUrl:"build/pages/application/dorm-apply/new-dorm-apply.html",controller:"NewDormApplyCtrl"}}})}]),angular.module("applicationModule").controller("NewDormApplyCtrl",["$scope","$state","baseConfig","$ionicHistory","$ionicModal","hmsHttp","hmsPopup",function(e,t,o,a,n,l,i){n.fromTemplateUrl("build/pages/application/dorm-apply/modal/new-dorm-apply-choose-apply-type.html",{scope:e}).then(function(t){e.chooseTypePopup=t}),n.fromTemplateUrl("build/pages/application/dorm-apply/modal/new-dorm-apply-choose-room-type.html",{scope:e}).then(function(t){e.chooseRoomPopup=t}),n.fromTemplateUrl("build/pages/application/dorm-apply/modal/new-dorm-apply-choose-project-name.html",{scope:e}).then(function(t){e.chooseProjectPopup=t}),e.defaultApplyType="常驻申请",e.defaultRoomType="单人间",e.defaultProjectInfo={projectName:"",projectId:""},e.showProjectItem=!1,e.applytype=["常驻申请","加班申请","临时申请","项目申请"],e.roomtype=["单人间","四人间"],e.projectlist=[],e.showNumButton=!0,e.inputinfo={floornum:"",roomnum:""};var r=o.businessPath+"/wfl_apply_room/query_project_list",s={params:{p_employee_number:window.localStorage.empno}};i.showLoading("请稍候"),l.post(r,s).success(function(t){i.hideLoading(),"S"==t.status&&(e.projectlist=t.result,e.projectlist=e.projectlist.splice(1,e.projectlist.length-1),e.projectlist.length>0?(e.defaultProjectInfo.projectName=e.projectlist[0].project_name,e.defaultProjectInfo.projectId=e.projectlist[0].project_id,console.log(angular.toJson(e.defaultProjectInfo))):0==e.projectlist.length&&(e.defaultProjectInfo.projectName="无",e.defaultProjectInfo.projectId="")),o.debug&&console.log("result success "+angular.toJson(t))}).error(function(e){i.hideLoading(),o.debug&&console.log("response error "+angular.toJson(e))}),e.goBack=function(){a.goBack()},e.chooseApplyType=function(){e.chooseTypePopup.show()},e.chooseRoomType=function(){e.chooseRoomPopup.show()},e.chooseProjectName=function(){0==e.projectlist.length?i.showShortCenterToast("项目列表为空，请更改申请类型"):e.projectlist.length>0&&e.chooseProjectPopup.show()},e.finishChoosingApplyType=function(t){e.defaultApplyType=t,"项目申请"==e.defaultApplyType?e.showProjectItem=!0:"项目申请"!=e.defaultApplyType&&(e.showProjectItem=!1),e.chooseTypePopup.hide()},e.finishChoosingRoomType=function(t){e.defaultRoomType=t,e.chooseRoomPopup.hide()},e.finishChoosingProjectName=function(t){e.defaultProjectInfo.projectName=e.projectlist[t].project_name,e.defaultProjectInfo.projectId=e.projectlist[t].project_id,e.chooseProjectPopup.hide()},e.chooseDays=function(){"常驻申请"==e.defaultApplyType&&(e.showNumButton=!e.showNumButton)},e.searchVacantRoom=function(){if("无"==e.defaultProjectInfo.projectName&&"项目申请"==e.defaultApplyType)i.showShortCenterToast("项目列表为空，请更改申请类型");else{var a=o.businessPath+"/wfl_apply_room/query_free_room_list",n={params:{p_employee_number:window.localStorage.empno,p_check_in_date:"2016-06-22",p_check_out_date:"2016-08-20",p_apply_type:e.defaultApplyType,p_room_type:e.defaultRoomType,p_room_number:e.inputinfo.roomnum,p_floor_number:e.inputinfo.floornum,p_pro_id:""}};"项目申请"==e.defaultApplyType&&(n.params.p_pro_id=e.defaultProjectInfo.projectId),i.showLoading("请稍候"),l.post(a,n).success(function(a){var l=a.message;if(i.hideLoading(),"S"==a.status&&a.result.length>0){var r=a.result,s={applyType:n.params.p_apply_type,checkinDate:n.params.p_check_in_date,checkoutDate:n.params.p_check_out_date,result:r};t.go("tab.dorm-apply-vacant-room",{dormApplySearchResult:s,projectId:e.defaultProjectInfo.projectId,applyType:e.defaultApplyType})}else"E"==a.status&&i.showShortCenterToast(l);o.debug&&console.log("result success "+angular.toJson(a))}).error(function(e,t){i.hideLoading(),o.debug&&console.log("response error "+angular.toJson(e))})}}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.time-off-manage",{url:"/time-off-manage",views:{"tab-application":{templateUrl:"build/pages/application/time-off-manage/time-off-manage-list.html",controller:"TimeOffManageCtrl"}}})}]),angular.module("applicationModule").controller("TimeOffManageCtrl",["$scope","$state","baseConfig","$ionicHistory",function(e,t,o,a){e.timeOffRecord={timeOffHeader:{userId:2201,paidHoliday:10,paidSickLeave:10,extPaidHoliday:20,usedPaidHoliday:5,usedPaidSickLeave:2,usedExtPaidHoliday:0},timeOffHistoryList:[{holidayIcon:"",timeOffTypeCode:"paid-holiday",timeOffTypeMeaning:"带薪年假",datetimeFrom:"2016-6-16",datetimeTo:"2016-6-18",timeLeave:2,approveStatusCode:"APPROVED",approveStatusMeaning:"APPROVED",applyReason:"陪老婆去迪斯尼玩",reason_image:[{image_url1:"",image_url2:"",image_url3:"",image_url4:"",image_url5:"",image_url6:"",image_url7:"",image_url8:"",image_url9:""}]}]},e.timeOffCreate=function(){}}]),angular.module("applicationModule").factory("flaybackService",["$ionicLoading",function(e){function t(e){var t="-",o=e.getMonth()+1,a=e.getDate();return o>=1&&9>=o&&(o="0"+o),a>=0&&9>=a&&(a="0"+a),e.getFullYear()+t+o+t+a}var o="",a="",n=[],l=[],i=[],r="",s="",c=[],p={};return{getFormatDate:t,getNowFormatDate:function(){var e=new Date,t="-",o=e.getFullYear(),a=e.getMonth()+1,n=e.getDate();a>=1&&9>=a&&(a="0"+a),n>=0&&9>=n&&(n="0"+n);var l=o+t+a+t+n;return l},setPageStatusCreate:function(e){p=e},getPageStatusCreate:function(e){return p},setProjName:function(e){o=e},getProjName:function(e){return o},setProjCode:function(e){a=e},getProjCode:function(e){return a},setTicketTypeList:function(e){n=e},getTicketTypeList:function(e){return n},setRouteTypeList:function(e){l=e},getRouteTypeList:function(e){return l},setPassengerList:function(e){i=e},getPassengerList:function(e){return i},setPassenger:function(e){r=e},getPassenger:function(e){return r},setCertification:function(e){s=e},getCertification:function(e){return s},addLine:function(e){c.push(e)},updateLine:function(e,o){var a=t(new Date(e.flight_date));e.flight_date=a,c[o]=e},getLines:function(){return c},setLines:function(e){c=e},deleteLine:function(e){c.splice(e,1)},clearLines:function(){c=[]}}}]),angular.module("messageModule").controller("messageDetailCtrl",["$scope","$state","$stateParams","$ionicHistory",function(e,t,o,a){var n=o.message;console.log("message : "+angular.toJson(n)),e.message=n,e.goBack=function(){a.goBack()},e.$on("$ionicView.enter",function(e){console.log("messageDetailCtrl.$ionicView.enter")}),console.log("messageDetailCtrl.enter"),e.$on("$destroy",function(e){console.log("messageDetailCtrl.$destroy")})}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.workflow-detail",{url:"/workflow-detail",params:{detail:{}},views:{"tab-application":{templateUrl:"build/pages/workflow/detail/detail.html",controller:"WorkFLowDetailCtrl"}}})}]),angular.module("applicationModule").controller("WorkFLowDetailCtrl",["$scope","$state","$stateParams","$ionicModal","$timeout","baseConfig","TimeSheetService","hmsPopup","WorkFLowListService",function(e,t,o,a,n,l,i,r,s){var c=o.detail;l.debug&&console.log("WorkFLowDetailCtrl.detail "+angular.toJson(c)),e.templateOne={};var p=function(t){l.debug&&console.log("getWorkflowDetail.result "+angular.toJson(t)),"S"==t.status&&t.workflow_data&&t.workflow_data.details[0]&&t.workflow_data.details[0].detail&&(e.templateOne=t.workflow_data.details[0].detail)};s.getWorkflowDetail(p,c.workflowId,c.instanceId,"Y")}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.workflow-list",{url:"/workflow-list",params:{day:{}},views:{"tab-application":{templateUrl:"build/pages/workflow/list/workflow-list.html",controller:"WorkFLowListCtrl"}}})}]),angular.module("applicationModule").controller("WorkFLowListCtrl",["$scope","$state","$stateParams","$ionicModal","$timeout","baseConfig","TimeSheetService","hmsPopup","WorkFLowListService",function(e,t,o,a,n,l,i,r,s){e.list=[],e.fetchDataFlag=!0,e.pullRefreshDataFlag=!1,e.showDetailArrow=!0,e.listStatus={todo:{selected:!0},done:{selected:!1}};var c="build/img/application/profile@3x.png",p="工作流类型",d="当前节点",u="提交人";e.fetchTodoList=function(){e.listStatus.todo.selected||e.fetchDataFlag||e.pullRefreshDataFlag||(e.listStatus.todo.selected=!0,e.listStatus.done.selected=!1,g(!1))},e.fetchDoneList=function(){e.listStatus.done.selected||e.fetchDataFlag||e.pullRefreshDataFlag||(e.listStatus.done.selected=!0,e.listStatus.todo.selected=!1,m(!1))};var g=function(t){e.list=[],t?(e.fetchDataFlag=!1,e.pullRefreshDataFlag=!0):e.fetchDataFlag=!0;var o=function(o){var a=o.待审批列表;angular.forEach(a,function(t){var o={title1:t.workflow_name,icon:c,type:p,typeValue:t.workflow_name,node:d,nodeValue:t.current_node,submit:u,submitPerson:t.employee_name,workflowId:t.workflow_id,instanceId:t.instance_id};e.list.push(o)}),e.fetchDataFlag=!1,t&&(e.pullRefreshDataFlag=!1,e.$broadcast("scroll.refreshComplete"))},a=function(o){e.fetchDataFlag=!1,t&&(e.pullRefreshDataFlag=!1,e.$broadcast("scroll.refreshComplete"))};n(function(){s.getTodoList("N",o,a)},1e3)},m=function(t){e.list=[],t?(e.fetchDataFlag=!1,e.pullRefreshDataFlag=!0):e.fetchDataFlag=!0;var o=function(o){var a=o.已审批列表;angular.forEach(a,function(t){var o={title1:t.workflow_desc,icon:c,type:p,typeValue:t.workflow_desc,node:d,nodeValue:t.status_name,submit:u,submitPerson:t.created_by_name,workflowId:t.workflow_id,instanceId:t.instance_id};e.list.push(o)}),e.fetchDataFlag=!1,t&&(e.pullRefreshDataFlag=!1,e.$broadcast("scroll.refreshComplete"))},a=function(o){e.fetchDataFlag=!1,t&&(e.pullRefreshDataFlag=!1,e.$broadcast("scroll.refreshComplete"))};n(function(){s.getTodoList("Y",o,a)},1e3)};g(!1),e.enterWorkflowDetail=function(e){t.go("tab.workflow-detail",{detail:e})},a.fromTemplateUrl("build/pages/application/timesheet-approve/modal/ts-filter-modal.html",{scope:e}).then(function(t){e.tsFilterModal=t}),e.filterTsInfo=function(){e.tsFilterModal.show()},e.refresh=function(){e.fetchDataFlag?e.$broadcast("scroll.refreshComplete"):(e.list=[],e.$apply(),n(function(){e.listStatus.todo.selected?g(!0):m(!0)},300))}}]).service("WorkFLowListService",["hmsHttp","baseConfig","hmsPopup",function(e,t,o){this.getTodoList=function(a,n,l){var i=t.businessPath+"/wfl_wx_workflow_appr/get_instance_list",r={params:{p_employee_code:window.localStorage.empno,p_flag:a+""}};e.post(i,r).success(function(e){n(e)}).error(function(e,t){o.showPopup("获取代办事项出错,可能是网络问题!"),l(e)})},this.getWorkflowDetail=function(o,a,n,l){var i=t.businessPath+"/wfl_wx_workflow_appr/get_workflow_detail",r={params:{p_workflow_id:a,p_instance_id:n,p_employee_code:window.localStorage.empno,p_submit_flag:l}};e.post(i,r).success(function(e){o(e)}).error(function(e){})}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.flybackApply",{url:"/flyback-apply",params:{},views:{"tab-application":{templateUrl:"build/pages/application/flyback/apply/apply.html",controller:"FlyBackApplyCtrl"}}})}]),angular.module("applicationModule").controller("FlyBackApplyCtrl",["$scope","$rootScope","$state","baseConfig","$ionicHistory","$timeout","hmsHttp","$ionicModal","flaybackService","hmsPopup",function(e,t,o,a,n,l,i,r,s,c){function p(){if("create"==d)e.flybackHeader={applyId:"",projName:"",projCode:""},s.clearLines(),e.flybacklines=s.getLines();else if("query"==d){var t=e.pageParam.applyId;c.showLoading("Loading...");var o=a.businessPath+"/create_ticket_apply/get_flyback_detail",n='{"params":{"p_apply_id":"'+t+'"}}';i.post(o,n,e).success(function(t){console.log("get_flyback_detail ="+angular.toJson(t)),"S"==t.status?(e.flybackHeader=t.flybackHeader,e.flybacklines=t.flybacklines,s.setLines(e.flybacklines),c.hideLoading("")):(console.log("获取机票申请信息失败："+t.returnMsg),c.hideLoading(""))}).error(function(e,t){console.log("HttpAppService error "),c.hideLoading("")})}}e.viewtitle="机票申请",e.pageParam=s.getPageStatusCreate(),console.log(" $scope.pageParam ="+e.pageParam),e.canEdit=e.pageParam.canEdit;var d=e.pageParam.dataSource;if(s.setLines(e.flybacklines),p(),e.$on("$ionicView.enter",function(){console.log("fbService.getLines()"),e.flybacklines=s.getLines(),console.log(angular.toJson(e.flybacklines)),e.$apply()}),e.canEdit){c.showLoading("Loading...");var u=a.businessPath+"/create_ticket_apply/get_value_list",g='{"params":{"p_employee":"'+window.localStorage.empno+'"}}';i.post(u,g,e).success(function(t){"S"==t.status?(e.projectList=t.projectList,s.setTicketTypeList(t.ticketTypeList),s.setRouteTypeList(t.routeTypeList),s.setPassenger(t.passengerList),s.setPassenger(t.passenger),s.setCertification(t.certification),c.hideLoading("")):console.log("获取值列表失败："+t.returnMsg)}).error(function(e,t){console.log("HttpAppService error "),c.hideLoading("")})}r.fromTemplateUrl("build/pages/application/flyback/apply/model/project-modal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t}),e.openProjectList=function(){e.modal.show()},e.closeModal=function(t){e.modal.hide(),void 0!==t&&("undefined"!=typeof e.flybackHeader.projCode&&null!==e.flybackHeader.projCode&&e.flybackHeader.projCode!==t.value&&(e.flybacklines=[],s.clearLines()),e.flybackHeader.projName=t.name,e.flybackHeader.projCode=t.value,s.setProjName(e.flybackHeader.projName),s.setProjCode(e.flybackHeader.projCode))},e.$on("$destroy",function(){e.modal.remove()}),e.goDetail=function(t,a){var n={canEdit:e.canEdit,dataSource:d,status:"update",detail:t,index:a,applyId:e.flybackHeader.applyId};o.go("tab.flybackDetail",{param:angular.toJson(n)})},e.addFlightInfo=function(){s.setProjName(e.flybackHeader.projName),s.setProjCode(e.flybackHeader.projCode);var t={canEdit:e.canEdit,status:"new"};o.go("tab.flybackDetail",{param:angular.toJson(t)})},e.save=function(){c.showLoading("Loading...");var t=a.businessPath+"/create_ticket_apply/save_flyback",o=JSON.stringify(e.flybacklines),n='{"params":{"p_employee":"'+window.localStorage.empno+'","p_apply_id":"'+e.flybackHeader.applyId+'","p_project_code":"'+e.flybackHeader.projCode+'","p_fb_lines":'+o+"}}";console.log(n),i.post(t,n,e).success(function(t){console.log("save_flyback = "+angular.toJson(t)),"S"==t.status?(e.flybackHeader.applyId=t.applyId,e.flybacklines=t.flybackLines,s.setLines(e.flybacklines),c.hideLoading(""),c.showPopup("保存成功!")):(console.log("保存失败："+t.returnMsg),c.hideLoading(""))}).error(function(e,t){console.log("HttpAppService error "),c.hideLoading("")})},e.submit=function(){c.showLoading("Loading...");var t=a.businessPath+"/create_ticket_apply/flyback_submit",o=JSON.stringify(e.flybacklines),n='{"params":{"p_employee":"'+window.localStorage.empno+'","p_apply_id":"'+e.flybackHeader.applyId+'","p_project_code":"'+e.flybackHeader.projCode+'","p_fb_lines":'+o+"}}";i.post(t,n,e).success(function(t){console.log("flyback_submit = "+angular.toJson(t)),"S"==t.status?(c.hideLoading(""),c.showPopup("提交成功!"),e.canEdit=!1):(c.hideLoading(""),c.showPopup("提交失败："+t.returnMsg))}).error(function(e,t){console.log("HttpAppService error "),c.hideLoading("")})},e.deleteFB=function(){if(console.log(angular.toJson(e.flybackHeader)),""==e.flybackHeader.applyId)o.go("tab.flyback");else if(e.canEdit){c.showLoading("Loading...");var t=a.businessPath+"/create_ticket_apply/delete_flyback_all",n='{"params":{"p_employee":"'+window.localStorage.empno+'","p_apply_id":"'+e.flybackHeader.applyId+'"}}';console.log(n),i.post(t,n,e).success(function(e){"S"==e.status?(c.hideLoading(""),c.showPopup("删除成功!"),o.go("tab.flybackQuery"),d="create",p()):(console.log("删除失败："+e.returnMsg),c.hideLoading(""),c.showPopup("删除失败,请重新查询后再操作!"))}).error(function(e,t){console.log("HttpAppService error "),c.hideLoading("")})}else c.showPopup("已提交数据无法删除!")}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.flybackDetail",{url:"/flyback-detail/:param",params:{},views:{"tab-application":{templateUrl:"build/pages/application/flyback/detail/detail.html",controller:"FlyBackDetailCtrl"}}})}]),angular.module("applicationModule").controller("FlyBackDetailCtrl",["$scope","$rootScope","$state","baseConfig","$ionicHistory","$timeout","hmsHttp","$ionicModal","flaybackService","hmsPopup","$stateParams",function(e,t,o,a,n,l,i,r,s,c,p){e.pageParam=JSON.parse(p.param),e.canEdit=e.pageParam.canEdit;e.pageParam.dataSource;if("update"==e.pageParam.status){e.flybackline=e.pageParam.detail;var d=new Date(e.flybackline.flight_date);e.flybackline.flight_date=d;var u=(e.flybackline,e.pageParam.index),g=e.pageParam.applyId}else if("new"==e.pageParam.status){var d=new Date(s.getNowFormatDate().replace(/\-/g,"/"));e.flybackline={apply_detail_id:"",projName:"",projCode:"",ticketTypeName:"",ticket_type:"",routeTypeName:"",route_type:"",flyback1:"",flyback1_id:"",flyback2:"",flyback2_id:"",from_place:"",go_place:"",flight_date:d,flight_time:"",place:"",passenger:"",certificate_code:"",customer_paid:"0",is_ticket_only_record:"0",description:""},e.flybackline.projName=s.getProjName(),e.flybackline.projCode=s.getProjCode(),e.flybackline.passenger=s.getPassenger(),e.flybackline.certificate_code=s.getCertification(),console.log(" $scope.flybackline.projName "+e.flybackline.projName)}if(e.canEdit){e.ticketTypeList=s.getTicketTypeList(),e.routeTypeList=s.getRouteTypeList(),e.passengerList=s.getPassengerList(),"new"==e.pageParam.status&&(e.ticketTypeList.length>0&&(e.flybackline.ticketTypeName=e.ticketTypeList[0].name,e.flybackline.ticket_type=e.ticketTypeList[0].value),e.routeTypeList.length>0&&(e.flybackline.routeTypeName=e.routeTypeList[0].name,e.flybackline.route_type=e.routeTypeList[0].value)),c.showLoading("Loading...");var m=a.businessPath+"/create_ticket_apply/get_value_list2",f='{"params":{"p_employee":"'+window.localStorage.empno+'","p_project_code":"'+e.flybackline.projCode+'"}}';console.log(""),i.post(m,f,e).success(function(t){"S"==t.status?(e.placeList=t.placeList,e.flybackList=t.flybackList,e.preflybackList=t.preflybackList,e.placeList.length>0&&(e.flybackline.place=e.placeList[0].name),c.hideLoading("")):(console.log("获取值列表失败："+t.returnMsg),c.hideLoading(""))}).error(function(e,t){console.log("HttpAppService error "),c.hideLoading("")})}e.datepickerObject={},e.datepickerObject.inputDate=new Date,e.datepickerObjectPopup={titleLabel:"日期选择",todayLabel:"今天",closeLabel:"关闭",setLabel:"确定",setButtonType:"button-assertive",todayButtonType:"button",closeButtonType:"button",inputDate:e.datepickerObject.inputDate,mondayFirst:!0,disabledDates:[],weekDaysList:["日","一","二","三","四","五","六"],monthList:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],templateType:"popup",showTodayButton:"true",modalHeaderColor:"bar-positive",modalFooterColor:"bar-positive",from:new Date(1900,0,1),to:new Date(2101,0,1),dateFormat:" yyyy - MM - dd ",closeOnSelect:!1,callback:function(e){h(e)}};var h=function(t){"undefined"==typeof t?console.log("No date selected"):(e.datepickerObjectPopup.inputDate=t,e.flybackline.flight_date=t,console.log("Selected date is : ",e.flybackline.flight_date))};r.fromTemplateUrl("build/pages/application/flyback/detail/model/select-modal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t}),e.openModal=function(t){e.canEdit&&("ticketType"==t?(e.listType="ticketType",e.lists=e.ticketTypeList):"routeType"==t?(e.listType="routeType",e.lists=e.routeTypeList):"flyback1"==t?(e.listType="flyback1","10"==e.flybackline.ticket_type?e.lists=e.flybackList:"20"==e.flybackline.ticket_type&&(e.lists=e.preflybackList)):"flyback2"==t?(e.listType="flyback2","10"==e.flybackline.ticket_type?e.lists=e.flybackList:"20"==e.flybackline.ticket_type&&(e.lists=e.preflybackList)):"place"==t?(e.listType="place",e.lists=e.placeList):"passenger"==t&&(e.listType="passenger",e.lists=e.passengerList),e.modal.show())},e.closeModal=function(t){e.modal.hide(),void 0!==t&&("ticketType"==e.listType?("undefined"!=typeof e.flybackline.ticket_type&&null!==e.flybackline.ticket_type&&e.flybackline.flybackline!==t.value&&(e.flybackline.flyback1="",e.flybackline.flyback1_id="",e.flybackline.flyback2="",e.flybackline.flyback2_id=""),e.flybackline.ticketTypeName=t.name,e.flybackline.ticket_type=t.value):"routeType"==e.listType?(e.flybackline.routeTypeName=t.name,e.flybackline.route_type=t.value):"flyback1"==e.listType?(e.flybackline.flyback1=t.type_name,e.flybackline.flyback1_id=t.value):"flyback2"==e.listType?(e.flybackline.flyback2=t.type_name,e.flybackline.flyback2_id=t.value):"place"==e.listType?e.flybackline.place=t.name:"passenger"==e.listType&&(e.flybackline.passenger=t.name,e.flybackline.certificate_code=t.value))},e.clearSelect=function(){e.modal.hide(),"ticketType"==e.listType?(e.flybackline.ticketTypeName="",e.flybackline.ticket_type="",e.flybackline.flyback1="",e.flybackline.flyback1_id="",e.flybackline.flyback2="",e.flybackline.flyback2_id=""):"routeType"==e.listType?(e.flybackline.routeTypeName="",e.flybackline.route_type=""):"flyback1"==e.listType?(e.flybackline.flyback1="",e.flybackline.flyback1_id=""):"flyback2"==e.listType?(e.flybackline.flyback2="",e.flybackline.flyback2_id=""):"place"==e.listType?e.flybackline.place="":"passenger"==e.listType&&(e.flybackline.passenger="",e.flybackline.certificate_code="")};var y={checked:"ion-ios-checkmark fb-checkbox",unchecked:"ion-ios-circle-outline fb-checkbox"};e.customerpaid={id:1,selected:"N",style:"ion-ios-circle-outline fb-checkbox",editable:"Y"},e.customerPaid=function(){e.canEdit&&"Y"==e.customerpaid.editable&&("Y"==e.customerpaid.selected?(e.customerpaid.selected="N",e.customerpaid.style=y.unchecked,e.flybackline.customer_paid="0"):(e.customerpaid.selected="Y",e.customerpaid.style=y.checked,e.flybackline.customer_paid="1"))},e.ticketonly={id:1,selected:"N",style:"ion-ios-circle-outline timesheet-checkbox",editable:"Y"},e.ticketOnly=function(){e.canEdit&&("Y"==e.ticketonly.selected?(e.ticketonly.selected="N",e.ticketonly.style=y.unchecked,e.flybackline.is_ticket_only_record="0"):(e.ticketonly.selected="Y",e.ticketonly.style=y.checked,e.flybackline.is_ticket_only_record="1"))},"0"==e.flybackline.customer_paid?(e.customerpaid.selected="N",e.customerpaid.style=y.unchecked):(e.customerpaid.selected="Y",e.customerpaid.style=y.checked),"0"==e.flybackline.is_ticket_only_record?(e.ticketonly.selected="N",e.ticketonly.style=y.unchecked):(e.ticketonly.selected="Y",e.ticketonly.style=y.checked),e.$on("$destroy",function(){e.modal.remove()}),e["delete"]=function(){if(e.canEdit){if(""!==e.flybackline.apply_detail_id){c.showLoading("Loading...");var t=a.businessPath+"/create_ticket_apply/delete_flyback_line",n='{"params":{"p_apply_id":"'+g+'","p_apply_detail_id":"'+e.flybackline.apply_detail_id+'"}}';console.log("paramValueList ="+n),i.post(t,n,e).success(function(e){"S"==e.status?(s.deleteLine(u),c.hideLoading("")):(console.log("删除失败："+e.returnMsg),c.hideLoading(""))}).error(function(e,t){console.log("HttpAppService error "),c.hideLoading("")})}else s.deleteLine(u);o.go("tab.flybackApply")}else c.showPopup("已提交数据无法删除!")},e.confirm=function(){if(console.log("confirm status ="+e.pageParam.status),"new"==e.pageParam.status){var t=getFormatDate(new Date(e.flybackline.flight_date));e.flybackline.flight_date=t,s.addLine(e.flybackline),o.go("tab.flybackApply")}else"update"==e.pageParam.status&&(s.updateLine(e.flybackline,u),o.go("tab.flybackApply"))}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.flyback",{url:"/flyback-main",params:{},views:{"tab-application":{templateUrl:"build/pages/application/flyback/main/main.html",controller:"FlyBackMainCtrl"}}})}]),angular.module("applicationModule").controller("FlyBackMainCtrl",["$scope","$rootScope","$state","baseConfig","$ionicHistory","$timeout","hmsHttp","flaybackService",function(e,t,o,a,n,l,i,r){e.createFlightBook=function(){var e={canEdit:!0,dataSource:"create"};r.setPageStatusCreate(e),o.go("tab.flybackApply")},e.queryFlightBook=function(){o.go("tab.flybackQuery")}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.flybackQuery",{url:"/flyback-query",params:{},views:{"tab-application":{templateUrl:"build/pages/application/flyback/query/query.html",controller:"FlyBackQueryCtrl"}}})}]),angular.module("applicationModule").controller("FlyBackQueryCtrl",["$scope","$rootScope","$state","baseConfig","$ionicHistory","$timeout","$ionicModal","$ionicScrollDelegate","hmsHttp","flaybackService","hmsPopup","hmsHttp",function(e,t,o,a,n,l,i,r,s,c,p,d){var u=c.getNowFormatDate(),g=new Date(u.replace(/\-/g,"/")),m=new Date(u.replace(/\-/g,"/")),f=new Date(m.setMonth(m.getMonth()-1));e.param={projectCode:"",projectName:"",filter:"",reqDateFrom:f,reqDateTo:g},e.flybackList=[],e.query=function(){if(""==e.param.reqDateFrom||""==e.param.reqDateTo)p.showPopup("请输入查询日期范围！");else{var t=c.getFormatDate(new Date(e.param.reqDateFrom)),o=c.getFormatDate(new Date(e.param.reqDateTo));p.showLoading("Loading...");var n=a.businessPath+"/create_ticket_apply/get_flyback_lists",l='{"params":{"p_employee":"'+window.localStorage.empno+'","p_project_code":"'+e.param.projectCode+'","p_apply_date_from":"'+t+'","p_apply_date_to":"'+o+'"}}';d.post(n,l,e).success(function(t){"S"==t.status?(e.flybackList=t.flybackList,p.hideLoading("")):(console.log("查询机票申请失败："+t.returnMsg),p.hideLoading(""))}).error(function(e,t){console.log("HttpAppService error "),p.hideLoading("")})}},e.query(),e.$on("$ionicView.enter",function(){e.query()}),p.showLoading("Loading...");var h=a.businessPath+"/create_ticket_apply/get_project_list",y='{"params":{"p_employee":"'+window.localStorage.empno+'"}}';d.post(h,y,e).success(function(t){"S"==t.status?(e.projectList=t.projectList,p.hideLoading("")):(console.log("获取项目列表失败："+t.returnMsg),p.hideLoading(""))}).error(function(e,t){console.log("HttpAppService error "),p.hideLoading("")}),i.fromTemplateUrl("build/pages/application/flyback/query/model/select-modal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t}),e.openModal=function(t){"project"==t&&(e.listType="project",e.lists=e.projectList),e.modal.show()},e.chooseModal=function(t){e.modal.hide(),"project"==e.listType&&(e.param.projectName=t.name,e.param.projectCode=t.value,e.param.filter="")},e.closeModal=function(){e.modal.hide()},e.clearChoose=function(t){e.modal.hide(),"project"==e.listType&&(e.param.projectName="",e.param.projectCode="",e.param.filter="")},e.$on("$destroy",function(){e.modal.remove()}),e.goDetail=function(e){if("0"==e.isSubmitted)var t=!0;else if("1"==e.isSubmitted)var t=!1;var a={canEdit:t,dataSource:"query",applyId:e.applyId};c.setPageStatusCreate(a),o.go("tab.flybackApply")},e.deleteFB=function(t,o){p.showLoading("Loading...");var n=a.businessPath+"/create_ticket_apply/delete_flyback_all",l='{"params":{"p_employee":"'+window.localStorage.empno+'","p_apply_id":"'+t+'"}}';d.post(n,l,e).success(function(t){"S"==t.status?(e.flybackList.splice(o,1),p.hideLoading("")):(console.log("删除失败："+t.returnMsg),p.hideLoading(""))}).error(function(e,t){console.log("HttpAppService error "),p.hideLoading("")})}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.timesheet",{url:"/timesheet",views:{"tab-application":{templateUrl:"build/pages/application/timesheet/query/query.html",controller:"TimeSheetQueryCtrl"}}})}]),angular.module("applicationModule").controller("TimeSheetQueryCtrl",["$scope","$rootScope","$state","baseConfig","$ionicHistory","$timeout","$ionicScrollDelegate","TimeSheetService","hmsHttp",function(e,t,o,a,n,l,r,s,c){var p=!0;e.calendar=[],e.loadingDataFlag=!0,e.currentYear="",e.currentMonth="",e.monthList=[{selected:!1,value:"1"},{selected:!1,value:"2"},{selected:!1,value:"3"},{selected:!1,value:"4"},{selected:!1,value:"5"},{selected:!1,value:"6"},{selected:!1,value:"7"},{selected:!1,value:"8"},{selected:!1,value:"9"},{selected:!1,value:"10"},{selected:!1,value:"11"},{selected:!1,value:"12"}],e.weekTitleList=["日","一","二","三","四","五","六"];var d=function(e){return parseInt(e)<10?"0"+e:""+e},u=function(){var t=new Date,o=t.getFullYear(),n=t.getMonth()+1;e.currentYear=o,e.currentMonth=n,angular.forEach(e.monthList,function(e){return e.value===n+""?void(e.selected=!0):void 0}),a.debug&&(console.log("initDate.year "+o),console.log("initDate.month "+n));var l=o+""+d(n);f(l)},g=function(){for(e.calendar=[],i=0;i<5;i++){var t="each-day",o="day-item",a="",n="",l={week:i,list:[]};for(j=0;j<7;j++){var r={day:i+""+j,style_outline:t,style_color:o,money:a,project:n};l.list.push(r)}e.calendar.push(l)}};e.writeTimesheet=function(e){o.go("tab.timesheet-write",{day:e})},e.scrollToFixScreen=function(){p?(r.scrollTo(0,400,!0),p=!1):(r.scrollTo(0,0,!0),p=!0)};var m=function(t){var o=t.timesheet,a=0;for(e.calendar=[],i=0;i<5;i++){var n={week:i,list:[]};for(j=0;j<7;j++){var l,r="each-day",s="day-item",c="",p="",d=!1;o[a]?(d="0"!=o[a].lockflag,"Empty"==o[a].status?(r="each-day",s="day-item"):"Draft"==o[a].status?(r="each-day attendance",s="day-item attendance"):"Approved"==o[a].status?(r="each-day approve",s="day-item approve"):"Rejected"==o[a].status&&(r="each-day reject",s="day-item reject"),l={day:o[a].day.replace("0",""),style_outline:r,style_color:s,money:o[a].allowance,project:o[a].proj,each_day:o[a].each_day,lockFlag:d}):l={day:"",style_outline:r,style_color:s,money:c,project:p,each_day:"",lockFlag:d},n.list.push(l),a+=1}e.calendar.push(n)}},f=function(t){g(),e.loadingDataFlag=!0;var o=a.businessPath+"/timesheet_process/fetch_calendar",n={params:{p_employee:window.localStorage.empno,p_month:t+"",p_offset:0}};c.post(o,n).success(function(t){m(t),e.loadingDataFlag=!1,a.debug&&console.log("result success "+angular.toJson(t))}).error(function(t,o){e.loadingDataFlag=!1,a.debug&&console.log("response error "+angular.toJson(t))})};e.getTimeSheet=function(t,o){angular.forEach(e.monthList,function(e){e.selected=!1}),o.selected=!0;var a=t+""+d(o.value);f(a)},l(function(){u()},300),e.goBack=function(){n.$ionicGoBack()},t.$on("refreshTimesheet",function(t,o){a.debug&&console.log("refreshTimesheet",o),l(function(){var t=e.currentYear+""+d(e.currentMonth);f(t)},300)}),a.debug&&console.log("applicationCtrl.enter"),e.$on("$ionicView.enter",function(e){a.debug&&console.log("applicationCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){a.debug&&console.log("applicationCtrl.$destroy")})}]).service("TimeSheetService",["baseConfig","hmsHttp","hmsPopup",function(e,t,o){this.fetchCalendar=function(o){var a=e.businessPath+"/timesheet_process/fetch_calendar",n={params:{p_employee:window.localStorage.empno,p_month:o+"",p_offset:"0"}};t.post(a,n).success(function(t){e.debug&&console.log("result success "+angular.toJson(t))}).error(function(t,o){e.debug&&console.log("response error "+angular.toJson(t))})},this.fetchEachDay=function(a,n){var l=e.businessPath+"/timesheet_process/fetch_projects",i={params:{p_employee:window.localStorage.empno+"",p_date:+n+""}};t.post(l,i).success(function(e){a(e)}).error(function(e,t){o.hideLoading(),o.showPopup("获取状态错误,请检查网络!")})},this.fetchProjectDetailInfo=function(a,n,l){var i=e.businessPath+"/timesheet_process/project_change",r={params:{p_employee:window.localStorage.empno+"",p_date:+n+"",p_project_id:l+""}};t.post(i,r).success(function(e){a(e)}).error(function(e,t){o.hideLoading(),o.showPopup("获取项目信息错误,请检查网络!")})},this.submitTimesheet=function(a,n){var l=e.businessPath+"/timesheet_process/save_timesheet1",n=n;t.post(l,n).success(function(e){a(e)}).error(function(e,t){o.hideLoading(),o.showPopup("提交Timesheet错误,请检查网络!")})}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.timesheet-write",{url:"/timesheet-write",params:{day:{}},views:{
"tab-application":{templateUrl:"build/pages/application/timesheet/write/write.html",controller:"TimeSheetWriteCtrl"}}})}]),angular.module("applicationModule").controller("TimeSheetWriteCtrl",["$scope","$state","$stateParams","$ionicModal","$timeout","$ionicHistory","baseConfig","TimeSheetService","hmsPopup",function(e,t,o,a,n,l,i,r,s){var c="ion-ios-checkmark",p="ion-ios-circle-outline";e.projectList=[],e.addressList=[],e.flybackList=[];var d="N",u={flag:!1,style:p},g={flag:!0,style:c};e.timesheetDetail={currentDay:"",approver:"",currentProject:{},currentAddress:{},currentFlyback:{},travelingAllowance:{flag:!1,style:p},normalAllowance:{flag:!1,style:p},intCharge:{flag:!1,style:p},extCharge:{flag:!1,style:p},description:""},i.debug&&console.log("$stateParams.day "+angular.toJson(o.day)),e.currentDate=o.day.each_day,a.fromTemplateUrl("build/pages/application/timesheet/write/modal/projectModal.html",{scope:e}).then(function(t){e.projectModal=t}),a.fromTemplateUrl("build/pages/application/timesheet/write/modal/addressModal.html",{scope:e}).then(function(t){e.addressModal=t}),a.fromTemplateUrl("build/pages/application/timesheet/write/modal/flybackList.html",{scope:e}).then(function(t){e.flybackModal=t}),e.selectAddress=function(t){i.debug&&console.log("selectAddress.address "+angular.toJson(t)),e.timesheetDetail.currentAddress=t,e.addressModal.hide()},e.selectFlyback=function(t){i.debug&&console.log("selectAddress.flyback "+angular.toJson(t)),e.timesheetDetail.currentFlyback=t,e.flybackModal.hide()},e.selectProject=function(t){i.debug&&console.log("selectAddress.project "+angular.toJson(t)),e.timesheetDetail.currentProject=t,e.projectModal.hide();var o=function(t){s.hideLoading(),"S"==t.status?(e.addressList=t.projaddress,e.flybackList=t.flyback,e.timesheetDetail.approver=t.approver,e.timesheetDetail.travelingAllowance={flag:!1,style:p},e.timesheetDetail.normalAllowance={flag:!1,style:p},t.projaddress[0]?e.timesheetDetail.currentAddress=t.projaddress[0]:e.timesheetDetail.currentAddress={selected_flag:"Y",address_id:"0",address_name:"缺省地点"},t.flyback[0]?e.timesheetDetail.currentFlyback=t.flyback[0]:e.timesheetDetail.currentFlyback={fly_select:"Y",fly_name:"无flyback",fly_id:"-1"}):s.showPopup("获取项目信息错误,请检查")};n(function(){s.showLoading("获取项目信息中"),r.fetchProjectDetailInfo(o,e.currentDate,t.project_id)})},e.showProjectModal=function(){e.projectModal.show()},e.hideProjectModal=function(){e.projectModal.hide()},e.showFlybackModal=function(){e.flybackModal.show()},e.hideFlybackModal=function(){e.flybackModal.hide()},e.showAddressModal=function(){e.addressModal.show()},e.hideAddressModal=function(){e.addressModal.hide()};var m=function(t){if(s.hideLoading(),"S"==t.status){var o=t.project,a=t.flyback,n=t.projaddress;i.debug&&console.log("fetchEachDay result.every_day "+angular.toJson(t.every_day)),"Y"==t.every_day.holiday?d="Y":"N"==t.every_day.holiday&&(d="N"),"1"==t.every_day.offbase?e.timesheetDetail.travelingAllowance=g:e.timesheetDetail.travelingAllowance=u,"Y"==t.every_day.base?e.timesheetDetail.normalAllowance=g:e.timesheetDetail.normalAllowance=u,"1"==t.every_day.internalcharge?e.timesheetDetail.intCharge=g:e.timesheetDetail.intCharge=u,"1"==t.every_day.externalcharge?e.timesheetDetail.extCharge=g:e.timesheetDetail.extCharge=u,e.timesheetDetail.currentDay=t.every_day.every_day,e.timesheetDetail.approver=t.every_day.approver,e.timesheetDetail.description=t.every_day.descrpt,e.timesheetDetail.allowance=t.every_day.allowance,angular.forEach(o,function(t){return"Y"===t.selected_flag?void(e.timesheetDetail.currentProject=t):void 0}),angular.forEach(n,function(t){return"Y"===t.selected_flag?void(e.timesheetDetail.currentAddress=t):void 0}),angular.forEach(a,function(t){return"Y"===t.fly_select?void(e.timesheetDetail.currentFlyback=t):void 0}),e.projectList=o,e.addressList=n,e.flybackList=a}else s.showPopup("获取timesheet错误,错误原因为")};e.checkBoxChanged=function(t,o){console.log("$scope.checkBoxChanged item "+angular.toJson(t)),"N"==d&&"charging"==o||(t.flag?(t.flag=!1,t.style=p):(t.flag=!0,t.style=c),"travelingAllowance"==o&&e.timesheetDetail.travelingAllowance.flag&&(e.timesheetDetail.normalAllowance={flag:!1,style:p}),"normalAllowance"==o&&e.timesheetDetail.normalAllowance.flag&&(e.timesheetDetail.travelingAllowance={flag:!1,style:p}))},e.submitTimesheet=function(t){i.debug&&console.log("timesheetDetail "+angular.toJson(t));var o=window.localStorage.empno,a=e.currentDate,n=e.timesheetDetail.currentProject.project_id,c="",p="",d="",u="",g="",m=e.timesheetDetail.currentAddress.address_id,f=e.timesheetDetail.currentFlyback.fly_id;u=e.timesheetDetail.extCharge.flag?1:0,g=e.timesheetDetail.intCharge.flag?1:0,p=e.timesheetDetail.travelingAllowance.flag?1:0,d=e.timesheetDetail.normalAllowance.flag?1:0,c=e.timesheetDetail.description.replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r");var h={params:{p_employee:o+"",p_date:a+"",p_project:n+"",p_description:c+"",p_offbase_flag:p+"",p_base_flag:d+"",p_ext_charge:u+"",p_int_charge:g+"",p_address:m+"",p_flyback:f+""}};i.debug&&console.log("submitTimesheet.params "+angular.toJson(h));var y=function(t){s.hideLoading(),"S"==t.status?(s.showPopup("提交Timesheet成功"),e.$broadcast("refreshTimesheet","parent"),l.goBack()):s.showPopup("提交Timesheet错误,错误原因为")};s.showLoading("提交数据中"),r.submitTimesheet(y,h)},n(function(){s.showLoading("获取timesheet明细数据"),r.fetchEachDay(m,e.currentDate)})}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.tsApproveList",{url:"application/tsApproveList",views:{"tab-application":{templateUrl:"build/pages/application/timesheet-approve/list/ts-approve-list.html",controller:"tsApproveListCtrl"}}})}]),angular.module("tsApproveModule").controller("tsApproveListCtrl",["$scope","$state","baseConfig","$ionicModal","$ionicScrollDelegate","$ionicPopup","$timeout","TsApproveListService","hmsPopup","hmsHttp","ApproveDetailService",function(e,t,o,a,n,l,i,r,s,c,p){function d(){e.showLsLoading=!0,c.post(_,v).success(function(t){c.isSuccessfull(t.status)&&(e.personList=unique_better(t.project_person_list,"employee_number"),e.projectList=unique_better(t.project_list,"project_id"))}).error(function(e){}),e.listInfoArray=new r(e,b,v,e.showLsLoading)}function u(t){e.selectArray=[],y=[],angular.forEach(e.listInfoArray.listArray,function(o,a){"undoSelectAll"==t?(e.selectArray.push(!1),y.push(!1)):"selectedAll"==t&&(e.selectArray.push(!0),y.push(!0))})}function g(){for(var e=0;e<S.approve_list.length;e++)"delete"===S.approve_list[e]?(S.approve_list.splice(e,1),e--):S.approve_list[e]&&""!=S.approve_list[e]&&"undefined"!=typeof S.approve_list[e]||(S.approve_list.splice(e,1),e--)}function m(){e.tsFilterModal.hide(),e.showProjectName=!0,e.isClickedProject=[],e.isClickedPerson=[],angular.element("#project-name").addClass("active-select"),angular.element("#project-name").removeClass("active-off"),angular.element("#person-select").removeClass("active-select")}ionic.Platform.isIOS()&&(angular.element(".custom-head").css("paddingTop","10px"),angular.element(".ts-list-bg").css("paddingTop","110px")),e.showProjectName=!0,e.showRocket=!1,e.showConnectBlock=!1,e.showDetailArrow=!0,e.showLsLoading=!1;var f=!1;e.endApproveDate="",e.actionName="操作",e.selectArray=[],e.isClickedProject=[],e.selectEndItem=[!1,!0,!1],e.listInfoArray={},e.personList=[],e.projectList=[],e.endDateList=[{dateValue:getMonthDay(getLastMonthDate(new Date)).replace(/\b(0+)/gi,""),dateCode:getLastMonthDate(new Date)},{dateValue:getMonthDay(getCurrentDate(new Date)).replace(/\b(0+)/gi,""),dateCode:getCurrentDate(new Date)},{dateValue:getMonthDay(getCurrentMonthLastDate(new Date)).replace(/\b(0+)/gi,""),dateCode:getCurrentMonthLastDate(new Date)}];var h="",y=[],b=o.businessPath+"/wfl_timesheet_view/get_timesheet_list",_=o.businessPath+"/wfl_timesheet_view/get_project_person_list",w=o.businessPath+"/wfl_timesheet_view/timesheet_approve",v={params:{p_employee_number:window.localStorage.empno,p_start_date:"",p_end_date:"",p_project_name:"",p_project_id:"",p_project_person_number:"",p_page:1,p_page_size:6}},k={params:{p_approve_flag:"AGREE",p_employee_number:window.localStorage.empno,p_param_json:""}},S={approve_list:[]},D=(new Date).getDate();10>=D?(v.params.p_end_date=getLastMonthDate(new Date),e.endApproveDate=getMonthDay(getLastMonthDate(new Date)).replace(/\b(0+)/gi,"")):D>10&&20>=D?(v.params.p_end_date=getCurrentDate(new Date),e.endApproveDate=getMonthDay(getCurrentDate(new Date)).replace(/\b(0+)/gi,"")):D>20&&(v.params.p_end_date=getCurrentMonthLastDate(new Date),e.endApproveDate=getMonthDay(getCurrentMonthLastDate(new Date)).replace(/\b(0+)/gi,"")),d(),e.$on("$ionicView.enter",function(t){"refresh-approve-list"===p.getRefreshFlag()&&e.tsListRefresh()}),e.$on("$destroy",function(e){log("tsApproveListCtrl.$destroy")}),u("undoSelectAll"),e.doSelectAction=function(){"操作"==e.actionName?(e.actionName="取消",e.showDetailArrow=!1,angular.element(".ts-approve-list-item").css("paddingLeft","10%")):"取消"==e.actionName&&(e.actionName="操作",e.showDetailArrow=!0,angular.element(".ts-approve-list-item").css("paddingLeft","10px"),k={params:{p_approve_flag:"AGREE",p_employee_number:window.localStorage.empno,p_param_json:""}},S={approve_list:[]},u("undoSelectAll"))},a.fromTemplateUrl("build/pages/application/timesheet-approve/modal/ts-date-modal.html",{scope:e}).then(function(t){e.dateModal=t}),e.selectEndDate=function(){v.params.p_end_date=e.endApproveDate,e.dateModal.show()},e.selectEndDateItem=function(t,o,a){e.selectEndItem=[],e.selectEndItem[a]=!0,e.endApproveDate=o,v.params.p_page=1,v.params.p_end_date=t,e.listInfoArray=new r(e,b,v,e.showLsLoading),e.dateModal.hide()},e.cancelDateModal=function(){v.params.p_end_date=e.endApproveDate,e.dateModal.hide()},e.onDrag=function(){e.showConnectBlock=!1},e.onDragUp=function(){e.showConnectBlock=!0},e.watchScroll=function(){h=n.getScrollPosition().top,e.$apply(function(){0>h?e.showConnectBlock=!1:h>=0&&400>h?(e.showRocket=!1,e.showConnectBlock=!0):h>=400&&(e.showRocket=!0)})},e.tsListRefresh=function(){v.params.p_page=1,e.listInfoArray=new r(e,b,v,e.showLsLoading)},e.getAttentionInfo=function(t,o){e.showDetailArrow&&(t.stopPropagation(),warn(o),l.show({template:'<div class="warn-attention-icon">'+o[0].description+"</div>",scope:e,buttons:[{text:'<div class="warn-cancel-icon"></div>',type:"button-clear",onTap:function(e){}}]}))},e.goTsLsTop=function(){angular.element("#rocket").addClass("ng-hide"),n.scrollTop(!0)},a.fromTemplateUrl("build/pages/application/timesheet-approve/modal/ts-filter-modal.html",{scope:e}).then(function(t){e.tsFilterModal=t}),e.filterTsInfo=function(){v.params.p_project_id="",v.params.p_project_person_number="",e.tsFilterModal.show()},e.goApproveDetail=function(o,a,n,l,i){if(e.showDetailArrow)t.go("tab.tsApproveDetail",{employeeNumber:a,projectId:n,startDate:l,endDate:i});else{y[o]=!y[o];var r={p_project_id:"",p_project_person_number:"",p_start_date:"",p_end_date:"",p_record_id:""};y[o]?(e.selectArray[o]=!0,r.p_project_id=n,r.p_project_person_number=a,r.p_start_date=l,r.p_end_date=i,S.approve_list[o]=r):(S.approve_list.splice(o,1,"delete"),e.selectArray[o]=!1)}},e.selectAllList=function(){if(f=!f){for(var t=0;t<e.listInfoArray.listArray.length;t++){var o={p_project_id:"",p_project_person_number:"",p_start_date:"",p_end_date:"",p_record_id:""};o.p_project_id=e.listInfoArray.listArray[t].project_id,o.p_project_person_number=e.listInfoArray.listArray[t].employee_number,o.p_start_date=e.listInfoArray.listArray[t].start_date,o.p_end_date=e.listInfoArray.listArray[t].end_date,S.approve_list.push(o)}u("selectedAll")}else S.approve_list=[],u("undoSelectAll")},e.passThroughListItem=function(){return 0===S.approve_list.length?void s.showShortCenterToast("请先选择操作项！"):(g(),k.params.p_approve_flag="AGREE",k.params.p_param_json=JSON.stringify(S),s.showLoading("审批中..."),void c.post(w,k).success(function(t){s.hideLoading(),c.isSuccessfull(t.status)?s.showShortCenterToast("审批成功！"):s.showShortCenterToast("审批失败！"),e.doSelectAction(),i(function(){e.tsListRefresh()},1e3)}).error(function(t){s.hideLoading(),s.showShortCenterToast("审批失败！请检查网络稍后重试"),e.doSelectAction(),i(function(){e.tsListRefresh()},1e3)}))},e.refuseListItem=function(){return 0===S.approve_list.length?void s.showShortCenterToast("请先选择操作项！"):(g(),k.params.p_approve_flag="REFUSE",k.params.p_param_json=JSON.stringify(S),s.showLoading("审批中..."),void c.post(w,k).success(function(t){s.hideLoading(),c.isSuccessfull(t.status)?s.showShortCenterToast("拒绝成功！"):s.showShortCenterToast("拒绝失败！"),e.doSelectAction(),i(function(){e.tsListRefresh()},1e3)}).error(function(t){s.hideLoading(),s.showShortCenterToast("拒绝失败！请检查网络稍后重试"),e.doSelectAction(),i(function(){e.tsListRefresh()},1e3)}))},e.selectScreening=function(t){"projectName"==t?(e.showProjectName=!0,angular.element("#project-name").css({backgroundColor:"white",color:"#4A4A4A"}),angular.element("#person-select").css({backgroundColor:"#fafafa",color:"#9b9b9b"})):"personSelect"==t&&(e.showProjectName=!1,angular.element("#person-select").css({backgroundColor:"white",color:"#4A4A4A"}),angular.element("#project-name").css({backgroundColor:"#fafafa",color:"#9b9b9b"}))},e.selectFilterItem=function(t,o,a){"projectName"===t?(e.isClickedProject=[],e.isClickedProject[o]=!0,v.params.p_project_id=a):"personSelect"===t&&(e.isClickedPerson=[],e.isClickedPerson[o]=!0,v.params.p_project_person_number=a)},e.cancelFilter=function(){v.params.p_project_id="",v.params.p_project_person_number="",m()},e.confirmFilter=function(){m(),v.params.p_page=1,e.showLsLoading=!0,e.listInfoArray=new r(e,b,v,e.showLsLoading)},e.clearFilterParams=function(){e.isClickedProject=[],e.isClickedPerson=[],v.params.p_project_id="",v.params.p_project_person_number=""}}]).service("TsApproveListService",["hmsHttp","baseConfig","hmsPopup",function(e,t,o){var a=function(a,n,l,i,r){var s=this;s.scope=a,s.url=n,s.params={},s.params=l,s.refurbishParam=r,s.busy=!1,s.totalNumber=0,s.listArray=[],s.loading=i,"clickRefreshEvent"===s.refurbishParam&&s.scope.$broadcast("scroll.infiniteScrollComplete"),e.post(s.url,s.params).success(function(a){s.loading=!1;try{if(e.isSuccessfull(a.status)){var n=a.timesheet_approve_response;t.debug&&warn("hi,create a new factory!!\n"+jsonFormat()),s.totalNumber=a.count;try{s.listArray=s.listArray.concat(n.result_list)}catch(l){s.listArray=[],s.projectList=[],s.employeeList=[]}0==a.count?(s.busy=!1,s.listArray=[]):a.count<=6?s.busy=!1:s.busy=!0,s.scope.$broadcast("scroll.refreshComplete"),s.scope.$broadcast("scroll.infiniteScrollComplete")}else s.busy=!1,"E"===a.status||"e"==a.status?o.showShortCenterToast("没有相关数据!"):o.showShortCenterToast("网络异常,请稍后重试!"),s.scope.$broadcast("scroll.refreshComplete"),s.scope.$broadcast("scroll.infiniteScrollComplete")}catch(l){}}.bind(s)).error(function(e){s.loading=!1,s.params.params.p_page=1,s.busy=!1,s.scope.$broadcast("scroll.refreshComplete"),s.scope.$broadcast("scroll.infiniteScrollComplete"),o.showShortCenterToast("服务请求异常,请检查网络连接和输入参数后重新操作!")}.bind(s))};return a.prototype.nextPage=function(){var a=this;if(t.debug&&warn("enter next page!"),a.busy){if(a.busy&&"clickRefreshEvent"===a.refurbishParam)return a.refurbishParam="",void a.scope.$broadcast("scroll.infiniteScrollComplete");a.busy=!0,a.params.params.p_page++,e.post(a.url,a.params).success(function(t){try{if(e.isSuccessfull(t.status)){if(angular.isUndefined(t.timesheet_approve_response.result_list))a.busy=!1,o.showShortCenterToast("数据已经加载完毕!");else{var n=t.timesheet_approve_response;a.listArray=a.listArray.concat(n.result_list)}a.scope.$broadcast("scroll.infiniteScrollComplete")}else"E"===t.status&&(a.params.params.p_page--,o.showShortCenterToast("数据请求错误,请检查传入参数重新操作!")),a.scope.$broadcast("scroll.infiniteScrollComplete")}catch(l){a.params.params.p_page--,a.scope.$broadcast("scroll.infiniteScrollComplete")}}.bind(a)).error(function(e){a.params.params.p_page--,a.scope.$broadcast("scroll.infiniteScrollComplete"),o.showShortCenterToast("网络异常,请稍后重试!")}.bind(a))}},a}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.tsApproveDetail",{url:"application/tsApproveDetail",views:{"tab-application":{templateUrl:"build/pages/application/timesheet-approve/detail/ts-approve-detail.html",controller:"tsApproveDetailCtrl"}},params:{employeeNumber:"",projectId:"",startDate:"",endDate:""}})}]),tsApproveModule.controller("tsApproveDetailCtrl",["$scope","$state","baseConfig","$ionicHistory","$stateParams","hmsHttp","hmsPopup","$timeout","ApproveDetailService",function(e,t,o,a,n,l,i,r,s){function c(){l.post(m,f).success(function(t){i.hideLoading(),l.isSuccessfull(t.status)?(e.detailInfoArray=t.timesheet_approve_detail_response,0===e.detailInfoArray.subsidy_list.length&&(s.setRefreshFlag("refresh-approve-list"),a.goBack())):"E"===t.status||"e"==t.status?i.showShortCenterToast("没有相关数据!"):i.showShortCenterToast("网络异常,请稍后重试!")}).error(function(e,t){i.hideLoading(),i.showShortCenterToast("服务请求异常,请检查网络连接和输入参数后重新操作!")})}function p(t){e.selectArray=[],u=[],angular.forEach(e.detailInfoArray.subsidy_list,function(o,a){"undoSelectAll"==t?(e.selectArray.push(!1),u.push(!1)):"selectedAll"==t&&(e.selectArray.push(!0),u.push(!0))})}function d(){for(var e=0;e<b.approve_list.length;e++)"delete"===b.approve_list[e]?(b.approve_list.splice(e,1),e--):b.approve_list[e]&&""!=b.approve_list[e]&&"undefined"!=typeof b.approve_list[e]||(b.approve_list.splice(e,1),e--)}ionic.Platform.isIOS()&&(angular.element(".ae-detail-head").css("marginTop","64px"),angular.element("#approveDetailContent").css("top","64px"));var u=[],g=!1;e.detailActionName="操作",e.showActionBar=!1,e.detailInfoArray={},e.selectArray=[];var m=o.businessPath+"/wfl_timesheet_view/query_timesheet_approve_list",f={params:{p_employee_number:n.employeeNumber,p_start_date:n.startDate.toString(),p_end_date:n.endDate.toString(),p_project_id:n.projectId}},h=o.businessPath+"/wfl_timesheet_view/timesheet_approve",y={params:{p_approve_flag:"AGREE",p_employee_number:window.localStorage.empno,p_param_json:""}},b={approve_list:[]};e.$on("$ionicView.enter",function(e){s.setRefreshFlag("")}),e.$on("$destroy",function(e){warn("tsApproveListCtrl.$destroy")}),i.showLoading("加载中..."),c(),p("undoSelectAll"),e.dealDetailInfo=function(){"操作"==e.detailActionName?(e.detailActionName="取消",e.showActionBar=!0,angular.element("#tsApproveItem").css("paddingLeft","6%")):"取消"==e.detailActionName&&(e.detailActionName="操作",e.showActionBar=!1,p("undoSelectAll"),angular.element("#tsApproveItem").css("paddingLeft","0"),y={params:{p_approve_flag:"AGREE",p_employee_number:window.localStorage.empno,p_param_json:""}},b={approve_list:[]})},e.selectItem=function(t,o){u[t]=!u[t];var a={p_project_id:e.detailInfoArray.project_id,p_project_person_number:e.detailInfoArray.employee_number,p_start_date:"",p_end_date:"",p_record_id:""};u[t]?(e.selectArray[t]=!0,a.p_record_id=o,b.approve_list[t]=a):(e.selectArray[t]=!1,b.approve_list.splice(t,1,"delete"))},e.selectAllDetail=function(){if(g=!g){p("selectedAll");for(var t=0;t<e.detailInfoArray.subsidy_list.length;t++){var o={p_project_id:e.detailInfoArray.project_id,p_project_person_number:e.detailInfoArray.employee_number,p_start_date:"",p_end_date:"",p_record_id:""};o.p_record_id=e.detailInfoArray.subsidy_list[t].line_number,b.approve_list.push(o)}warn(b.approve_list)}else p("undoSelectAll"),b.approve_list=[]},e.passThroughDetailItem=function(){return 0===b.approve_list.length?void i.showShortCenterToast("请先选择操作项！"):(d(),y.params.p_approve_flag="AGREE",y.params.p_param_json=JSON.stringify(b),i.showLoading("审批中..."),void l.post(h,y).success(function(t){i.hideLoading(),l.isSuccessfull(t.status)?i.showShortCenterToast("审批成功！"):i.showShortCenterToast("审批失败！"),e.dealDetailInfo(),r(function(){i.showLoading("加载中..."),c()},1e3)}).error(function(t){i.hideLoading(),i.showShortCenterToast("审批失败！请检查网络稍后重试"),e.dealDetailInfo(),r(function(){i.showLoading("加载中..."),c()},1e3)}))},e.refuseDetailItem=function(){return 0===b.approve_list.length?void i.showShortCenterToast("请先选择操作项！"):(d(),y.params.p_approve_flag="REFUSE",y.params.p_param_json=JSON.stringify(b),i.showLoading("审批中..."),void l.post(h,y).success(function(t){i.hideLoading(),l.isSuccessfull(t.status)?i.showShortCenterToast("拒绝成功"):i.showShortCenterToast("拒绝失败！"),e.dealDetailInfo(),r(function(){i.showLoading("加载中..."),c()},1e3)}).error(function(t){i.hideLoading(),i.showShortCenterToast("拒绝失败！请检查网络稍后重试"),e.dealDetailInfo(),r(function(){i.showLoading("加载中..."),c()},1e3)}))}}]).service("ApproveDetailService",function(){var e="";return{setRefreshFlag:function(t){e=t},getRefreshFlag:function(){return e}}});