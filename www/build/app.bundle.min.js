<<<<<<< HEAD
function jsonFormat(e){var o=angular.toJson(e,!0);return o}function getCurrentDate(e){var o=e.getFullYear(),t=e.getMonth()+1,a=e.getDate();t=10>t?"0"+t:t,a=10>a?"0"+a:a;var n=o.toString()+"-"+t.toString()+"-"+a.toString();return n}function getLastMonthDate(e){var o=e.getFullYear(),t=e.getMonth(),a=new Date(o,t,1),n=new Date(a.getTime()-864e5).getDate();t=10>t?"0"+t:t,n=10>n?"0"+n:n;var r=o.toString()+"-"+t.toString()+"-"+n.toString();return r}function getCurrentMonthLastDate(e){var o=e.getFullYear(),t=e.getMonth()+1,a=new Date(o,t,1),n=new Date(a.getTime()-864e5).getDate();t=10>t?"0"+t:t,n=10>n?"0"+n:n;var r=o.toString()+"-"+t.toString()+"-"+n.toString();return r}function getMonthDay(e){var o=e.substring(5,7)+"月"+e.substring(8,10)+"日";return o}function unique_normal(e){for(var o=[],t=0;t<e.length;t++){var a=e[t];-1===o.indexOf(a)&&o.push(a)}return o}function unique(e){for(var o=[],t=0;t<e.length;t++){var a=e[t];-1===indexOf(o,a)&&o.push(a)}return o}function unique_better(e,o){for(var t=[],a={},n=0;n<e.length;n++){if("object"==typeof e[n])var r=e[n][o];else var r=e[n];var l=e[n],i=typeof r+r;1!==a[i]&&(t.push(l),a[i]=1)}return t}angular.module("baseConfig",[]).constant("baseConfig",{debug:!0,isMobilePlatform:!1,clearTable:!0,nativeScreenFlag:!1,basePath:"http://wechat.hand-china.com/hmbms_hand/api",businessPath:"http://wechat.hand-china.com/hmbms_hand/api/dataEngine",currentVersion:"2.0.0",url:"",pkgIdentifier:"",versionName:"此版本为dev测试环境 2.0.0",appEnvironment:"UAT"});var utilModule=angular.module("utilModule",[]),HmsModule=angular.module("HmsModule",[]),loginModule=angular.module("loginModule",[]),messageModule=angular.module("messageModule",[]),contactModule=angular.module("contactModule",[]),applicationModule=angular.module("applicationModule",[]),myInfoModule=angular.module("myInfoModule",[]),tsApproveModule=angular.module("tsApproveModule",[]);HmsModule.directive("hideTabs",function(e){return{restrict:"A",link:function(o,t,a){o.$on("$ionicView.beforeEnter",function(){o.$watch(a.hideTabs,function(o){console.log("$ionicView.beforeEnter value "+o),o?e.hideTabs=!1:e.hideTabs=!0})}),o.$on("$ionicView.beforeLeave",function(){e.hideTabs=!0,console.log("$ionicView.beforeLeave value ")})}}}).directive("elasticImage",function(e){return{restrict:"A",link:function(e,o,t){var a=document.getElementById(t.elasticImage),n=a.offsetHeight;o.bind("scroll",function(e){var o=e.detail.scrollTop,t=n-o;0>t&&(t=0),a.style.height=t+"px"})}}}),HmsModule.directive("hmsLoading",function(e){return{restrict:"E",template:'<div class="hms-hide-content"><div class="content">数据加载中...</div><div class="hide-icon"><ion-spinner icon="ios" class="spinner spinner-ios"></ion-spinner></div></div>',replace:!0,transclude:!1,controller:["$scope",function(e){}],link:function(e,o,t,a){}}}),HmsModule.directive("footerSelect",function(){return{restrict:"E",scope:{selectAllItem:"&",passThrough:"&",refuse:"&"},template:'<ion-footer-bar class="foot-bar"><div class="row buttons"><button class="button button-clear ts-button-left" ng-click="selectAllItem()">全选</button><button class="button button-clear ts-button-center" ng-click="passThrough()">通过</button><button class="button button-clear ts-button-right" ng-click="refuse()">拒绝</button></div></ion-footer-bar>',replace:!0,transclude:!1,controller:["$scope",function(e){}],link:function(e,o,t,a){}}}),HmsModule.directive("customHeadBar",function(){return{restrict:"E",scope:{actionName:"@",customTitle:"@",goBackPage:"&",doAction:"&"},template:'<div class="custom-head custom-head-background"><div class="row custom-first-head"><button class="button button-clear back-button" ng-click="goBackPage()"><i class="ion-ios-arrow-back"></i><span class="back-text">返回</span></button><button class="button button-clear action-button" ng-click="doAction()" ng-bind="actionName"></button></div><div class="ts-list-title" ng-bind="customTitle"></div><div class="custom-second-head" ng-transclude></div></div>',replace:!0,transclude:!0,controller:["$scope",function(e){}],link:function(e,o,t,a){}}}),HmsModule.directive("hmsWorkflowList",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{title:"=workflowTitle",icon:"=workflowIcon",type:"=workflowType",typeValue:"=workflowTypeValue",node:"=workflowNode",nodeValue:"=workflowNodeValue",submit:"=workflowSubmit",submitPerson:"=workflowSubmitPerson"},template:'<a class="workflow-list"><div class="workflow-list-logo"><img src="{{icon}}"/></div><div class="workflow-list-header">{{title}}</div><div class="workflow-list-content"><div class="row no-padding"><div class="col col-90 no-padding"><div class="row no-padding"> <div class="col col-33 no-padding color-type">{{type}}</div><div class="col col-67 no-padding color-content">{{typeValue}}</div></div><div class="row no-padding"><div class="col col-33 no-padding color-type">{{node}}</div><div class="col col-67 no-padding color-content">{{nodeValue}}</div></div><div class="row no-padding"><div class="col col-33 no-padding color-type">{{submit}}</div><div class="col col-67 no-padding color-content">{{submitPerson}}</div></div></div><div class="col col-10 no-padding col-center workflow-list-select"><img src="build/img/workflow/select@3x.png"/></div></div></div></a>',controller:["$scope",function(e){}],link:function(e,o,t){}}}),angular.module("HmsModule").directive("hmsslidecalendar",["$animate","$timeout","$compile","$ionicHistory","$ionicScrollDelegate",function(e,o,t,a,n){return{restrict:"E",replace:!0,transclude:!0,scope:{autoPlay:"=",doesContinue:"@",slideInterval:"@",showPager:"@",pagerClick:"&",disableScroll:"@",onSlideChanged:"&",activeSlide:"=?",bounce:"@"},controller:["$scope","$element","$attrs",function(e,t,a){function n(e){return"undefined"!=typeof e}console.log("$element[0] "+angular.toJson(t[0]));var r=e.$eval(e.doesContinue)===!0,l=e.$eval(e.bounce)!==!1,i=n(a.autoPlay)?!!e.autoPlay:!1,s=i?e.$eval(e.slideInterval)||4e3:0;console.log("continuous "+r),console.log("bouncing "+l),console.log("shouldAutoPlay "+i),console.log("slideInterval "+s);var c=new ionic.views.calendar({el:t[0],auto:s,continuous:r,startSlide:e.activeSlide,bouncing:l,slidesChanged:function(){e.currentSlide=c.currentIndex(),o(function(){})},callback:function(t){e.currentSlide=t,e.onSlideChanged({index:e.currentSlide,$index:e.currentSlide}),e.$parent.$broadcast("slideBox.slideChanged",t),e.activeSlide=t,o(function(){})},onDrag:function(){console.log("slider.onDrag "),freezeAllScrolls(!0)},onDragEnd:function(){console.log("slider.onDragEnd "),freezeAllScrolls(!1)}});e.$watch("activeSlide",function(e){console.log("slider.scope.activeSlide "),n(e)&&c.slide(e)}),e.$on("slideBox.nextSlide",function(){console.log("slider.slideBox.nextSlide "),c.next()}),e.$on("slideBox.prevSlide",function(){console.log("slider.slideBox.prevSlide "),c.prev()}),e.$on("slideBox.setSlide",function(e,o){console.log("slider.slideBox.setSlide "),c.slide(o)}),this.__slider=c,e.$on("$destroy",function(){console.log("$destroy ")}),o(function(){})}],template:'<div class="slider"><div class="slider-slides" ng-transclude></div></div>',link:function(o,t,a){e.enabled(t,!1)}}}]),angular.module("utilModule").factory("httpRequestHeader",function(){var e={request:function(e){if(window.localStorage.token&&window.localStorage.empno){var o=(new Date).getTime(),t=CryptoJS.MD5(window.localStorage.token+o);e.headers.timestamp=o,e.headers.token=t,e.headers.loginName=window.localStorage.empno}return e}};return e}),HmsModule.filter("weekDay",function(){return function(e){if(""==e)return e;var o=new Date(e),t=o.getDay();switch(t){case 0:e+="　星期天";break;case 1:e+="　星期一";break;case 2:e+="　星期二";break;case 3:e+="　星期三";break;case 4:e+="　星期四";break;case 5:e+="　星期五";break;case 6:e+="　星期六"}return e}});var log=console.log.bind(console),warn=console.warn.bind(console),error=console.error.bind(console),indexOf=[].indexOf?function(e,o){return e.indexOf(o)}:function(e,o){for(var t=0;t<e.length;t++)if(e[t]===o)return t;return-1};angular.module("HmsModule").factory("hmsHttp",["$log","$http","hmsPopup",function(e,o,t){var a="HmsHttp",n="isSucessfull",r=a+".noAuthorPost",l=a+".post",i=a+".get",s=function(e){Prompter.hideLoading(),e.go("login")},c={goBackLogin:function(e){s(e)},isSuccessfull:function(o){return e.debug(n+" Start!"),e.debug(r+" status "+o),"S"==o||"SW"==o},post:function(t,a){e.debug(l+" Start!"),e.debug(l+" url "+t),e.debug(l+" paramter "+angular.toJson(a));var n=o.post(t,a).success(function(o){e.debug(l+" success"),e.debug(l+" End!")}).error(function(o,t){e.debug(l+" error"),e.debug(l+" response "+o),e.debug(l+" status "+t),e.debug(l+" End!")});return n},get:function(t){e.debug(i+" Start!"),e.debug(i+" url "+t);var a=o.get(t).success(function(o){e.debug(i+" success"),e.debug(i+" response "+angular.toJson(o)),e.debug(i+" End!")}).error(function(o,t){e.debug(i+" error"),e.debug(i+" response "+o),e.debug(i+" status "+t),e.debug(i+" End!")});return a}};return c}]).service("hmsPopup",["$ionicLoading","$cordovaToast","$ionicPopup","baseConfig",function(e,o,t,a){this.showLoading=function(o){e.show({template:'<ion-spinner icon="ios" class="spinner spinner-ios spinner-stable"></ion-spinner><div style="color: white;font-size: 12px;text-align: center;height:25px;line-height: 25px;">'+o+"</div>"})},this.hideLoading=function(){e.hide()},this.showShortCenterToast=function(t){a.nativeScreenFlag?o.showLongBottom(angular.isDefined(t)?t:"操作失败").then(function(e){},function(e){}):e.show({template:angular.isDefined(t)?t:"操作失败",animation:"fade-in",showBackdrop:!1,maxWidth:200,duration:2e3})},this.showPopup=function(e,o){if(a.nativeScreenFlag){var n=function(){};navigator.notification.alert(e,n,"提示","确定")}else t.show({title:"提示",template:e,buttons:[{text:"确定",type:"button button-cux-popup-confirm"}]})},this.prompt=function(e,o,n,r){if(a.nativeScreenFlag)navigator.notification.prompt(o,r,"填写信息",["确定","退出"],"");else{var l=t.show({template:'<input type="type" ng-model="myScope.data.city">',title:o,subTitle:o,scope:e,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(o){return e.myScope.data.city?e.myScope.data.city:void o.preventDefault()}}]});l.then(n)}},this.confirm=function(e,o,n){if(a.nativeScreenFlag)navigator.notification.confirm(e,n,o,["确定","取消"]);else{var r=t.confirm({title:angular.isDefined(o)?o:"提示",template:e,cancelText:"取消",cancelType:"button-cux-popup-cancel",okText:"确定",okType:"button-cux-popup-confirm"});r.then(n)}}}]).factory("hmsReturnView",["$ionicHistory","baseConfig",function(e,o){var t=(window.screen.width-50,{width:""});return{go:function(o){var t=e.currentHistoryId(),a=e.viewHistory().histories[t],n=a.stack.length-1-o;e.backView(a.stack[n]),e.goBack()},returnToState:function(t){var a=e.currentHistoryId(),n=e.viewHistory().histories[a];o.debug&&console.log("history.stack.length : "+n.stack.length);for(var r=n.stack.length-1;r>=0;r--)o.debug&&console.log("history.stack[i].stateName : "+n.stack[r].stateName),n.stack[r].stateName==t&&(e.backView(n.stack[r]),e.goBack())},getStackList:function(e,t){var a=[],n=e.currentHistoryId(),r=e.viewHistory().histories[n];o.debug&&console.log(e.viewHistory());for(var l="#F99D32",i=0;i<r.stack.length;i++){i==r.stack.length-1&&(l="black");var s={viewId:r.stack[i].viewId,stateName:r.stack[i].stateName,title:r.stack[i].title,color:{color:l}};o.debug&&console.log(r.stack[i]),a.push(s)}return a[a.length-1].title=t,a},getWidth:function(){return t}}}]).factory("hmsBackLine",["$ionicHistory","baseConfig",function(e){var o,t=window.screen.width-50,a={width:""},n=0,r=[];return{getViews:function(e){o=e.toString().length,ROOTCONFIG.debug&&console.log(o);for(var l=0;l<r.length;l++)if(e==r[l].name){r=r.slice(0,l+1),n=0;for(var i=0;i<r.length;i++)n=i==r.length-1?n+14*r[i].name.toString().length+8:n+14*r[i].name.toString().length+18+8;console.log(n),t>n?a.width="":a.width=n+"px";for(var s=0;s<r.length-1;s++)r[s].myStyle.color="#F99D32";return console.log(r),r[r.length-1].myStyle.color="black",r}var c={name:e,myStyle:{color:""}};r.push(c),n=0;for(var p=0;l<r.length;p++)n=p==r.length-1?n+14*r[p].name.toString().length+8:n+14*r[p].name.toString().length+18+8;n>t&&(a.width=n+"px");for(var u=0;u<r.length-1;l++)r[u].myStyle.color="#F99D32";return r},getWidth:function(){return a}}}]).factory("$hmsHelp",["$ionicTemplateLoader","$ionicBackdrop","$q","$timeout","$rootScope","$ionicBody","$compile","$ionicPlatform","$ionicModal","IONIC_BACK_PRIORITY",function(e,o,t,a,n,r,l,i,s,c){function p(e,o){o?e.$$hashKey=o:delete e.$$hashKey}function u(e,o){var t=e.$$hashKey;baseConfig.debug&&console.log(arguments);for(var a=1,n=arguments.length;n>a;a++){var r=arguments[a];if(r)for(var l=Object.keys(r),i=0,s=l.length;s>i;i++){var c=l[i];e[c]=r[c]}}return p(e,t),e}function d(){var e={};return e.scope=n.$new(),e.element=angular.element(h),e.responseDeferred=t.defer(),r.get().appendChild(e.element[0]),baseConfig.debug&&debug(e.element),l(e.element)(e.scope),u(e.scope,{title:"",$buttonTapped:function(){baseConfig.debug&&debug("$buttonTapped"),e.responseDeferred.resolve(1)}}),e.show=function(){e.isShown||e.removed||(s.stack.add(e),e.isShown=!0,ionic.requestAnimationFrame(function(){e.isShown&&f(e.element)}))},e.hide=function(o){return baseConfig.debug&&console.log("4 self.hide "+o),o=o||function(){},e.isShown?(s.stack.remove(e),e.isShown=!1,void a(o,250,!1)):o()},e.remove=function(){baseConfig.debug&&console.log("5 self.remove "),!e.removed&&s.stack.isHighest(e)&&(e.hide(function(){e.element.remove(),e.scope.$destroy()}),e.removed=!0)},e}function g(){var e=y[y.length-1];e&&e.responseDeferred.resolve()}function m(){function e(){y.push(o),baseConfig.debug&&console.log("popupStack.push(popup)"),a(o.show,t,!1),o.responseDeferred.promise.then(function(e){var t=y.indexOf(o);return-1!==t&&y.splice(t,1),baseConfig.debug&&console.log("popupStack.length"),y.length>0?y[y.length-1].show():(a(function(){!y.length},400,!1),(w._backButtonActionDone||function(){})()),o.remove(),e})}var o=$HmsHelp._createPopup(),t=0;return y.length>0?(y[y.length-1].hide(),t=b.stackPushDelay):w._backButtonActionDone=i.registerBackButtonAction(g,c.popup),o.responseDeferred.promise.close=function(e){o.removed||o.responseDeferred.resolve(e)},o.responseDeferred.notify({close:o.responseDeferred.close}),e(),o.responseDeferred.promise}function f(e){var o=e[0].querySelector("[autofocus]");o&&o.focus()}var h,b={stackPushDelay:75};h=ionic.Platform.isIOS()?'<div style="position: absolute;top:2px;left: -4px;bottom: 0;right: 0;background: url(img/mainHide.png); background-size: cover;;z-index: 12;"><div style="height: 100%;width: 100%;background: none" ng-click="$buttonTapped()"></div></div>':'<div style="position: absolute;top: -14px;left: -4px;bottom: 0;right: 0;background: url(img/mainHide.png); background-size: cover;;z-index: 12;"><div style="height: 100%;width: 100%;background: none" ng-click="$buttonTapped()"></div></div>';var y=[],w={showPopup:m,_createPopup:d,_popupStack:y};return w}]).factory("hmsFastPath",function(){var e={configFastPath:function(e,o,t){e.screenWidth={width:window.screen.width-50+"px"},e.scrollWidth=o.getWidth();var a=document.getElementsByTagName("ion-view"),n=a[a.length-1].attributes[0].value;e.currentStackList=o.getStackList(t,n),e.goStack=function(e){o.returnToState(e.stateName)}}};return e}),angular.module("myApp",["ionic","ngCordova","loginModule","baseConfig","messageModule","contactModule","applicationModule","myInfoModule","utilModule","tsApproveModule","HmsModule"]),angular.module("myApp").run(function(e){e.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!1),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}),angular.module("myApp").config(["$stateProvider","$urlRouterProvider","$httpProvider","$ionicConfigProvider",function(e,o,t,a){t.interceptors.push("httpRequestHeader"),a.platform.ios.tabs.style("standard"),a.platform.ios.tabs.position("bottom"),a.platform.android.tabs.style("standard"),a.platform.android.tabs.position("standard"),a.platform.ios.navBar.alignTitle("center"),a.platform.android.navBar.alignTitle("center"),a.platform.android.backButton.previousTitleText("").icon("ion-android-arrow-back"),a.platform.ios.views.transition("ios"),a.platform.android.views.transition("android"),e.state("tab",{url:"/tab","abstract":!0,templateUrl:"build/pages/tab/tabs.html",controller:"TabsCtrl"}).state("tab.message",{url:"/message",views:{"tab-message":{templateUrl:"build/pages/message/message.html",controller:"messageCtrl"}}}).state("tab.messageDetail",{url:"/messageDetail",params:{message:{}},views:{"tab-message":{templateUrl:"build/pages/message/detail/messageDetail.html",controller:"messageDetailCtrl"}}}).state("tab.contact",{url:"/contact",views:{"tab-contact":{templateUrl:"build/pages/contact/contact.html",controller:"contactCtrl"}}}).state("tab.application",{url:"/application",views:{"tab-application":{templateUrl:"build/pages/application/application.html",controller:"applicationCtrl"}}}).state("tab.myInfo",{url:"/myInfo",views:{"tab-myInfo":{templateUrl:"build/pages/myInfo/myInfo.html",controller:"myInfoCtrl"}}}).state("guide",{url:"/guide",templateUrl:"build/pages/guide/guide.html",controller:"guideCtrl"}).state("login",{url:"/login",templateUrl:"build/pages/login/login.html",controller:"loginCtrl"}),window.localStorage.token&&""!=window.localStorage.token?o.otherwise("/tab/message"):o.otherwise("/login")}]),angular.module("applicationModule").controller("applicationCtrl",["$scope","$state","baseConfig",function(e,o,t){e.animationsEnabled=!1,e.officeApp=[{list:[{appName:"会议管理",imageUrl:"build/img/application/meetingManage@3x.png",destUrl:""},{appName:"个人申请",imageUrl:"build/img/application/meetingManage@3x.png",destUrl:""},{appName:"报表分析",imageUrl:"build/img/application/meetingManage@3x.png",destUrl:""},{appName:"人事政策",imageUrl:"build/img/application/meetingManage@3x.png",destUrl:""}]},{list:[{appName:"假期管理",imageUrl:"build/img/application/holidayManage@3x.png",destUrl:"tab.time-off-manage"},{appName:"住宿申请",imageUrl:"build/img/application/dorm-apply/dorm-apply.png",destUrl:"tab.dorm-apply"},{appName:"Timesheet填写",imageUrl:"build/img/application/timesheet@3x.png",destUrl:"tab.timesheet"},{appName:"Timesheet审批",imageUrl:"build/img/application/timesheetExamine@3x.png",destUrl:"tab.tsApproveList"}]}],e.projectApp=[{list:[{appName:"机票预定",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"代办事项",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:"tab.workflow-list"},{appName:"报销单查询",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"首款查询",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""}]},{list:[{appName:"外勤汇报",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"",imageUrl:"",destUrl:""},{appName:"",imageUrl:"",destUrl:""},{appName:"",imageUrl:"",destUrl:""}]}],e.employeeApp=[{list:[{appName:"在线培训",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"知识门户",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"新闻",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"分享社区",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""}]}],e.openSetting=function(){e.animationsEnabled?e.animationsEnabled=!1:e.animationsEnabled=!0},e.goPage=function(e){t.debug&&console.log("appItem "+angular.toJson(e)),o.go(e.destUrl)},console.log("applicationCtrl.enter"),e.$on("$ionicView.enter",function(e){console.log("applicationCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){console.log("applicationCtrl.$destroy")})}]),angular.module("contactModule").controller("contactCtrl",["$scope","$state",function(e,o){console.log("contactCtrl.enter"),e.$on("$ionicView.enter",function(e){console.log("contactCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){console.log("contactCtrl.$destroy")})}]),angular.module("loginModule").controller("guideCtrl",["$scope","$state",function(e,o){console.log("loginCtrl.enter"),e.toLogin=function(){console.log("跳过导航页到登陆页"),o.go("login")},e.$on("$ionicView.enter",function(e){console.log("guideCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){console.log("guideCtrl.$destroy")})}]),angular.module("loginModule").controller("loginCtrl",["$scope","$state","baseConfig","$ionicLoading","$http","$timeout","$ionicHistory","hmsPopup",function(e,o,t,a,n,r,l,i){e.loginData={},e.currentVersionNum=t.versionName,window.localStorage.empno&&(e.loginData.username=window.localStorage.empno),window.localStorage.checkboxSavePwd||(e.checkboxSavePwd=!0,window.localStorage.checkboxSavePwd="true"),"true"==window.localStorage.checkboxSavePwd?(e.checkboxSavePwd=!0,e.loginData.password=window.localStorage.password):e.checkboxSavePwd=!1,t.debug&&console.log("loginCtrl.enter"),e.savePassword=function(){e.checkboxSavePwd=!e.checkboxSavePwd,t.debug&&console.log("此时密码框的状态为 :",angular.toJson(e.checkboxSavePwd)),""!==e.loginData.password&&(e.checkboxSavePwd===!0?window.localStorage.password=e.loginData.password:window.localStorage.password="")},e.clearUser=function(){e.loginData.username=""},e.clearPassword=function(){e.loginData.password=""},e.doLogin=function(){if(window.localStorage.empno=e.loginData.username,e.checkboxSavePwd?window.localStorage.password=e.loginData.password:window.localStorage.password="",!e.loginData.username||""==e.loginData.username)return void i.showPopup("用户名不能为空");if(!e.loginData.password||""==e.loginData.password)return void i.showPopup("密码不能为空");var a=t.basePath+"/appLogin/user_login/login",r={params:{p_user_name:+e.loginData.username,p_password:e.loginData.password}};i.showLoading("登陆中..."),n.post(a,r).success(function(a){i.hideLoading(),t.debug&&console.log("result success "+angular.toJson(a)),a.status||"S"!=a.con_status?i.showPopup("登陆失败,可能是密码不对!"):(window.localStorage.token=a.pre_token+a.token_key,window.localStorage.empno=e.loginData.username,window.localStorage.checkboxSavePwd=e.checkboxSavePwd,o.go("tab.message"))}).error(function(e,o){i.hideLoading(),t.debug&&console.log("response error "+angular.toJson(e))})},e.$on("$ionicView.enter",function(e){t.debug&&console.log("loginCtrl.$ionicView.enter"),r(function(){l.clearCache(),l.clearHistory()},400)}),e.$on("$destroy",function(e){t.debug&&console.log("loginCtrl.$destroy")})}]),angular.module("messageModule").controller("messageCtrl",["$scope","$state","$timeout","$ionicPlatform",function(e,o,t,a){e.messageList=[],a.ready(function(){window.StatusBar&&StatusBar.styleLightContent()}),e.talk=function(e){console.log("$scope.talk"),o.go("tab.messageDetail",{message:e})},e.refresh=function(){t(function(){e.$broadcast("scroll.refreshComplete")},2e3)},console.log("messageCtrl.enter"),e.$on("$ionicView.enter",function(e){console.log("messageCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){console.log("messageCtrl.$destroy")})}]),angular.module("myInfoModule").controller("myInfoCtrl",["$scope","$state","baseConfig",function(e,o,t){t.debug&&console.log("myInfoCtrl.enter"),e.logout=function(){window.localStorage.token="",window.localStorage.password="",window.localStorage.timesheetAuto="",window.localStorage.messagePush="",o.go("login")},e.setup=function(){o.go("tab.setup")},e.$on("$ionicView.enter",function(e){t.debug&&console.log("myInfoCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){t.debug&&console.log("myInfoCtrl.$destroy")})}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.setup",{url:"/setup",views:{"tab-myInfo":{templateUrl:"build/pages/myInfo/setup.html",controller:"SetupCtrl"}}})}]),angular.module("myInfoModule").controller("SetupCtrl",["$scope","baseConfig","$ionicHistory",function(e,o,t){window.localStorage.timesheetAuto||(e.timesheetAuto=!1,window.localStorage.timesheetAuto="false",o.debug&&console.log("timesheet自动填写功能默认关闭")),window.localStorage.messagePush||(e.messagePush=!1,window.localStorage.messagePush="false",o.debug&&console.log("消息推送功能默认关闭")),"true"==window.localStorage.timesheetAuto?(e.timesheetAuto=!0,o.debug&&console.log("打开timesheet自动填写功能")):(e.timesheetAuto=!1,o.debug&&console.log("关闭timesheet自动填写功能")),"true"==window.localStorage.messagePush?(e.messagePush=!0,o.debug&&console.log("打开消息推送功能")):(e.messagePush=!1,o.debug&&console.log("关闭消息推送功能")),e.clickTimesheetAuto=function(){e.timesheetAuto=!e.timesheetAuto,1==e.timesheetAuto?(window.localStorage.timesheetAuto="true",o.debug&&console.log("打开timesheet自动填写功能")):0==e.timesheetAuto&&(window.localStorage.timesheetAuto="false",o.debug&&console.log("关闭timesheet自动填写功能"))},e.clickMessagePush=function(){e.messagePush=!e.messagePush,1==e.messagePush?(window.localStorage.messagePush="true",o.debug&&console.log("打开消息推送功能")):0==e.messagePush&&(window.localStorage.messagePush="false",o.debug&&console.log("关闭消息推送功能"))},e.goBack=function(){t.goBack()}}]),angular.module("loginModule").controller("TabsCtrl",["$scope","$rootScope","$state","baseConfig",function(e,o,t,a){o.$on("$ionicView.beforeEnter",function(){var o=t.current.name;a.debug&&console.log("$ionicView.beforeEnter statename "+o),"tab.message"!=o&&"tab.application"!=o&&"tab.contact"!=o&&"tab.myInfo"!=o&&(e.hideTabs=!0)}),o.$on("$ionicView.afterEnter",function(){var o=t.current.name;a.debug&&console.log("$ionicView.afterEnter statename "+o),"tab.message"!==o&&"tab.application"!==o&&"tab.contact"!==o&&"tab.myInfo"!==o||(e.hideTabs=!1,e.$apply())})}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.dorm-apply-detail-a",{url:"/dorm-apply-detail-a",views:{"tab-application":{templateUrl:"build/pages/application/dorm-apply/dorm-apply-detail-a.html",controller:"DormApplyDetailFirstCtrl"}},params:{dormApplyDetailInfo:""}})}]),angular.module("applicationModule").controller("DormApplyDetailFirstCtrl",["$scope","$state","baseConfig","$ionicHistory","hmsHttp","hmsPopup","$rootScope","$timeout","$stateParams",function(e,o,t,a,n,r,l,i,s){e.applyInfo=s.dormApplyDetailInfo,e.approving=!1,e.rejected=!1,e.checkingin=!1,e.approvedResult="","审批中"==e.applyInfo.status?(e.approving=!0,e.rejected=!1,e.checkingin=!1,e.approvedResult=""):"已拒绝"==e.applyInfo.status?(e.approving=!1,e.rejected=!0,e.checkingin=!1,e.approvedResult="已拒绝"):"未入住"==e.applyInfo.status&&(e.approving=!1,e.rejected=!1,e.checkingin=!0,e.approvedResult="已通过"),e.goBack=function(){a.goBack()},e.cancelApply=function(){var o=t.businessPath+"/wfl_apply_room/cancel_application",i={params:{p_apply_id:e.applyInfo.applyId,p_employee_number:window.localStorage.empno}};r.showLoading("请稍候"),n.post(o,i).success(function(e){r.hideLoading();var o=e.message;r.showShortCenterToast(o),"S"==e.status&&(l.$broadcast("APPLY_CANCELLED"),a.goBack()),t.debug&&console.log("result success "+angular.toJson(e))}).error(function(e,o){r.hideLoading(),t.debug&&console.log("response error "+angular.toJson(e))})}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.dorm-apply-detail-b",{url:"/dorm-apply-detail-b",views:{"tab-application":{templateUrl:"build/pages/application/dorm-apply/dorm-apply-detail-b.html",controller:"DormApplyDetailSecondCtrl"}},params:{dormApplyDetailInfo:""}})}]),angular.module("applicationModule").controller("DormApplyDetailSecondCtrl",["$scope","$state","baseConfig","$ionicHistory","hmsHttp","hmsPopup","$rootScope","$timeout","$stateParams",function(e,o,t,a,n,r,l,i,s){e.applyInfo=s.dormApplyDetailInfo,e.checkIn=!1,e.checkOut=!1,e.buttonText="","已入住"==e.applyInfo.status?(e.checkIn=!0,e.checkOut=!1,e.buttonText="续住"):"已退房"==e.applyInfo.status&&(e.checkIn=!1,e.checkOut=!0,e.buttonText="再次预定"),e.goBack=function(){a.goBack()},e.renewContract=function(){var o=t.businessPath+"/wfl_apply_room/overstay_apply_room",i={params:{p_employee_number:window.localStorage.empno,p_pro_id:"",p_checkin_date:"20160815",p_checkout_date:"20160920",p_room_number:e.applyInfo.roomNumber,p_bed_number:e.applyInfo.bedNumber,p_apply_type:e.applyInfo.applyType,p_reason:""}};"项目申请"==e.applyInfo.applyType&&(i.params.p_pro_id=e.applyInfo.projectId),r.showLoading("请稍候"),n.post(o,i).success(function(e){r.hideLoading();var o=e.message;r.showShortCenterToast(o),"S"==e.status&&(l.$broadcast("APPLY_SUCCESS"),a.goBack()),t.debug&&console.log("result success "+angular.toJson(e))}).error(function(e,o){r.hideLoading(),t.debug&&console.log("response error "+angular.toJson(e))})}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.dorm-apply-vacant-room",{url:"/dorm-apply-vacant-room",views:{"tab-application":{templateUrl:"build/pages/application/dorm-apply/dorm-apply-vacant-room.html",controller:"DormApplyVacantRoomCtrl"}},params:{dormApplySearchResult:"",projectId:"",applyType:""}})}]),angular.module("applicationModule").controller("DormApplyVacantRoomCtrl",["$scope","$rootScope","$state","baseConfig","$ionicHistory","hmsHttp","hmsPopup","$timeout","$stateParams",function(e,o,t,a,n,r,l,i,s){var c=s.dormApplySearchResult,p=s.projectId,u=s.applyType;e.roomlist=c.result,e.goBack=function(){n.goBack()},e.applyRoom=function(t){var i=a.businessPath+"/wfl_apply_room/apply_room",s={params:{p_employee_number:window.localStorage.empno,p_pro_id:"",p_checkin_date:c.checkinDate,p_checkout_date:c.checkoutDate,p_room_number:e.roomlist[t].room_number,p_bed_number:e.roomlist[t].bed_number,p_apply_type:c.applyType,p_reason:""}};"项目申请"==u&&(s.params.p_pro_id=p),l.showLoading("请稍候"),r.post(i,s).success(function(e){l.hideLoading();var t=e.message;l.showShortCenterToast(t),"S"==e.status&&(n.goBack(-2),o.$broadcast("APPLY_SUCCESS")),a.debug&&console.log("result success "+angular.toJson(e))}).error(function(e,o){l.hideLoading(),a.debug&&console.log("response error "+angular.toJson(e))})}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.dorm-apply",{url:"/dorm-apply",views:{"tab-application":{templateUrl:"build/pages/application/dorm-apply/dorm-apply.html",controller:"DormApplyCtrl"}}})}]),angular.module("applicationModule").controller("DormApplyCtrl",["$scope","$rootScope","$state","baseConfig","$ionicHistory","hmsHttp","hmsPopup","$ionicScrollDelegate","$timeout",function(e,o,t,a,n,r,l,i,s){function c(){e.items=[];var o=a.businessPath+"/wfl_apply_room/query_room_history_list",t={params:{p_employee_number:window.localStorage.empno}};r.post(o,t).success(function(o){a.debug&&console.log("result success "+angular.toJson(o)),e.items=o.result,angular.forEach(e.items,function(e,o,t){"已入住"==t[o].apply_status?(t[o].modeCheckIn=!0,t[o].modeCheckOut=!1,t[o].modeApproving=!1,t[o].modeRejected=!1,t[o].modeCheckingIn=!1):"已退房"==t[o].apply_status?(t[o].modeCheckIn=!1,t[o].modeCheckOut=!0,t[o].modeApproving=!1,t[o].modeRejected=!1,t[o].modeCheckingIn=!1):"审批中"==t[o].apply_status?(t[o].modeCheckIn=!1,t[o].modeCheckOut=!1,t[o].modeApproving=!0,t[o].modeRejected=!1,t[o].modeCheckingIn=!1):"已拒绝"==t[o].apply_status?(t[o].modeCheckIn=!1,t[o].modeCheckOut=!1,t[o].modeApproving=!1,t[o].modeRejected=!0,t[o].modeCheckingIn=!1):"未入住"==t[o].apply_status&&(t[o].modeCheckIn=!1,t[o].modeCheckOut=!1,t[o].modeApproving=!1,t[o].modeRejected=!1,t[o].modeCheckingIn=!0)})}).error(function(e,o){l.hideLoading(),a.debug&&console.log("response error "+angular.toJson(e))})}e.descriptionAppearance=!1,e.items=[],c(),e.goBack=function(){n.goBack()},e.createNewDormApply=function(){t.go("tab.new-dorm-apply")},e.viewApplyDetail=function(o){var a=e.items[o],n={status:a.apply_status,checkinDate:a.checkin_date,checkoutDate:a.checkout_date,applyType:a.apply_type,floorNumber:a.floor_number,roomNumber:a.room_number,roomType:a.room_type,bedNumber:a.bed_number,applyId:a.apply_id,projectId:a.project_id};"已入住"==n.status||"已退房"==n.status?t.go("tab.dorm-apply-detail-b",{dormApplyDetailInfo:n}):"审批中"!=n.status&&"已拒绝"!=n.status&&"未入住"!=n.status||t.go("tab.dorm-apply-detail-a",{dormApplyDetailInfo:n})},e.judgeApplyType=function(e){var o=e.apply_status;return"已入住"==o||"已退房"==o||"未入住"==o?!0:"审批中"==o||"已拒绝"==o?!1:void 0},e.showDescription=function(){e.descriptionAppearance=!0;
},e.hideDescription=function(){e.descriptionAppearance=!1},o.$on("APPLY_SUCCESS",function(){s(function(){i.$getByHandle("dormScroll").scrollTop(!1)},200),c()}),o.$on("APPLY_CANCELLED",function(){s(function(){i.$getByHandle("dormScroll").scrollTop(!1)},200),c()})}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.new-dorm-apply",{url:"/new-dorm-apply",views:{"tab-application":{templateUrl:"build/pages/application/dorm-apply/new-dorm-apply.html",controller:"NewDormApplyCtrl"}}})}]),angular.module("applicationModule").controller("NewDormApplyCtrl",["$scope","$state","baseConfig","$ionicHistory","$ionicModal","hmsHttp","hmsPopup",function(e,o,t,a,n,r,l){n.fromTemplateUrl("build/pages/application/dorm-apply/modal/new-dorm-apply-choose-apply-type.html",{scope:e}).then(function(o){e.chooseTypePopup=o}),n.fromTemplateUrl("build/pages/application/dorm-apply/modal/new-dorm-apply-choose-room-type.html",{scope:e}).then(function(o){e.chooseRoomPopup=o}),n.fromTemplateUrl("build/pages/application/dorm-apply/modal/new-dorm-apply-choose-project-name.html",{scope:e}).then(function(o){e.chooseProjectPopup=o}),e.defaultApplyType="常驻申请",e.defaultRoomType="单人间",e.defaultProjectInfo={projectName:"",projectId:""},e.showProjectItem=!1,e.applytype=["常驻申请","加班申请","临时申请","项目申请"],e.roomtype=["单人间","四人间"],e.projectlist=[],e.showNumButton=!0,e.inputinfo={floornum:"",roomnum:""};var i=t.businessPath+"/wfl_apply_room/query_project_list",s={params:{p_employee_number:window.localStorage.empno}};l.showLoading("请稍候"),r.post(i,s).success(function(o){l.hideLoading(),"S"==o.status&&(e.projectlist=o.result,e.projectlist=e.projectlist.splice(1,e.projectlist.length-1),e.projectlist.length>0?(e.defaultProjectInfo.projectName=e.projectlist[0].project_name,e.defaultProjectInfo.projectId=e.projectlist[0].project_id,console.log(angular.toJson(e.defaultProjectInfo))):0==e.projectlist.length&&(e.defaultProjectInfo.projectName="无",e.defaultProjectInfo.projectId="")),t.debug&&console.log("result success "+angular.toJson(o))}).error(function(e){l.hideLoading(),t.debug&&console.log("response error "+angular.toJson(e))}),e.goBack=function(){a.goBack()},e.chooseApplyType=function(){e.chooseTypePopup.show()},e.chooseRoomType=function(){e.chooseRoomPopup.show()},e.chooseProjectName=function(){0==e.projectlist.length?l.showShortCenterToast("项目列表为空，请更改申请类型"):e.projectlist.length>0&&e.chooseProjectPopup.show()},e.finishChoosingApplyType=function(o){e.defaultApplyType=o,"项目申请"==e.defaultApplyType?e.showProjectItem=!0:"项目申请"!=e.defaultApplyType&&(e.showProjectItem=!1),e.chooseTypePopup.hide()},e.finishChoosingRoomType=function(o){e.defaultRoomType=o,e.chooseRoomPopup.hide()},e.finishChoosingProjectName=function(o){e.defaultProjectInfo.projectName=e.projectlist[o].project_name,e.defaultProjectInfo.projectId=e.projectlist[o].project_id,e.chooseProjectPopup.hide()},e.chooseDays=function(){"常驻申请"==e.defaultApplyType&&(e.showNumButton=!e.showNumButton)},e.searchVacantRoom=function(){if("无"==e.defaultProjectInfo.projectName&&"项目申请"==e.defaultApplyType)l.showShortCenterToast("项目列表为空，请更改申请类型");else{var a=t.businessPath+"/wfl_apply_room/query_free_room_list",n={params:{p_employee_number:window.localStorage.empno,p_check_in_date:"20160615",p_check_out_date:"20160720",p_apply_type:e.defaultApplyType,p_room_type:e.defaultRoomType,p_room_number:e.inputinfo.roomnum,p_floor_number:e.inputinfo.floornum,p_pro_id:""}};"项目申请"==e.defaultApplyType&&(n.params.p_pro_id=e.defaultProjectInfo.projectId),l.showLoading("请稍候"),r.post(a,n).success(function(a){var r=a.message;if(l.hideLoading(),"S"==a.status&&a.result.length>0){var i=a.result,s={applyType:n.params.p_apply_type,checkinDate:n.params.p_check_in_date,checkoutDate:n.params.p_check_out_date,result:i};o.go("tab.dorm-apply-vacant-room",{dormApplySearchResult:s,projectId:e.defaultProjectInfo.projectId,applyType:e.defaultApplyType})}else"E"==a.status&&l.showShortCenterToast(r);t.debug&&console.log("result success "+angular.toJson(a))}).error(function(e,o){l.hideLoading(),t.debug&&console.log("response error "+angular.toJson(e))})}}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.time-off-manage",{url:"/time-off-manage",views:{"tab-application":{templateUrl:"build/pages/application/time-off-manage/timeOffManageList.html",controller:"TimeOffManageCtrl"}}})}]),angular.module("applicationModule").controller("TimeOffManageCtrl",["$scope","$state","baseConfig","$ionicHistory",function(e,o,t,a){}]),angular.module("messageModule").controller("messageDetailCtrl",["$scope","$state","$stateParams","$ionicHistory",function(e,o,t,a){var n=t.message;console.log("message : "+angular.toJson(n)),e.message=n,e.goBack=function(){a.goBack()},e.$on("$ionicView.enter",function(e){console.log("messageDetailCtrl.$ionicView.enter")}),console.log("messageDetailCtrl.enter"),e.$on("$destroy",function(e){console.log("messageDetailCtrl.$destroy")})}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.workflow-list",{url:"/workflow-list",params:{day:{}},views:{"tab-application":{templateUrl:"build/pages/workflow/list/workflow-list.html",controller:"WorkFLowListCtrl"}}})}]),angular.module("applicationModule").controller("WorkFLowListCtrl",["$scope","$state","$stateParams","$ionicModal","$timeout","baseConfig","TimeSheetService","hmsPopup","WorkFLowListService",function(e,o,t,a,n,r,l,i,s){e.list=[],e.fetchDataFlag=!0,e.pullRefreshDataFlag=!1,e.listStatus={todo:{selected:!0},done:{selected:!1}};var c="build/img/application/profile@3x.png",p="工作流类型",u="当前节点",d="提交人";e.fetchTodoList=function(){e.listStatus.todo.selected||e.fetchDataFlag||e.pullRefreshDataFlag||(e.listStatus.todo.selected=!0,e.listStatus.done.selected=!1,g(!1))},e.fetchDoneList=function(){e.listStatus.done.selected||e.fetchDataFlag||e.pullRefreshDataFlag||(e.listStatus.done.selected=!0,e.listStatus.todo.selected=!1,m(!1))};var g=function(o){e.list=[],o?(e.fetchDataFlag=!1,e.pullRefreshDataFlag=!0):e.fetchDataFlag=!0;var t=function(t){var a=t.待审批列表;angular.forEach(a,function(o){var t={title1:o.workflow_name,icon:c,type:p,typeValue:o.workflow_name,node:u,nodeValue:o.current_node,submit:d,submitPerson:o.employee_name};e.list.push(t)}),e.fetchDataFlag=!1,o&&(e.pullRefreshDataFlag=!1,e.$broadcast("scroll.refreshComplete"))},a=function(t){e.fetchDataFlag=!1,o&&(e.pullRefreshDataFlag=!1,e.$broadcast("scroll.refreshComplete"))};n(function(){s.getTodoList("N",t,a)},2e3)},m=function(o){e.list=[],o?(e.fetchDataFlag=!1,e.pullRefreshDataFlag=!0):e.fetchDataFlag=!0;var t=function(t){var a=t.已审批列表;angular.forEach(a,function(o){var t={title1:o.workflow_desc,icon:c,type:p,typeValue:o.workflow_desc,node:u,nodeValue:o.status_name,submit:d,submitPerson:o.created_by_name};e.list.push(t)}),e.fetchDataFlag=!1,o&&(e.pullRefreshDataFlag=!1,e.$broadcast("scroll.refreshComplete"))},a=function(t){e.fetchDataFlag=!1,o&&(e.pullRefreshDataFlag=!1,e.$broadcast("scroll.refreshComplete"))};n(function(){s.getTodoList("Y",t,a)},2e3)};g(!1),a.fromTemplateUrl("build/pages/application/timesheet-approve/modal/ts-filter-modal.html",{scope:e}).then(function(o){e.tsFilterModal=o}),e.filterTsInfo=function(){e.tsFilterModal.show()},e.refresh=function(){e.fetchDataFlag?e.$broadcast("scroll.refreshComplete"):(e.list=[],e.$apply(),n(function(){e.listStatus.todo.selected?g(!0):m(!0)},300))}}]).service("WorkFLowListService",["hmsHttp","baseConfig","hmsPopup",function(e,o,t){this.getTodoList=function(a,n,r){var l=o.businessPath+"/wfl_wx_workflow_appr/get_instance_list",i={params:{p_employee_code:window.localStorage.empno,p_flag:a+""}};e.post(l,i).success(function(e){n(e)}).error(function(e,o){t.showPopup("获取代办事项出错,可能是网络问题!"),r(e)})}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.timesheet",{url:"/timesheet",views:{"tab-application":{templateUrl:"build/pages/application/timesheet/query/query.html",controller:"TimeSheetQueryCtrl"}}})}]),angular.module("applicationModule").controller("TimeSheetQueryCtrl",["$scope","$state","baseConfig","$ionicHistory","$timeout","$ionicScrollDelegate","TimeSheetService","hmsHttp",function(e,o,t,a,n,r,l,s){e.calendar=[];var c=!0;e.loadingDataFlag=!0;var p=function(){for(e.calendar=[],i=0;i<5;i++){var o="each-day",t="day-item",a="",n="",r={week:i,list:[]};for(j=0;j<7;j++){var l={day:i+""+j,style_outline:o,style_color:t,money:a,project:n};r.list.push(l)}e.calendar.push(r)}};test=function(){var e=t.businessPath+"/wfl_timesheet_view/get_timesheet_list",o={params:{p_employee_number:"4040",p_start_date:"2015-11-01",p_end_date:"2015-11-01",p_project_name:"",p_project_id:"",p_project_person_number:"",p_page:"1",p_line_number:"5"}};s.post(e,o).success(function(e){t.debug&&console.log("result success "+angular.toJson(e))}).error(function(e,o){t.debug&&console.log("response error "+angular.toJson(e))})},test(),p(),e.writeTimesheet=function(e){o.go("tab.timesheet-write",{day:e})},e.scrollToFixScreen=function(){c?(r.scrollTo(0,400,!0),c=!1):(r.scrollTo(0,0,!0),c=!0)};var u=function(o){var t=o.timesheet,a=0;for(e.calendar=[],i=0;i<5;i++){var n={week:i,list:[]};for(j=0;j<7;j++){var r,l="each-day",s="day-item",c="",p="",u=!1;t[a]?(u="0"!=t[a].lockflag,"Empty"==t[a].status?(l="each-day",s="day-item"):"Draft"==t[a].status?(l="each-day attendance",s="day-item attendance"):"Approved"==t[a].status?(l="each-day approve",s="day-item approve"):"Rejected"==t[a].status&&(l="each-day reject",s="day-item reject"),r={day:t[a].day.replace("0",""),style_outline:l,style_color:s,money:t[a].allowance,project:t[a].proj,each_day:t[a].each_day,lockFlag:u}):r={day:"",style_outline:l,style_color:s,money:c,project:p,each_day:"",lockFlag:u},n.list.push(r),a+=1}e.calendar.push(n)}},d=function(o){p(),e.loadingDataFlag=!0;var a=t.businessPath+"/timesheet_process/fetch_calendar",n={params:{p_employee:window.localStorage.empno,p_month:o+"",p_offset:1}};s.post(a,n).success(function(o){u(o),e.loadingDataFlag=!1,t.debug&&console.log("result success "+angular.toJson(o))}).error(function(o,a){e.loadingDataFlag=!1,e.$apply(),t.debug&&console.log("response error "+angular.toJson(o))})};d("201511"),e.getTimeSheet=function(e){d(e)},e.goBack=function(){a.$ionicGoBack()},t.debug&&console.log("applicationCtrl.enter"),e.$on("$ionicView.enter",function(e){t.debug&&console.log("applicationCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){t.debug&&console.log("applicationCtrl.$destroy")})}]).service("TimeSheetService",["baseConfig","hmsHttp","hmsPopup",function(e,o,t){this.fetchCalendar=function(){var t=e.businessPath+"/timesheet_process/fetch_calendar",a={params:{p_employee:window.localStorage.empno,p_month:"201511",p_offset:1}};o.post(t,a).success(function(o){e.debug&&console.log("result success "+angular.toJson(o))}).error(function(o,t){e.debug&&console.log("response error "+angular.toJson(o))})},this.fetchEachDay=function(a){var n=e.businessPath+"/timesheet_process/fetch_projects",r={params:{p_employee:window.localStorage.empno+"",p_date:"20151013"}};o.post(n,r).success(function(e){a(e)}).error(function(e,o){t.hideLoading(),t.showPopup("获取状态错误,请检查")})}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.timesheet-write",{url:"/timesheet-write",params:{day:{}},views:{"tab-application":{templateUrl:"build/pages/application/timesheet/write/write.html",controller:"TimeSheetWriteCtrl"}}})}]),angular.module("applicationModule").controller("TimeSheetWriteCtrl",["$scope","$state","$stateParams","$ionicModal","$timeout","baseConfig","TimeSheetService","hmsPopup",function(e,o,t,a,n,r,l,i){var s="ion-ios-checkmark",c="ion-ios-circle-outline";e.projectList=[],e.addressList=[],e.flybackList=[],e.timesheetDetail={currentDay:"",approver:"",currentProject:{},currentAddress:{},currentFlyback:{},travelingAllowance:{flag:!1,style:c},normalAllowance:{flag:!1,style:c},charging:{flag:!1,style:c},description:""},r.debug&&console.log("$stateParams.day "+angular.toJson(t.day)),a.fromTemplateUrl("build/pages/application/timesheet/write/modal/projectModal.html",{scope:e}).then(function(o){e.projectModal=o}),a.fromTemplateUrl("build/pages/application/timesheet/write/modal/addressModal.html",{scope:e}).then(function(o){e.addressModal=o}),a.fromTemplateUrl("build/pages/application/timesheet/write/modal/flybackList.html",{scope:e}).then(function(o){e.flybackModal=o}),e.showProjectModal=function(){e.projectModal.show()},e.hideProjectModal=function(){e.projectModal.hide()},e.showFlybackModal=function(){e.flybackModal.show()},e.hideFlybackModal=function(){e.flybackModal.hide()},e.showAddressModal=function(){e.addressModal.show()},e.hideAddressModal=function(){e.addressModal.hide()};var p=function(o){if(i.hideLoading(),"S"==o.status){var t=o.project,a=o.flyback,n=o.projaddress;"1"===o.every_day.offbase?e.timesheetDetail.travelingAllowance={flag:!0,style:s}:e.timesheetDetail.travelingAllowance={flag:!1,style:c},"Y"===o.every_day.base?e.timesheetDetail.normalAllowance={flag:!0,style:s}:e.timesheetDetail.normalAllowance={flag:!1,style:c},"1"===o.every_day.externalcharge?e.timesheetDetail.charging={flag:!0,style:s}:e.timesheetDetail.charging={flag:!1,style:c},e.timesheetDetail.currentDay=o.every_day.every_day,e.timesheetDetail.approver=o.every_day.approver,e.timesheetDetail.description=o.every_day.descrpt,e.timesheetDetail.allowance=o.every_day.allowance,angular.forEach(t,function(o){return"Y"===o.selected_flag?void(e.timesheetDetail.currentProject=o):void 0}),angular.forEach(n,function(o){return"Y"===o.selected_flag?void(e.timesheetDetail.currentAddress=o):void 0}),angular.forEach(a,function(o){return"Y"===o.fly_select?void(e.timesheetDetail.currentFlyback=o):void 0}),e.projectList=t,e.addressList=n,e.flybackList=a}};e.checkBoxChanged=function(o,t){console.log("$scope.checkBoxChanged item "+angular.toJson(o)),o.flag?(o.flag=!1,o.style=c):(o.flag=!0,o.style=s),"travelingAllowance"==t&&e.timesheetDetail.travelingAllowance.flag&&(e.timesheetDetail.normalAllowance={flag:!1,style:c}),"normalAllowance"==t&&e.timesheetDetail.normalAllowance.flag&&(e.timesheetDetail.travelingAllowance={flag:!1,style:c})},e.submitTimesheet=function(e){r.debug&&console.log("timesheetDetail "+angular.toJson(e))},n(function(){i.showLoading("获取timesheet明细数据"),l.fetchEachDay(p)})}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.tsApproveDetail",{url:"application/tsApproveDetail",views:{"tab-application":{templateUrl:"build/pages/application/timesheet-approve/detail/ts-approve-detail.html",controller:"tsApproveDetailCtrl"}},params:{employeeNumber:"",projectId:"",startDate:"",endDate:""}})}]),tsApproveModule.controller("tsApproveDetailCtrl",["$scope","$state","baseConfig","$ionicHistory","$stateParams","hmsHttp","hmsPopup","$timeout",function(e,o,t,a,n,r,l,i){function s(){r.post(g,m).success(function(o){l.hideLoading(),r.isSuccessfull(o.status)?e.detailInfoArray=o.timesheet_approve_detail_response:"E"===o.status||"e"==o.status?l.showShortCenterToast("没有相关数据!"):l.showShortCenterToast("网络异常,请稍后重试!")}).error(function(e,o){l.hideLoading(),l.showShortCenterToast("服务请求异常,请检查网络连接和输入参数后重新操作!")})}function c(o){e.selectArray=[],u=[],angular.forEach(e.detailInfoArray,function(t,a){"undoSelectAll"==o?(e.selectArray.push(!1),u.push(!1)):"selectedAll"==o&&(e.selectArray.push(!0),u.push(!0))})}function p(){for(var e=0;e<b.approve_list.length;e++)"delete"===b.approve_list[e]&&(b.approve_list.splice(e,1),e--)}var u=[],d=!1;e.detailActionName="操作",e.showActionBar=!1,e.detailInfoArray={},e.selectArray=[];var g=t.businessPath+"/wfl_timesheet_view/query_timesheet_approve_list",m={params:{p_employee_number:n.employeeNumber,p_start_date:n.startDate.toString(),p_end_date:n.endDate.toString(),p_project_id:n.projectId}},f=t.businessPath+"/wfl_timesheet_view/timesheet_approve",h={params:{p_approve_flag:"AGREE",p_employee_number:window.localStorage.empno,p_param_json:""}},b={approve_list:[]};l.showLoading("加载中..."),s(),e.$on("$ionicView.enter",function(e){warn("tsApproveListCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){warn("tsApproveListCtrl.$destroy")}),c("undoSelectAll"),e.dealDetailInfo=function(){"操作"==e.detailActionName?(e.detailActionName="取消",e.showActionBar=!0,angular.element("#tsApproveItem").css("paddingLeft","6%")):"取消"==e.detailActionName&&(e.detailActionName="操作",e.showActionBar=!1,c("undoSelectAll"),angular.element("#tsApproveItem").css("paddingLeft","0"),h={params:{p_approve_flag:"AGREE",p_employee_number:window.localStorage.empno,p_param_json:""}},b={approve_list:[]})},e.selectItem=function(o,t){u[o]=!u[o];var a={p_project_id:e.detailInfoArray.project_id,p_project_person_number:e.detailInfoArray.employee_number,p_start_date:"",p_end_date:"",p_record_id:""};u[o]?(e.selectArray[o]=!0,a.p_record_id=t,b.approve_list[o]=a):(e.selectArray[o]=!1,b.approve_list.splice(o,1,"delete"))},e.selectAllDetail=function(){if(d=!d){c("selectedAll");for(var o=0;o<e.detailInfoArray.subsidy_list.length;o++){var t={p_project_id:e.detailInfoArray.project_id,p_project_person_number:e.detailInfoArray.employee_number,p_start_date:"",p_end_date:"",p_record_id:""};t.p_record_id=e.listInfoArray.subsidy_list[o].line_number,b.approve_list.push(t)}}else c("undoSelectAll"),b.approve_list=[]},e.passThroughDetailItem=function(){return 0===b.approve_list.length?void l.showShortCenterToast("请先选择操作项！"):(p(),h.params.p_approve_flag="AGREE",h.params.p_param_json=JSON.stringify(b),l.showLoading("审批中..."),void r.post(f,h).success(function(o){l.hideLoading(),r.isSuccessfull(o.status)?l.showShortCenterToast("审批成功！"):l.showShortCenterToast("审批失败！"),e.dealDetailInfo(),i(function(){l.showLoading("加载中..."),s()},1500)}).error(function(o){l.hideLoading(),l.showShortCenterToast("审批失败！请检查网络稍后重试"),e.dealDetailInfo(),i(function(){l.showLoading("加载中..."),s()},1500)}))},e.refuseDetailItem=function(){return 0===b.approve_list.length?void l.showShortCenterToast("请先选择操作项！"):(p(),h.params.p_approve_flag="REFUSE",h.params.p_param_json=JSON.stringify(b),l.showLoading("审批中..."),void r.post(f,h).success(function(o){l.hideLoading(),r.isSuccessfull(o.status)?l.showShortCenterToast("操作成功！"):l.showShortCenterToast("拒绝失败！"),e.dealDetailInfo(),i(function(){l.showLoading("加载中..."),s()},1500)}).error(function(o){l.hideLoading(),l.showShortCenterToast("拒绝失败！请检查网络稍后重试"),e.dealDetailInfo(),i(function(){l.showLoading("加载中..."),s()},1500)}))}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.tsApproveList",{url:"application/tsApproveList",views:{"tab-application":{templateUrl:"build/pages/application/timesheet-approve/list/ts-approve-list.html",controller:"tsApproveListCtrl"}}})}]),angular.module("tsApproveModule").controller("tsApproveListCtrl",["$scope","$state","baseConfig","$ionicModal","$ionicScrollDelegate","$ionicPopup","$timeout","TsApproveListService","hmsPopup","hmsHttp",function(e,o,t,a,n,r,l,i,s,c){function p(){e.showLsLoading=!0,c.post(y,v).success(function(o){c.isSuccessfull(o.status)&&(e.personList=unique_better(o.project_person_list,"employee_number"),e.projectList=unique_better(o.project_list,"project_id"))}).error(function(e){}),e.listInfoArray=new i(e,b,v,e.showLsLoading)}function u(o){e.selectArray=[],h=[],angular.forEach(e.listInfoArray,function(t,a){"undoSelectAll"==o?(e.selectArray.push(!1),h.push(!1)):"selectedAll"==o&&(e.selectArray.push(!0),h.push(!0))})}function d(){for(var e=0;e<S.approve_list.length;e++)"delete"===S.approve_list[e]&&(S.approve_list.splice(e,1),e--)}function g(){e.tsFilterModal.hide(),e.showProjectName=!0,e.isClickedProject=[],e.isClickedPerson=[],angular.element("#project-name").addClass("active-select"),angular.element("#project-name").removeClass("active-off"),angular.element("#person-select").removeClass("active-select")}e.showProjectName=!0,e.showRocket=!1,e.showConnectBlock=!1,e.showDetailArrow=!0,e.showLsLoading=!1;var m=!1;e.endApproveDate="",e.actionName="操作",e.selectArray=[],e.isClickedProject=[],e.selectEndItem=[!1,!0,!1],e.listInfoArray={},e.personList=[],e.projectList=[],e.endDateList=[{dateValue:getMonthDay(getLastMonthDate(new Date)).replace(/\b(0+)/gi,""),dateCode:getLastMonthDate(new Date)},{dateValue:getMonthDay(getCurrentDate(new Date)).replace(/\b(0+)/gi,""),dateCode:getCurrentDate(new Date)},{dateValue:getMonthDay(getCurrentMonthLastDate(new Date)).replace(/\b(0+)/gi,""),dateCode:getCurrentMonthLastDate(new Date)}];var f="",h=[],b=t.businessPath+"/wfl_timesheet_view/get_timesheet_list",y=t.businessPath+"/wfl_timesheet_view/get_project_person_list",w=t.businessPath+"/wfl_timesheet_view/timesheet_approve",v={params:{p_employee_number:window.localStorage.empno,p_start_date:"",p_end_date:"",p_project_name:"",p_project_id:"",p_project_person_number:"",p_page:1,p_page_size:6}},_={params:{p_approve_flag:"AGREE",p_employee_number:window.localStorage.empno,p_param_json:""}},S={approve_list:[]},$=(new Date).getDate();10>$?(v.params.p_end_date=getLastMonthDate(new Date),e.endApproveDate=getMonthDay(getLastMonthDate(new Date)).replace(/\b(0+)/gi,"")):$>10&&20>$?(v.params.p_end_date=getCurrentDate(new Date),e.endApproveDate=getMonthDay(getCurrentDate(new Date)).replace(/\b(0+)/gi,"")):$>20&&(v.params.p_end_date=getCurrentMonthLastDate(new Date),e.endApproveDate=getMonthDay(getCurrentMonthLastDate(new Date)).replace(/\b(0+)/gi,"")),p(),e.$on("$ionicView.enter",function(e){}),e.$on("$destroy",function(e){log("tsApproveListCtrl.$destroy")}),u("undoSelectAll"),e.doSelectAction=function(){"操作"==e.actionName?(e.actionName="取消",e.showDetailArrow=!1,angular.element(".ts-approve-list-item").css("paddingLeft","10%")):"取消"==e.actionName&&(e.actionName="操作",e.showDetailArrow=!0,angular.element(".ts-approve-list-item").css("paddingLeft","10px"),_={params:{p_approve_flag:"AGREE",p_employee_number:window.localStorage.empno,p_param_json:""}},S={approve_list:[]},u("undoSelectAll"))},a.fromTemplateUrl("build/pages/application/timesheet-approve/modal/ts-date-modal.html",{scope:e}).then(function(o){e.dateModal=o}),e.selectEndDate=function(){v.params.p_end_date=e.endApproveDate,e.dateModal.show()},e.selectEndDateItem=function(o,t,a){e.selectEndItem=[],e.selectEndItem[a]=!0,e.endApproveDate=t,v.params.p_page=1,v.params.p_end_date=o,e.listInfoArray=new i(e,b,v,e.showLsLoading),e.dateModal.hide()},e.cancelDateModal=function(){v.params.p_end_date=e.endApproveDate,e.dateModal.hide()},e.onDrag=function(){e.showConnectBlock=!1},e.onDragUp=function(){e.showConnectBlock=!0},e.watchScroll=function(){f=n.getScrollPosition().top,e.$apply(function(){0>f?e.showConnectBlock=!1:f>=0&&400>f?(e.showRocket=!1,e.showConnectBlock=!0):f>=400&&(e.showRocket=!0)})},e.tsListRefresh=function(){v.params.p_page=1,e.listInfoArray=new i(e,b,v,e.showLsLoading)},e.getAttentionInfo=function(o,t){e.showDetailArrow&&(o.stopPropagation(),warn(t),r.show({template:'<div class="warn-attention-icon">'+t[0].description+"</div>",scope:e,buttons:[{text:'<div class="warn-cancel-icon"></div>',type:"button-clear",onTap:function(e){}}]}))},e.goTsLsTop=function(){angular.element("#rocket").addClass("ng-hide"),n.scrollTop(!0)},a.fromTemplateUrl("build/pages/application/timesheet-approve/modal/ts-filter-modal.html",{scope:e}).then(function(o){e.tsFilterModal=o}),e.filterTsInfo=function(){v.params.p_project_id="",v.params.p_project_person_number="",e.tsFilterModal.show()},e.goApproveDetail=function(t,a,n,r,l){if(e.showDetailArrow)o.go("tab.tsApproveDetail",{employeeNumber:a,projectId:n,startDate:r,endDate:l});else{h[t]=!h[t];var i={p_project_id:"",p_project_person_number:"",p_start_date:"",p_end_date:"",p_record_id:""};h[t]?(e.selectArray[t]=!0,i.p_project_id=n,i.p_project_person_number=a,i.p_start_date=r,i.p_end_date=l,S.approve_list[t]=i):(S.approve_list.splice(t,1,"delete"),e.selectArray[t]=!1)}},e.selectAllList=function(){if(m=!m){for(var o=0;o<e.listInfoArray.listArray.length;o++){var t={p_project_id:"",p_project_person_number:"",p_start_date:"",p_end_date:"",p_record_id:""};t.p_project_id=e.listInfoArray.listArray[o].project_id,t.p_project_person_number=e.listInfoArray[o].employee_number,t.p_start_date=e.listInfoArray[o].start_date,t.p_end_date=e.listInfoArray[o].end_date,S.approve_list.push(t)}u("selectedAll")}else S.approve_list=[],u("undoSelectAll")},e.passThroughListItem=function(){return 0===S.approve_list.length?void s.showShortCenterToast("请先选择操作项！"):(d(),_.params.p_approve_flag="AGREE",_.params.p_param_json=JSON.stringify(S),s.showLoading("审批中..."),void c.post(w,_).success(function(o){s.hideLoading(),c.isSuccessfull(o.status)?s.showShortCenterToast("审批成功！"):s.showShortCenterToast("审批失败！"),e.doSelectAction(),l(function(){e.tsListRefresh()},1500)}).error(function(o){s.hideLoading(),s.showShortCenterToast("审批失败！请检查网络稍后重试"),e.doSelectAction(),l(function(){e.tsListRefresh()},1500)}))},e.refuseListItem=function(){return 0===S.approve_list.length?void s.showShortCenterToast("请先选择操作项！"):(d(),_.params.p_approve_flag="REFUSE",_.params.p_param_json=JSON.stringify(S),s.showLoading("审批中..."),void c.post(w,_).success(function(o){s.hideLoading(),c.isSuccessfull(o.status)?s.showShortCenterToast("拒绝成功！"):s.showShortCenterToast("拒绝失败！"),e.doSelectAction(),l(function(){e.tsListRefresh()},1500)}).error(function(o){s.hideLoading(),s.showShortCenterToast("拒绝失败！请检查网络稍后重试"),e.doSelectAction(),l(function(){e.tsListRefresh()},1500)}))},e.selectScreening=function(o){"projectName"==o?(e.showProjectName=!0,angular.element("#project-name").addClass("active-select"),angular.element("#project-name").removeClass("active-off"),angular.element("#person-select").removeClass("active-select")):"personSelect"==o&&(e.showProjectName=!1,angular.element("#person-select").addClass("active-select"),angular.element("#project-name").addClass("active-off"))},e.selectFilterItem=function(o,t,a){"projectName"===o?(e.isClickedProject=[],e.isClickedProject[t]=!0,v.params.p_project_id=a):"personSelect"===o&&(e.isClickedPerson=[],e.isClickedPerson[t]=!0,v.params.p_project_person_number=a)},e.cancelFilter=function(){v.params.p_project_id="",v.params.p_project_person_number="",g()},e.confirmFilter=function(){g(),v.params.p_page=1,e.showLsLoading=!0,e.listInfoArray=new i(e,b,v,e.showLsLoading)},e.clearFilterParams=function(){e.isClickedProject=[],e.isClickedPerson=[],v.params.p_project_id="",v.params.p_project_person_number=""}}]).service("TsApproveListService",["hmsHttp","baseConfig","hmsPopup",function(e,o,t){var a=function(a,n,r,l,i){var s=this;s.scope=a,s.url=n,s.params={},s.params=r,s.refurbishParam=i,s.busy=!1,s.totalNumber=0,s.listArray=[],s.loading=l,"clickRefreshEvent"===s.refurbishParam&&s.scope.$broadcast("scroll.infiniteScrollComplete"),e.post(s.url,s.params).success(function(a){s.loading=!1;try{if(e.isSuccessfull(a.status)){var n=a.timesheet_approve_response;o.debug&&warn("hi,create a new factory!!\n"+jsonFormat()),s.totalNumber=a.count;try{s.listArray=s.listArray.concat(n.result_list)}catch(r){s.listArray=[],s.projectList=[],s.employeeList=[]}0==a.count?(s.busy=!1,s.listArray=[]):a.count<=6?s.busy=!1:s.busy=!0,s.scope.$broadcast("scroll.refreshComplete"),s.scope.$broadcast("scroll.infiniteScrollComplete")}else s.busy=!1,"E"===a.status||"e"==a.status?t.showShortCenterToast("没有相关数据!"):t.showShortCenterToast("网络异常,请稍后重试!"),s.scope.$broadcast("scroll.refreshComplete"),s.scope.$broadcast("scroll.infiniteScrollComplete")}catch(r){}}.bind(s)).error(function(e){s.loading=!1,s.params.params.p_page=1,s.busy=!1,s.scope.$broadcast("scroll.refreshComplete"),s.scope.$broadcast("scroll.infiniteScrollComplete"),t.showShortCenterToast("服务请求异常,请检查网络连接和输入参数后重新操作!")}.bind(s))};return a.prototype.nextPage=function(){var a=this;if(o.debug&&warn("enter next page!"),a.busy){if(a.busy&&"clickRefreshEvent"===a.refurbishParam)return a.refurbishParam="",void a.scope.$broadcast("scroll.infiniteScrollComplete");a.busy=!0,a.params.params.p_page++,e.post(a.url,a.params).success(function(o){try{if(e.isSuccessfull(o.status)){if(angular.isUndefined(o.timesheet_approve_response.result_list))a.busy=!1,t.showShortCenterToast("数据已经加载完毕!");else{var n=o.timesheet_approve_response;a.listArray=a.listArray.concat(n.result_list)}a.scope.$broadcast("scroll.infiniteScrollComplete")}else"E"===o.status&&(a.params.params.p_page--,t.showShortCenterToast("数据请求错误,请检查传入参数重新操作!")),a.scope.$broadcast("scroll.infiniteScrollComplete")}catch(r){a.params.params.p_page--,a.scope.$broadcast("scroll.infiniteScrollComplete")}}.bind(a)).error(function(e){a.params.params.p_page--,a.scope.$broadcast("scroll.infiniteScrollComplete"),t.showShortCenterToast("网络异常,请稍后重试!")}.bind(a))}},a}]);
=======
function jsonFormat(e){var o=angular.toJson(e,!0);return o}function getCurrentDate(e){var o=e.getFullYear(),t=e.getMonth()+1,a=e.getDate();t=10>t?"0"+t:t,a=10>a?"0"+a:a;var n=o.toString()+t.toString()+a.toString();return n}function getLastMonthDate(e){var o=e.getFullYear(),t=e.getMonth(),a=new Date(o,t,1),n=new Date(a.getTime()-864e5).getDate();t=10>t?"0"+t:t,n=10>n?"0"+n:n;var l=o.toString()+t.toString()+n.toString();return l}function getCurrentMonthLastDate(e){var o=e.getFullYear(),t=e.getMonth()+1,a=new Date(o,t,1),n=new Date(a.getTime()-864e5).getDate();t=10>t?"0"+t:t,n=10>n?"0"+n:n;var l=o.toString()+t.toString()+n.toString();return l}angular.module("baseConfig",[]).constant("baseConfig",{debug:!0,isMobilePlatform:!1,clearTable:!0,nativeScreenFlag:!1,basePath:"http://wechat.hand-china.com/hmbms_hand/api",businessPath:"http://wechat.hand-china.com/hmbms_hand/api/dataEngine",currentVersion:"2.0.0",url:"",pkgIdentifier:"",versionName:"此版本为dev测试环境 2.0.0",appEnvironment:"UAT"});var utilModule=angular.module("utilModule",[]),HmsModule=angular.module("HmsModule",[]),loginModule=angular.module("loginModule",[]),messageModule=angular.module("messageModule",[]),contactModule=angular.module("contactModule",[]),applicationModule=angular.module("applicationModule",[]),myInfoModule=angular.module("myInfoModule",[]),tsApproveModule=angular.module("tsApproveModule",[]);HmsModule.directive("hideTabs",function(e){return{restrict:"A",link:function(o,t,a){o.$on("$ionicView.beforeEnter",function(){o.$watch(a.hideTabs,function(o){console.log("$ionicView.beforeEnter value "+o),o?e.hideTabs=!1:e.hideTabs=!0})}),o.$on("$ionicView.beforeLeave",function(){e.hideTabs=!0,console.log("$ionicView.beforeLeave value ")})}}}).directive("elasticImage",function(e){return{restrict:"A",link:function(e,o,t){var a=document.getElementById(t.elasticImage),n=a.offsetHeight;o.bind("scroll",function(e){var o=e.detail.scrollTop,t=n-o;0>t&&(t=0),a.style.height=t+"px"})}}}).directive("circleRotate",function(e){return{restrict:"A",link:function(o,t,a){var n=a.circleRotate,l=n.split(","),i=document.getElementById(l[0]),r=document.getElementById(l[1]),s=o.leftDays/o.totalDays;.5>=s?(i.style.transition="all 0.3s linear",i.style.webkitTransition="all 0.3s linear",r.style.transition="all 0.3s ease-out",r.style.webkitTransition="all 0.3s ease-out"):s>.5&&(i.style.transition="all 0.3s ease-out 0.3s",i.style.webkitTransition="all 0.3s ease-out 0.3s",r.style.transition="all 0.3s ease-in",r.style.webkitTransition="all 0.3s ease-in"),i.style.webkitTransform="rotate(-135deg)",i.style.transform="rotate(-135deg)",r.style.webkitTransform="rotate(-135deg)",r.style.transform="rotate(-135deg)",e(function(){var e=0;.5>=s?(e=360*s,e-=135,i.style.webkitTransform="rotate(-135deg)",i.style.transform="rotate(-135deg)",r.style.webkitTransform="rotate("+e+"deg)",r.style.transform="rotate("+e+"deg)"):s>.5&&(s-=.5,e=360*s,e-=135,i.style.webkitTransform="rotate("+e+"deg)",i.style.transform="rotate("+e+"deg)",r.style.webkitTransform="rotate(45deg)",r.style.transform="rotate(45deg)")},500)}}}),HmsModule.directive("footerSelect",function(){return{restrict:"E",scope:{selectAllItem:"&",passThrough:"&",refuse:"&"},template:'<ion-footer-bar class="foot-bar"><div class="row buttons"><button class="button button-clear ts-button-left" ng-click="selectAllItem()">全选</button><button class="button button-clear ts-button-center" ng-click="passThrough()">通过</button><button class="button button-clear ts-button-right" ng-click="refuse()">拒绝</button></div></ion-footer-bar>',replace:!0,transclude:!1,controller:["$scope",function(e){}],link:function(e,o,t,a){}}}),HmsModule.directive("customHeadBar",function(){return{restrict:"E",scope:{actionName:"@",customTitle:"@",goBackPage:"&",doAction:"&"},template:'<div class="custom-head"><div class="row custom-first-head"><button class="button button-clear back-button" ng-click="goBackPage()"><i class="ion-ios-arrow-back"></i><span class="back-text">返回</span></button><button class="button button-clear action-button" ng-click="doAction()" ng-bind="actionName"></button></div><div class="ts-list-title" ng-bind="customTitle"></div><div class="custom-second-head" ng-transclude></div></div>',replace:!0,transclude:!0,controller:["$scope",function(e){}],link:function(e,o,t,a){}}}),HmsModule.directive("hmsWorkflowList",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{title:"=workflowTitle",icon:"=workflowIcon",type:"=workflowType",typeValue:"=workflowTypeValue",node:"=workflowNode",nodeValue:"=workflowNodeValue",submit:"=workflowSubmit",submitPerson:"=workflowSubmitPerson"},template:'<a class="workflow-list"><div class="workflow-list-logo"><img src="{{icon}}"/></div><div class="workflow-list-header">{{title}}</div><div class="workflow-list-content"><div class="row no-padding"><div class="col col-90 no-padding"><div class="row no-padding"> <div class="col col-33 no-padding color-type">{{type}}</div><div class="col col-67 no-padding color-content">{{typeValue}}</div></div><div class="row no-padding"><div class="col col-33 no-padding color-type">{{node}}</div><div class="col col-67 no-padding color-content">{{nodeValue}}</div></div><div class="row no-padding"><div class="col col-33 no-padding color-type">{{submit}}</div><div class="col col-67 no-padding color-content">{{submitPerson}}</div></div></div><div class="col col-10 no-padding col-center workflow-list-select"><img src="build/img/workflow/select@3x.png"/></div></div></div></a>',controller:["$scope",function(e){}],link:function(e,o,t){}}}),angular.module("HmsModule").directive("hmsslidecalendar",["$animate","$timeout","$compile","$ionicHistory","$ionicScrollDelegate",function(e,o,t,a,n){return{restrict:"E",replace:!0,transclude:!0,scope:{autoPlay:"=",doesContinue:"@",slideInterval:"@",showPager:"@",pagerClick:"&",disableScroll:"@",onSlideChanged:"&",activeSlide:"=?",bounce:"@"},controller:["$scope","$element","$attrs",function(e,t,a){function n(e){return"undefined"!=typeof e}console.log("$element[0] "+angular.toJson(t[0]));var l=e.$eval(e.doesContinue)===!0,i=e.$eval(e.bounce)!==!1,r=n(a.autoPlay)?!!e.autoPlay:!1,s=r?e.$eval(e.slideInterval)||4e3:0;console.log("continuous "+l),console.log("bouncing "+i),console.log("shouldAutoPlay "+r),console.log("slideInterval "+s);var c=new ionic.views.calendar({el:t[0],auto:s,continuous:l,startSlide:e.activeSlide,bouncing:i,slidesChanged:function(){e.currentSlide=c.currentIndex(),o(function(){})},callback:function(t){e.currentSlide=t,e.onSlideChanged({index:e.currentSlide,$index:e.currentSlide}),e.$parent.$broadcast("slideBox.slideChanged",t),e.activeSlide=t,o(function(){})},onDrag:function(){console.log("slider.onDrag "),freezeAllScrolls(!0)},onDragEnd:function(){console.log("slider.onDragEnd "),freezeAllScrolls(!1)}});e.$watch("activeSlide",function(e){console.log("slider.scope.activeSlide "),n(e)&&c.slide(e)}),e.$on("slideBox.nextSlide",function(){console.log("slider.slideBox.nextSlide "),c.next()}),e.$on("slideBox.prevSlide",function(){console.log("slider.slideBox.prevSlide "),c.prev()}),e.$on("slideBox.setSlide",function(e,o){console.log("slider.slideBox.setSlide "),c.slide(o)}),this.__slider=c,e.$on("$destroy",function(){console.log("$destroy ")}),o(function(){})}],template:'<div class="slider"><div class="slider-slides" ng-transclude></div></div>',link:function(o,t,a){e.enabled(t,!1)}}}]),angular.module("utilModule").factory("httpRequestHeader",function(){var e={request:function(e){if(window.localStorage.token&&window.localStorage.empno){var o=(new Date).getTime(),t=CryptoJS.MD5(window.localStorage.token+o);e.headers.timestamp=o,e.headers.token=t,e.headers.loginName=window.localStorage.empno}return e}};return e}),HmsModule.filter("weekDay",function(){return function(e){if(""==e)return e;var o=new Date(e),t=o.getDay();switch(t){case 0:e+="　星期天";break;case 1:e+="　星期一";break;case 2:e+="　星期二";break;case 3:e+="　星期三";break;case 4:e+="　星期四";break;case 5:e+="　星期五";break;case 6:e+="　星期六"}return e}});var log=console.log.bind(console),warn=console.warn.bind(console),error=console.error.bind(console);angular.module("HmsModule").factory("hmsHttp",["$log","$http","hmsPopup",function(e,o,t){var a="HmsHttp",n="isSucessfull",l=a+".noAuthorPost",i=a+".post",r=a+".get",s=function(e){Prompter.hideLoading(),e.go("login")},c={goBackLogin:function(e){s(e)},isSuccessfull:function(o){return e.debug(n+" Start!"),e.debug(l+" status "+o),"S"==o||"SW"==o},post:function(t,a){e.debug(i+" Start!"),e.debug(i+" url "+t),e.debug(i+" paramter "+angular.toJson(a));var n=o.post(t,a).success(function(o){e.debug(i+" success"),e.debug(i+" response "+angular.toJson(o)),e.debug(i+" End!")}).error(function(o,t){e.debug(i+" error"),e.debug(i+" response "+o),e.debug(i+" status "+t),e.debug(i+" End!")});return n},get:function(t){e.debug(r+" Start!"),e.debug(r+" url "+t);var a=o.get(t).success(function(o){e.debug(r+" success"),e.debug(r+" response "+angular.toJson(o)),e.debug(r+" End!")}).error(function(o,t){e.debug(r+" error"),e.debug(r+" response "+o),e.debug(r+" status "+t),e.debug(r+" End!")});return a}};return c}]).service("hmsPopup",["$ionicLoading","$cordovaToast","$ionicPopup","baseConfig",function(e,o,t,a){this.showLoading=function(o){e.show({template:'<ion-spinner icon="ios" class="spinner spinner-ios spinner-stable"></ion-spinner><div style="color: white;font-size: 12px;text-align: center;height:25px;line-height: 25px;">'+o+"</div>"})},this.hideLoading=function(){e.hide()},this.showShortCenterToast=function(t){a.nativeScreenFlag?o.showLongBottom(angular.isDefined(t)?t:"操作失败").then(function(e){},function(e){}):e.show({template:angular.isDefined(t)?t:"操作失败",animation:"fade-in",showBackdrop:!1,maxWidth:200,duration:2e3})},this.showPopup=function(e,o){if(a.nativeScreenFlag){var n=function(){};navigator.notification.alert(e,n,"提示","确定")}else t.show({title:"提示",template:e,buttons:[{text:"确定",type:"button button-cux-popup-confirm"}]})},this.prompt=function(e,o,n,l){if(a.nativeScreenFlag)navigator.notification.prompt(o,l,"填写信息",["确定","退出"],"");else{var i=t.show({template:'<input type="type" ng-model="myScope.data.city">',title:o,subTitle:o,scope:e,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(o){return e.myScope.data.city?e.myScope.data.city:void o.preventDefault()}}]});i.then(n)}},this.confirm=function(e,o,n){if(a.nativeScreenFlag)navigator.notification.confirm(e,n,o,["确定","取消"]);else{var l=t.confirm({title:angular.isDefined(o)?o:"提示",template:e,cancelText:"取消",cancelType:"button-cux-popup-cancel",okText:"确定",okType:"button-cux-popup-confirm"});l.then(n)}}}]).factory("hmsReturnView",["$ionicHistory","baseConfig",function(e,o){var t=(window.screen.width-50,{width:""});return{go:function(o){var t=e.currentHistoryId(),a=e.viewHistory().histories[t],n=a.stack.length-1-o;e.backView(a.stack[n]),e.goBack()},returnToState:function(t){var a=e.currentHistoryId(),n=e.viewHistory().histories[a];o.debug&&console.log("history.stack.length : "+n.stack.length);for(var l=n.stack.length-1;l>=0;l--)o.debug&&console.log("history.stack[i].stateName : "+n.stack[l].stateName),n.stack[l].stateName==t&&(e.backView(n.stack[l]),e.goBack())},getStackList:function(e,t){var a=[],n=e.currentHistoryId(),l=e.viewHistory().histories[n];o.debug&&console.log(e.viewHistory());for(var i="#F99D32",r=0;r<l.stack.length;r++){r==l.stack.length-1&&(i="black");var s={viewId:l.stack[r].viewId,stateName:l.stack[r].stateName,title:l.stack[r].title,color:{color:i}};o.debug&&console.log(l.stack[r]),a.push(s)}return a[a.length-1].title=t,a},getWidth:function(){return t}}}]).factory("hmsBackLine",["$ionicHistory","baseConfig",function(e){var o,t=window.screen.width-50,a={width:""},n=0,l=[];return{getViews:function(e){o=e.toString().length,ROOTCONFIG.debug&&console.log(o);for(var i=0;i<l.length;i++)if(e==l[i].name){l=l.slice(0,i+1),n=0;for(var r=0;r<l.length;r++)n=r==l.length-1?n+14*l[r].name.toString().length+8:n+14*l[r].name.toString().length+18+8;console.log(n),t>n?a.width="":a.width=n+"px";for(var s=0;s<l.length-1;s++)l[s].myStyle.color="#F99D32";return console.log(l),l[l.length-1].myStyle.color="black",l}var c={name:e,myStyle:{color:""}};l.push(c),n=0;for(var p=0;i<l.length;p++)n=p==l.length-1?n+14*l[p].name.toString().length+8:n+14*l[p].name.toString().length+18+8;n>t&&(a.width=n+"px");for(var u=0;u<l.length-1;i++)l[u].myStyle.color="#F99D32";return l},getWidth:function(){return a}}}]).factory("$hmsHelp",["$ionicTemplateLoader","$ionicBackdrop","$q","$timeout","$rootScope","$ionicBody","$compile","$ionicPlatform","$ionicModal","IONIC_BACK_PRIORITY",function(e,o,t,a,n,l,i,r,s,c){function p(e,o){o?e.$$hashKey=o:delete e.$$hashKey}function u(e,o){var t=e.$$hashKey;baseConfig.debug&&console.log(arguments);for(var a=1,n=arguments.length;n>a;a++){var l=arguments[a];if(l)for(var i=Object.keys(l),r=0,s=i.length;s>r;r++){var c=i[r];e[c]=l[c]}}return p(e,t),e}function d(){var e={};return e.scope=n.$new(),e.element=angular.element(h),e.responseDeferred=t.defer(),l.get().appendChild(e.element[0]),baseConfig.debug&&debug(e.element),i(e.element)(e.scope),u(e.scope,{title:"",$buttonTapped:function(){baseConfig.debug&&debug("$buttonTapped"),e.responseDeferred.resolve(1)}}),e.show=function(){e.isShown||e.removed||(s.stack.add(e),e.isShown=!0,ionic.requestAnimationFrame(function(){e.isShown&&f(e.element)}))},e.hide=function(o){return baseConfig.debug&&console.log("4 self.hide "+o),o=o||function(){},e.isShown?(s.stack.remove(e),e.isShown=!1,void a(o,250,!1)):o()},e.remove=function(){baseConfig.debug&&console.log("5 self.remove "),!e.removed&&s.stack.isHighest(e)&&(e.hide(function(){e.element.remove(),e.scope.$destroy()}),e.removed=!0)},e}function g(){var e=b[b.length-1];e&&e.responseDeferred.resolve()}function m(){function e(){b.push(o),baseConfig.debug&&console.log("popupStack.push(popup)"),a(o.show,t,!1),o.responseDeferred.promise.then(function(e){var t=b.indexOf(o);return-1!==t&&b.splice(t,1),baseConfig.debug&&console.log("popupStack.length"),b.length>0?b[b.length-1].show():(a(function(){!b.length},400,!1),(w._backButtonActionDone||function(){})()),o.remove(),e})}var o=$HmsHelp._createPopup(),t=0;return b.length>0?(b[b.length-1].hide(),t=y.stackPushDelay):w._backButtonActionDone=r.registerBackButtonAction(g,c.popup),o.responseDeferred.promise.close=function(e){o.removed||o.responseDeferred.resolve(e)},o.responseDeferred.notify({close:o.responseDeferred.close}),e(),o.responseDeferred.promise}function f(e){var o=e[0].querySelector("[autofocus]");o&&o.focus()}var h,y={stackPushDelay:75};h=ionic.Platform.isIOS()?'<div style="position: absolute;top:2px;left: -4px;bottom: 0;right: 0;background: url(img/mainHide.png); background-size: cover;;z-index: 12;"><div style="height: 100%;width: 100%;background: none" ng-click="$buttonTapped()"></div></div>':'<div style="position: absolute;top: -14px;left: -4px;bottom: 0;right: 0;background: url(img/mainHide.png); background-size: cover;;z-index: 12;"><div style="height: 100%;width: 100%;background: none" ng-click="$buttonTapped()"></div></div>';var b=[],w={showPopup:m,_createPopup:d,_popupStack:b};return w}]).factory("hmsFastPath",function(){var e={configFastPath:function(e,o,t){e.screenWidth={width:window.screen.width-50+"px"},e.scrollWidth=o.getWidth();var a=document.getElementsByTagName("ion-view"),n=a[a.length-1].attributes[0].value;e.currentStackList=o.getStackList(t,n),e.goStack=function(e){o.returnToState(e.stateName)}}};return e}),angular.module("myApp",["ionic","ngCordova","loginModule","baseConfig","messageModule","contactModule","applicationModule","myInfoModule","utilModule","tsApproveModule","HmsModule"]),angular.module("myApp").run(function(e){e.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!1),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}),angular.module("myApp").config(["$stateProvider","$urlRouterProvider","$httpProvider","$ionicConfigProvider",function(e,o,t,a){t.interceptors.push("httpRequestHeader"),a.platform.ios.tabs.style("standard"),a.platform.ios.tabs.position("bottom"),a.platform.android.tabs.style("standard"),a.platform.android.tabs.position("standard"),a.platform.ios.navBar.alignTitle("center"),a.platform.android.navBar.alignTitle("center"),a.platform.android.backButton.previousTitleText("").icon("ion-android-arrow-back"),a.platform.ios.views.transition("ios"),a.platform.android.views.transition("android"),e.state("tab",{url:"/tab","abstract":!0,templateUrl:"build/pages/tab/tabs.html",controller:"TabsCtrl"}).state("tab.message",{url:"/message",views:{"tab-message":{templateUrl:"build/pages/message/message.html",controller:"messageCtrl"}}}).state("tab.messageDetail",{url:"/messageDetail",params:{message:{}},views:{"tab-message":{templateUrl:"build/pages/message/detail/messageDetail.html",controller:"messageDetailCtrl"}}}).state("tab.contact",{url:"/contact",views:{"tab-contact":{templateUrl:"build/pages/contact/contact.html",controller:"contactCtrl"}}}).state("tab.application",{url:"/application",views:{"tab-application":{templateUrl:"build/pages/application/application.html",controller:"applicationCtrl"}}}).state("tab.myInfo",{url:"/myInfo",views:{"tab-myInfo":{templateUrl:"build/pages/myInfo/myInfo.html",controller:"myInfoCtrl"}}}).state("guide",{url:"/guide",templateUrl:"build/pages/guide/guide.html",controller:"guideCtrl"}).state("login",{url:"/login",templateUrl:"build/pages/login/login.html",controller:"loginCtrl"}),window.localStorage.token&&""!=window.localStorage.token?o.otherwise("/tab/message"):o.otherwise("/login")}]),angular.module("applicationModule").controller("applicationCtrl",["$scope","$state","baseConfig",function(e,o,t){e.animationsEnabled=!1,e.officeApp=[{list:[{appName:"会议管理",imageUrl:"build/img/application/meetingManage@3x.png",destUrl:""},{appName:"个人申请",imageUrl:"build/img/application/meetingManage@3x.png",destUrl:""},{appName:"报表分析",imageUrl:"build/img/application/meetingManage@3x.png",destUrl:""},{appName:"人事政策",imageUrl:"build/img/application/meetingManage@3x.png",destUrl:""}]},{list:[{appName:"假期管理",imageUrl:"build/img/application/holidayManage@3x.png",destUrl:"tab.time-off-manage"},{appName:"住宿申请",imageUrl:"build/img/application/dorm-apply/dorm-apply.png",destUrl:"tab.dorm-apply"},{appName:"Timesheet填写",imageUrl:"build/img/application/timesheet@3x.png",destUrl:"tab.timesheet"},{appName:"Timesheet审批",imageUrl:"build/img/application/timesheetExamine@3x.png",destUrl:"tab.tsApproveList"}]}],e.projectApp=[{list:[{appName:"机票预定",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"代办事项",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:"tab.workflow-list"},{appName:"报销单查询",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"首款查询",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""}]},{list:[{appName:"外勤汇报",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"",imageUrl:"",destUrl:""},{appName:"",imageUrl:"",destUrl:""},{appName:"",imageUrl:"",destUrl:""}]}],e.employeeApp=[{list:[{appName:"在线培训",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"知识门户",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"新闻",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"分享社区",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""}]}],e.openSetting=function(){e.animationsEnabled?e.animationsEnabled=!1:e.animationsEnabled=!0},e.goPage=function(e){t.debug&&console.log("appItem "+angular.toJson(e)),o.go(e.destUrl)},console.log("applicationCtrl.enter"),e.$on("$ionicView.enter",function(e){console.log("applicationCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){console.log("applicationCtrl.$destroy")})}]),angular.module("loginModule").controller("guideCtrl",["$scope","$state",function(e,o){console.log("loginCtrl.enter"),e.toLogin=function(){console.log("跳过导航页到登陆页"),o.go("login")},e.$on("$ionicView.enter",function(e){console.log("guideCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){console.log("guideCtrl.$destroy")})}]),angular.module("contactModule").controller("contactCtrl",["$scope","$state",function(e,o){console.log("contactCtrl.enter"),e.$on("$ionicView.enter",function(e){console.log("contactCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){console.log("contactCtrl.$destroy")})}]),angular.module("loginModule").controller("loginCtrl",["$scope","$state","baseConfig","$ionicLoading","$http","$timeout","$ionicHistory","hmsPopup",function(e,o,t,a,n,l,i,r){e.loginData={},e.currentVersionNum=t.versionName,window.localStorage.empno&&(e.loginData.username=window.localStorage.empno),window.localStorage.checkboxSavePwd||(e.checkboxSavePwd=!0,window.localStorage.checkboxSavePwd="true"),"true"==window.localStorage.checkboxSavePwd?(e.checkboxSavePwd=!0,e.loginData.password=window.localStorage.password):e.checkboxSavePwd=!1,t.debug&&console.log("loginCtrl.enter"),e.savePassword=function(){e.checkboxSavePwd=!e.checkboxSavePwd,t.debug&&console.log("此时密码框的状态为 :",angular.toJson(e.checkboxSavePwd)),""!==e.loginData.password&&(e.checkboxSavePwd===!0?window.localStorage.password=e.loginData.password:window.localStorage.password="")},e.clearUser=function(){e.loginData.username=""},e.clearPassword=function(){e.loginData.password=""},e.doLogin=function(){if(window.localStorage.empno=e.loginData.username,e.checkboxSavePwd?window.localStorage.password=e.loginData.password:window.localStorage.password="",!e.loginData.username||""==e.loginData.username)return void r.showPopup("用户名不能为空");if(!e.loginData.password||""==e.loginData.password)return void r.showPopup("密码不能为空");var a=t.basePath+"/appLogin/user_login/login",l={params:{p_user_name:+e.loginData.username,p_password:e.loginData.password}};r.showLoading("登陆中..."),n.post(a,l).success(function(a){r.hideLoading(),t.debug&&console.log("result success "+angular.toJson(a)),a.status||"S"!=a.con_status?r.showPopup("登陆失败,可能是密码不对!"):(window.localStorage.token=a.pre_token+a.token_key,window.localStorage.empno=e.loginData.username,window.localStorage.checkboxSavePwd=e.checkboxSavePwd,o.go("tab.message"))}).error(function(e,o){r.hideLoading(),t.debug&&console.log("response error "+angular.toJson(e))})},e.$on("$ionicView.enter",function(e){t.debug&&console.log("loginCtrl.$ionicView.enter"),l(function(){i.clearCache(),i.clearHistory()},400)}),e.$on("$destroy",function(e){t.debug&&console.log("loginCtrl.$destroy")})}]),angular.module("messageModule").controller("messageCtrl",["$scope","$state","$timeout","$ionicPlatform",function(e,o,t,a){e.messageList=[],a.ready(function(){window.StatusBar&&StatusBar.styleLightContent()}),e.talk=function(e){console.log("$scope.talk"),o.go("tab.messageDetail",{message:e})},e.refresh=function(){t(function(){e.$broadcast("scroll.refreshComplete")},2e3)},console.log("messageCtrl.enter"),e.$on("$ionicView.enter",function(e){console.log("messageCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){console.log("messageCtrl.$destroy")})}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.feedback",{url:"/feedback",views:{"tab-myInfo":{templateUrl:"build/pages/myInfo/feedback.html",controller:"FeedbackCtrl"}}})}]),angular.module("myInfoModule").controller("FeedbackCtrl",["$scope","baseConfig","$ionicHistory",function(e,o,t){e.goBack=function(){t.goBack()}}]),angular.module("myInfoModule").controller("myInfoCtrl",["$scope","$state","baseConfig",function(e,o,t){t.debug&&console.log("myInfoCtrl.enter"),e.logout=function(){window.localStorage.token="",window.localStorage.password="",window.localStorage.timesheetAuto="",window.localStorage.messagePush="",o.go("login")},e.setup=function(){o.go("tab.setup")},e.feedback=function(){o.go("tab.feedback")},e.$on("$ionicView.enter",function(e){t.debug&&console.log("myInfoCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){t.debug&&console.log("myInfoCtrl.$destroy")})}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.setup",{url:"/setup",views:{"tab-myInfo":{templateUrl:"build/pages/myInfo/setup.html",controller:"SetupCtrl"}}})}]),angular.module("myInfoModule").controller("SetupCtrl",["$scope","baseConfig","$ionicHistory",function(e,o,t){window.localStorage.timesheetAuto||(e.timesheetAuto=!1,window.localStorage.timesheetAuto="false",o.debug&&console.log("timesheet自动填写功能默认关闭")),window.localStorage.messagePush||(e.messagePush=!1,window.localStorage.messagePush="false",o.debug&&console.log("消息推送功能默认关闭")),"true"==window.localStorage.timesheetAuto?(e.timesheetAuto=!0,o.debug&&console.log("打开timesheet自动填写功能")):(e.timesheetAuto=!1,o.debug&&console.log("关闭timesheet自动填写功能")),"true"==window.localStorage.messagePush?(e.messagePush=!0,o.debug&&console.log("打开消息推送功能")):(e.messagePush=!1,o.debug&&console.log("关闭消息推送功能")),e.clickTimesheetAuto=function(){e.timesheetAuto=!e.timesheetAuto,1==e.timesheetAuto?(window.localStorage.timesheetAuto="true",o.debug&&console.log("打开timesheet自动填写功能")):0==e.timesheetAuto&&(window.localStorage.timesheetAuto="false",o.debug&&console.log("关闭timesheet自动填写功能"))},e.clickMessagePush=function(){e.messagePush=!e.messagePush,1==e.messagePush?(window.localStorage.messagePush="true",o.debug&&console.log("打开消息推送功能")):0==e.messagePush&&(window.localStorage.messagePush="false",o.debug&&console.log("关闭消息推送功能"))},e.goBack=function(){t.goBack()}}]),angular.module("loginModule").controller("TabsCtrl",["$scope","$rootScope","$state","baseConfig",function(e,o,t,a){o.$on("$ionicView.beforeEnter",function(){var o=t.current.name;a.debug&&console.log("$ionicView.beforeEnter statename "+o),"tab.message"!=o&&"tab.application"!=o&&"tab.contact"!=o&&"tab.myInfo"!=o&&(e.hideTabs=!0)}),o.$on("$ionicView.afterEnter",function(){var o=t.current.name;a.debug&&console.log("$ionicView.afterEnter statename "+o),"tab.message"!==o&&"tab.application"!==o&&"tab.contact"!==o&&"tab.myInfo"!==o||(e.hideTabs=!1,e.$apply())})}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.dorm-apply-detail-a",{url:"/dorm-apply-detail-a",views:{"tab-application":{templateUrl:"build/pages/application/dorm-apply/dorm-apply-detail-a.html",controller:"DormApplyDetailFirstCtrl"}},params:{dormApplyDetailInfo:""}})}]),angular.module("applicationModule").controller("DormApplyDetailFirstCtrl",["$scope","$state","baseConfig","$ionicHistory","hmsHttp","hmsPopup","$rootScope","$timeout","$stateParams",function(e,o,t,a,n,l,i,r,s){e.applyInfo=s.dormApplyDetailInfo,e.approving=!1,e.rejected=!1,e.checkingin=!1,e.approvedResult="","审批中"==e.applyInfo.status?(e.approving=!0,e.rejected=!1,e.checkingin=!1,e.approvedResult=""):"已拒绝"==e.applyInfo.status?(e.approving=!1,e.rejected=!0,e.checkingin=!1,e.approvedResult="已拒绝"):"未入住"==e.applyInfo.status&&(e.approving=!1,e.rejected=!1,e.checkingin=!0,e.approvedResult="已通过"),e.goBack=function(){a.goBack()},e.cancelApply=function(){var o=t.businessPath+"/wfl_apply_room/cancel_application",r={params:{p_apply_id:e.applyInfo.applyId,p_employee_number:window.localStorage.empno}};l.showLoading("请稍候"),n.post(o,r).success(function(e){l.hideLoading();var o=e.message;l.showShortCenterToast(o),"S"==e.status&&(i.$broadcast("APPLY_CANCELLED"),a.goBack()),t.debug&&console.log("result success "+angular.toJson(e))}).error(function(e,o){l.hideLoading(),t.debug&&console.log("response error "+angular.toJson(e))})}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.dorm-apply-detail-b",{url:"/dorm-apply-detail-b",views:{"tab-application":{templateUrl:"build/pages/application/dorm-apply/dorm-apply-detail-b.html",controller:"DormApplyDetailSecondCtrl"}},params:{dormApplyDetailInfo:""}})}]),angular.module("applicationModule").controller("DormApplyDetailSecondCtrl",["$scope","$state","baseConfig","$ionicHistory","hmsHttp","hmsPopup","$rootScope","$timeout","$stateParams",function(e,o,t,a,n,l,i,r,s){e.applyInfo=s.dormApplyDetailInfo,e.checkIn=!1,e.checkOut=!1,e.buttonText="",e.leftDays=e.applyInfo.leftDays,e.totalDays=parseInt(e.applyInfo.checkinDays),"已入住"==e.applyInfo.status?(e.checkIn=!0,e.checkOut=!1,e.buttonText="续住"):"已退房"==e.applyInfo.status&&(e.checkIn=!1,e.checkOut=!0,e.buttonText="再次预定"),e.goBack=function(){a.goBack()},e.renewContract=function(){var o=t.businessPath+"/wfl_apply_room/overstay_apply_room",r={params:{p_employee_number:window.localStorage.empno,p_pro_id:"",p_checkin_date:"2016-08-15",p_checkout_date:"2016-09-20",p_room_number:e.applyInfo.roomNumber,p_bed_number:e.applyInfo.bedNumber,p_apply_type:e.applyInfo.applyType,p_reason:""}};"项目申请"==e.applyInfo.applyType&&(r.params.p_pro_id=e.applyInfo.projectId),l.showLoading("请稍候"),n.post(o,r).success(function(e){l.hideLoading();var o=e.message;l.showShortCenterToast(o),"S"==e.status&&(i.$broadcast("APPLY_SUCCESS"),a.goBack()),t.debug&&console.log("result success "+angular.toJson(e))}).error(function(e,o){l.hideLoading(),t.debug&&console.log("response error "+angular.toJson(e))})}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.dorm-apply-vacant-room",{url:"/dorm-apply-vacant-room",views:{"tab-application":{templateUrl:"build/pages/application/dorm-apply/dorm-apply-vacant-room.html",controller:"DormApplyVacantRoomCtrl"}},params:{dormApplySearchResult:"",projectId:"",applyType:""}})}]),angular.module("applicationModule").controller("DormApplyVacantRoomCtrl",["$scope","$rootScope","$state","baseConfig","$ionicHistory","hmsHttp","hmsPopup","$timeout","$stateParams",function(e,o,t,a,n,l,i,r,s){var c=s.dormApplySearchResult,p=s.projectId,u=s.applyType;e.roomlist=c.result,e.goBack=function(){n.goBack()},e.applyRoom=function(t){var r=a.businessPath+"/wfl_apply_room/apply_room",s={params:{p_employee_number:window.localStorage.empno,p_pro_id:"",p_checkin_date:c.checkinDate,p_checkout_date:c.checkoutDate,p_room_number:e.roomlist[t].room_number,p_bed_number:e.roomlist[t].bed_number,p_apply_type:c.applyType,p_reason:""}};"项目申请"==u&&(s.params.p_pro_id=p),i.showLoading("请稍候"),l.post(r,s).success(function(e){i.hideLoading();var t=e.message;i.showShortCenterToast(t),"S"==e.status&&(n.goBack(-2),o.$broadcast("APPLY_SUCCESS")),a.debug&&console.log("result success "+angular.toJson(e))}).error(function(e,o){i.hideLoading(),a.debug&&console.log("response error "+angular.toJson(e))})}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.dorm-apply",{url:"/dorm-apply",views:{"tab-application":{templateUrl:"build/pages/application/dorm-apply/dorm-apply.html",controller:"DormApplyCtrl"}}})}]),angular.module("applicationModule").controller("DormApplyCtrl",["$scope","$rootScope","$state","baseConfig","$ionicHistory","hmsHttp","hmsPopup","$ionicScrollDelegate","$timeout",function(e,o,t,a,n,l,i,r,s){function c(){e.items=[];var o=a.businessPath+"/wfl_apply_room/query_room_history_list",t={params:{p_employee_number:window.localStorage.empno}};l.post(o,t).success(function(o){a.debug&&console.log("result success "+angular.toJson(o)),e.items=o.result,angular.forEach(e.items,function(e,o,t){"已入住"==t[o].apply_status?(t[o].modeCheckIn=!0,t[o].modeCheckOut=!1,t[o].modeApproving=!1,t[o].modeRejected=!1,t[o].modeCheckingIn=!1):"已退房"==t[o].apply_status?(t[o].modeCheckIn=!1,t[o].modeCheckOut=!0,t[o].modeApproving=!1,t[o].modeRejected=!1,t[o].modeCheckingIn=!1):"审批中"==t[o].apply_status?(t[o].modeCheckIn=!1,t[o].modeCheckOut=!1,t[o].modeApproving=!0,t[o].modeRejected=!1,t[o].modeCheckingIn=!1):"已拒绝"==t[o].apply_status?(t[o].modeCheckIn=!1,t[o].modeCheckOut=!1,t[o].modeApproving=!1,t[o].modeRejected=!0,t[o].modeCheckingIn=!1):"未入住"==t[o].apply_status&&(t[o].modeCheckIn=!1,t[o].modeCheckOut=!1,t[o].modeApproving=!1,t[o].modeRejected=!1,t[o].modeCheckingIn=!0)})}).error(function(e,o){i.hideLoading(),a.debug&&console.log("response error "+angular.toJson(e))})}e.descriptionAppearance=!1,e.items=[],c(),e.goBack=function(){n.goBack()},e.createNewDormApply=function(){t.go("tab.new-dorm-apply")},e.viewApplyDetail=function(o){
var a=e.items[o],n={status:a.apply_status,checkinDate:a.checkin_date,checkoutDate:a.checkout_date,applyType:a.apply_type,floorNumber:a.floor_number,roomNumber:a.room_number,roomType:a.room_type,bedNumber:a.bed_number,applyId:a.apply_id,projectId:a.project_id,checkinDays:a.checkin_days,leftDays:a.left_days};"已入住"==n.status||"已退房"==n.status?t.go("tab.dorm-apply-detail-b",{dormApplyDetailInfo:n}):"审批中"!=n.status&&"已拒绝"!=n.status&&"未入住"!=n.status||t.go("tab.dorm-apply-detail-a",{dormApplyDetailInfo:n})},e.judgeApplyType=function(e){var o=e.apply_status;return"已入住"==o||"已退房"==o||"未入住"==o?!0:"审批中"==o||"已拒绝"==o?!1:void 0},e.showDescription=function(){e.descriptionAppearance=!0},e.hideDescription=function(){e.descriptionAppearance=!1},o.$on("APPLY_SUCCESS",function(){s(function(){r.$getByHandle("dormScroll").scrollTop(!1)},200),c()}),o.$on("APPLY_CANCELLED",function(){s(function(){r.$getByHandle("dormScroll").scrollTop(!1)},200),c()})}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.new-dorm-apply",{url:"/new-dorm-apply",views:{"tab-application":{templateUrl:"build/pages/application/dorm-apply/new-dorm-apply.html",controller:"NewDormApplyCtrl"}}})}]),angular.module("applicationModule").controller("NewDormApplyCtrl",["$scope","$state","baseConfig","$ionicHistory","$ionicModal","hmsHttp","hmsPopup",function(e,o,t,a,n,l,i){n.fromTemplateUrl("build/pages/application/dorm-apply/modal/new-dorm-apply-choose-apply-type.html",{scope:e}).then(function(o){e.chooseTypePopup=o}),n.fromTemplateUrl("build/pages/application/dorm-apply/modal/new-dorm-apply-choose-room-type.html",{scope:e}).then(function(o){e.chooseRoomPopup=o}),n.fromTemplateUrl("build/pages/application/dorm-apply/modal/new-dorm-apply-choose-project-name.html",{scope:e}).then(function(o){e.chooseProjectPopup=o}),e.defaultApplyType="常驻申请",e.defaultRoomType="单人间",e.defaultProjectInfo={projectName:"",projectId:""},e.showProjectItem=!1,e.applytype=["常驻申请","加班申请","临时申请","项目申请"],e.roomtype=["单人间","四人间"],e.projectlist=[],e.showNumButton=!0,e.inputinfo={floornum:"",roomnum:""};var r=t.businessPath+"/wfl_apply_room/query_project_list",s={params:{p_employee_number:window.localStorage.empno}};i.showLoading("请稍候"),l.post(r,s).success(function(o){i.hideLoading(),"S"==o.status&&(e.projectlist=o.result,e.projectlist=e.projectlist.splice(1,e.projectlist.length-1),e.projectlist.length>0?(e.defaultProjectInfo.projectName=e.projectlist[0].project_name,e.defaultProjectInfo.projectId=e.projectlist[0].project_id,console.log(angular.toJson(e.defaultProjectInfo))):0==e.projectlist.length&&(e.defaultProjectInfo.projectName="无",e.defaultProjectInfo.projectId="")),t.debug&&console.log("result success "+angular.toJson(o))}).error(function(e){i.hideLoading(),t.debug&&console.log("response error "+angular.toJson(e))}),e.goBack=function(){a.goBack()},e.chooseApplyType=function(){e.chooseTypePopup.show()},e.chooseRoomType=function(){e.chooseRoomPopup.show()},e.chooseProjectName=function(){0==e.projectlist.length?i.showShortCenterToast("项目列表为空，请更改申请类型"):e.projectlist.length>0&&e.chooseProjectPopup.show()},e.finishChoosingApplyType=function(o){e.defaultApplyType=o,"项目申请"==e.defaultApplyType?e.showProjectItem=!0:"项目申请"!=e.defaultApplyType&&(e.showProjectItem=!1),e.chooseTypePopup.hide()},e.finishChoosingRoomType=function(o){e.defaultRoomType=o,e.chooseRoomPopup.hide()},e.finishChoosingProjectName=function(o){e.defaultProjectInfo.projectName=e.projectlist[o].project_name,e.defaultProjectInfo.projectId=e.projectlist[o].project_id,e.chooseProjectPopup.hide()},e.chooseDays=function(){"常驻申请"==e.defaultApplyType&&(e.showNumButton=!e.showNumButton)},e.searchVacantRoom=function(){if("无"==e.defaultProjectInfo.projectName&&"项目申请"==e.defaultApplyType)i.showShortCenterToast("项目列表为空，请更改申请类型");else{var a=t.businessPath+"/wfl_apply_room/query_free_room_list",n={params:{p_employee_number:window.localStorage.empno,p_check_in_date:"2016-06-22",p_check_out_date:"2016-08-20",p_apply_type:e.defaultApplyType,p_room_type:e.defaultRoomType,p_room_number:e.inputinfo.roomnum,p_floor_number:e.inputinfo.floornum,p_pro_id:""}};"项目申请"==e.defaultApplyType&&(n.params.p_pro_id=e.defaultProjectInfo.projectId),i.showLoading("请稍候"),l.post(a,n).success(function(a){var l=a.message;if(i.hideLoading(),"S"==a.status&&a.result.length>0){var r=a.result,s={applyType:n.params.p_apply_type,checkinDate:n.params.p_check_in_date,checkoutDate:n.params.p_check_out_date,result:r};o.go("tab.dorm-apply-vacant-room",{dormApplySearchResult:s,projectId:e.defaultProjectInfo.projectId,applyType:e.defaultApplyType})}else"E"==a.status&&i.showShortCenterToast(l);t.debug&&console.log("result success "+angular.toJson(a))}).error(function(e,o){i.hideLoading(),t.debug&&console.log("response error "+angular.toJson(e))})}}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.time-off-manage",{url:"/time-off-manage",views:{"tab-application":{templateUrl:"build/pages/application/time-off-manage/timeOffManageList.html",controller:"TimeOffManageCtrl"}}})}]),angular.module("applicationModule").controller("TimeOffManageCtrl",["$scope","$state","baseConfig","$ionicHistory",function(e,o,t,a){}]),angular.module("messageModule").controller("messageDetailCtrl",["$scope","$state","$stateParams","$ionicHistory",function(e,o,t,a){var n=t.message;console.log("message : "+angular.toJson(n)),e.message=n,e.goBack=function(){a.goBack()},e.$on("$ionicView.enter",function(e){console.log("messageDetailCtrl.$ionicView.enter")}),console.log("messageDetailCtrl.enter"),e.$on("$destroy",function(e){console.log("messageDetailCtrl.$destroy")})}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.workflow-list",{url:"/workflow-list",params:{day:{}},views:{"tab-application":{templateUrl:"build/pages/workflow/list/workflow-list.html",controller:"WorkFLowListCtrl"}}})}]),angular.module("applicationModule").controller("WorkFLowListCtrl",["$scope","$state","$stateParams","$ionicModal","$timeout","baseConfig","TimeSheetService","hmsPopup","WorkFLowListService",function(e,o,t,a,n,l,i,r,s){e.list=[],e.fetchDataFlag=!0,e.pullRefreshDataFlag=!1,e.listStatus={todo:{selected:!0},done:{selected:!1}};var c="build/img/application/profile@3x.png",p="工作流类型",u="当前节点",d="提交人";e.fetchTodoList=function(){e.listStatus.todo.selected||e.fetchDataFlag||e.pullRefreshDataFlag||(e.listStatus.todo.selected=!0,e.listStatus.done.selected=!1,g(!1))},e.fetchDoneList=function(){e.listStatus.done.selected||e.fetchDataFlag||e.pullRefreshDataFlag||(e.listStatus.done.selected=!0,e.listStatus.todo.selected=!1,m(!1))};var g=function(o){e.list=[],o?(e.fetchDataFlag=!1,e.pullRefreshDataFlag=!0):e.fetchDataFlag=!0;var t=function(t){var a=t.待审批列表;angular.forEach(a,function(o){var t={title1:o.workflow_name,icon:c,type:p,typeValue:o.workflow_name,node:u,nodeValue:o.current_node,submit:d,submitPerson:o.employee_name};e.list.push(t)}),e.fetchDataFlag=!1,o&&(e.pullRefreshDataFlag=!1,e.$broadcast("scroll.refreshComplete"))},a=function(t){e.fetchDataFlag=!1,o&&(e.pullRefreshDataFlag=!1,e.$broadcast("scroll.refreshComplete"))};n(function(){s.getTodoList("N",t,a)},2e3)},m=function(o){e.list=[],o?(e.fetchDataFlag=!1,e.pullRefreshDataFlag=!0):e.fetchDataFlag=!0;var t=function(t){var a=t.已审批列表;angular.forEach(a,function(o){var t={title1:o.workflow_desc,icon:c,type:p,typeValue:o.workflow_desc,node:u,nodeValue:o.status_name,submit:d,submitPerson:o.created_by_name};e.list.push(t)}),e.fetchDataFlag=!1,o&&(e.pullRefreshDataFlag=!1,e.$broadcast("scroll.refreshComplete"))},a=function(t){e.fetchDataFlag=!1,o&&(e.pullRefreshDataFlag=!1,e.$broadcast("scroll.refreshComplete"))};n(function(){s.getTodoList("Y",t,a)},2e3)};g(!1),a.fromTemplateUrl("build/pages/application/timesheet-approve/modal/ts-filter-modal.html",{scope:e}).then(function(o){e.tsFilterModal=o}),e.filterTsInfo=function(){e.tsFilterModal.show()},e.refresh=function(){e.fetchDataFlag?e.$broadcast("scroll.refreshComplete"):(e.list=[],e.$apply(),n(function(){e.listStatus.todo.selected?g(!0):m(!0)},300))}}]).service("WorkFLowListService",["hmsHttp","baseConfig","hmsPopup",function(e,o,t){this.getTodoList=function(a,n,l){var i=o.businessPath+"/wfl_wx_workflow_appr/get_instance_list",r={params:{p_employee_code:window.localStorage.empno,p_flag:a+""}};e.post(i,r).success(function(e){n(e)}).error(function(e,o){t.showPopup("获取代办事项出错,可能是网络问题!"),l(e)})}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.timesheet",{url:"/timesheet",views:{"tab-application":{templateUrl:"build/pages/application/timesheet/query/query.html",controller:"TimeSheetQueryCtrl"}}})}]),angular.module("applicationModule").controller("TimeSheetQueryCtrl",["$scope","$state","baseConfig","$ionicHistory","$timeout","$ionicScrollDelegate","TimeSheetService","hmsHttp",function(e,o,t,a,n,l,r,s){e.calendar=[];var c=!0;e.loadingDataFlag=!0;var p=function(){for(e.calendar=[],i=0;i<5;i++){var o="each-day",t="day-item",a="",n="",l={week:i,list:[]};for(j=0;j<7;j++){var r={day:i+""+j,style_outline:o,style_color:t,money:a,project:n};l.list.push(r)}e.calendar.push(l)}};test=function(){var e=t.businessPath+"/wfl_timesheet_view/get_timesheet_list",o={params:{p_employee_number:"4040",p_start_date:"2015-11-01",p_end_date:"2015-11-01",p_project_name:"",p_project_id:"",p_project_person_number:"",p_page:"1",p_line_number:"5"}};s.post(e,o).success(function(e){t.debug&&console.log("result success "+angular.toJson(e))}).error(function(e,o){t.debug&&console.log("response error "+angular.toJson(e))})},test(),p(),e.writeTimesheet=function(e){o.go("tab.timesheet-write",{day:e})},e.scrollToFixScreen=function(){c?(l.scrollTo(0,400,!0),c=!1):(l.scrollTo(0,0,!0),c=!0)};var u=function(o){var t=o.timesheet,a=0;for(e.calendar=[],i=0;i<5;i++){var n={week:i,list:[]};for(j=0;j<7;j++){var l,r="each-day",s="day-item",c="",p="",u=!1;t[a]?(u="0"!=t[a].lockflag,"Empty"==t[a].status?(r="each-day",s="day-item"):"Draft"==t[a].status?(r="each-day attendance",s="day-item attendance"):"Approved"==t[a].status?(r="each-day approve",s="day-item approve"):"Rejected"==t[a].status&&(r="each-day reject",s="day-item reject"),l={day:t[a].day.replace("0",""),style_outline:r,style_color:s,money:t[a].allowance,project:t[a].proj,each_day:t[a].each_day,lockFlag:u}):l={day:"",style_outline:r,style_color:s,money:c,project:p,each_day:"",lockFlag:u},n.list.push(l),a+=1}e.calendar.push(n)}},d=function(o){p(),e.loadingDataFlag=!0;var a=t.businessPath+"/timesheet_process/fetch_calendar",n={params:{p_employee:window.localStorage.empno,p_month:o+"",p_offset:1}};s.post(a,n).success(function(o){u(o),e.loadingDataFlag=!1,t.debug&&console.log("result success "+angular.toJson(o))}).error(function(o,a){e.loadingDataFlag=!1,e.$apply(),t.debug&&console.log("response error "+angular.toJson(o))})};d("201511"),e.getTimeSheet=function(e){d(e)},e.goBack=function(){a.$ionicGoBack()},t.debug&&console.log("applicationCtrl.enter"),e.$on("$ionicView.enter",function(e){t.debug&&console.log("applicationCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){t.debug&&console.log("applicationCtrl.$destroy")})}]).service("TimeSheetService",["baseConfig","hmsHttp","hmsPopup",function(e,o,t){this.fetchCalendar=function(){var t=e.businessPath+"/timesheet_process/fetch_calendar",a={params:{p_employee:window.localStorage.empno,p_month:"201511",p_offset:1}};o.post(t,a).success(function(o){e.debug&&console.log("result success "+angular.toJson(o))}).error(function(o,t){e.debug&&console.log("response error "+angular.toJson(o))})},this.fetchEachDay=function(a){var n=e.businessPath+"/timesheet_process/fetch_projects",l={params:{p_employee:window.localStorage.empno+"",p_date:"20151013"}};o.post(n,l).success(function(e){a(e)}).error(function(e,o){t.hideLoading(),t.showPopup("获取状态错误,请检查")})}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.timesheet-write",{url:"/timesheet-write",params:{day:{}},views:{"tab-application":{templateUrl:"build/pages/application/timesheet/write/write.html",controller:"TimeSheetWriteCtrl"}}})}]),angular.module("applicationModule").controller("TimeSheetWriteCtrl",["$scope","$state","$stateParams","$ionicModal","$timeout","baseConfig","TimeSheetService","hmsPopup",function(e,o,t,a,n,l,i,r){var s="ion-ios-checkmark",c="ion-ios-circle-outline";e.projectList=[],e.addressList=[],e.flybackList=[],e.timesheetDetail={currentDay:"",approver:"",currentProject:{},currentAddress:{},currentFlyback:{},travelingAllowance:{flag:!1,style:c},normalAllowance:{flag:!1,style:c},charging:{flag:!1,style:c},description:""},l.debug&&console.log("$stateParams.day "+angular.toJson(t.day)),a.fromTemplateUrl("build/pages/application/timesheet/write/modal/projectModal.html",{scope:e}).then(function(o){e.projectModal=o}),a.fromTemplateUrl("build/pages/application/timesheet/write/modal/addressModal.html",{scope:e}).then(function(o){e.addressModal=o}),a.fromTemplateUrl("build/pages/application/timesheet/write/modal/flybackList.html",{scope:e}).then(function(o){e.flybackModal=o}),e.showProjectModal=function(){e.projectModal.show()},e.hideProjectModal=function(){e.projectModal.hide()},e.showFlybackModal=function(){e.flybackModal.show()},e.hideFlybackModal=function(){e.flybackModal.hide()},e.showAddressModal=function(){e.addressModal.show()},e.hideAddressModal=function(){e.addressModal.hide()};var p=function(o){if(r.hideLoading(),"S"==o.status){var t=o.project,a=o.flyback,n=o.projaddress;"1"===o.every_day.offbase?e.timesheetDetail.travelingAllowance={flag:!0,style:s}:e.timesheetDetail.travelingAllowance={flag:!1,style:c},"Y"===o.every_day.base?e.timesheetDetail.normalAllowance={flag:!0,style:s}:e.timesheetDetail.normalAllowance={flag:!1,style:c},"1"===o.every_day.externalcharge?e.timesheetDetail.charging={flag:!0,style:s}:e.timesheetDetail.charging={flag:!1,style:c},e.timesheetDetail.currentDay=o.every_day.every_day,e.timesheetDetail.approver=o.every_day.approver,e.timesheetDetail.description=o.every_day.descrpt,e.timesheetDetail.allowance=o.every_day.allowance,angular.forEach(t,function(o){return"Y"===o.selected_flag?void(e.timesheetDetail.currentProject=o):void 0}),angular.forEach(n,function(o){return"Y"===o.selected_flag?void(e.timesheetDetail.currentAddress=o):void 0}),angular.forEach(a,function(o){return"Y"===o.fly_select?void(e.timesheetDetail.currentFlyback=o):void 0}),e.projectList=t,e.addressList=n,e.flybackList=a}};e.checkBoxChanged=function(o,t){console.log("$scope.checkBoxChanged item "+angular.toJson(o)),o.flag?(o.flag=!1,o.style=c):(o.flag=!0,o.style=s),"travelingAllowance"==t&&e.timesheetDetail.travelingAllowance.flag&&(e.timesheetDetail.normalAllowance={flag:!1,style:c}),"normalAllowance"==t&&e.timesheetDetail.normalAllowance.flag&&(e.timesheetDetail.travelingAllowance={flag:!1,style:c})},e.submitTimesheet=function(e){l.debug&&console.log("timesheetDetail "+angular.toJson(e))},n(function(){r.showLoading("获取timesheet明细数据"),i.fetchEachDay(p)})}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.tsApproveList",{url:"application/tsApproveList",views:{"tab-application":{templateUrl:"build/pages/application/timesheet-approve/list/ts-approve-list.html",controller:"tsApproveListCtrl"}}})}]),angular.module("tsApproveModule").controller("tsApproveListCtrl",["$scope","$state","baseConfig","$ionicModal","$ionicScrollDelegate","$ionicPopup","$timeout","TsApproveListService","hmsPopup",function(e,o,t,a,n,l,i,r,s){function c(o){e.selectArray=[],g=[],angular.forEach(e.listInfoArray,function(t,a){"undoSelectAll"==o?(e.selectArray.push(!1),g.push(!1)):"selectedAll"==o&&(e.selectArray.push(!0),g.push(!0))})}function p(){e.tsFilterModal.hide(),e.showProjectName=!0,e.isClickedProject=[],e.isClickedPerson=[],angular.element("#project-name").addClass("active-select"),angular.element("#project-name").removeClass("active-off"),angular.element("#person-select").removeClass("active-select")}e.showProjectName=!0,e.showRocket=!1,e.showConnectBlock=!1,e.showDetailArrow=!0;var u=!1;e.actionName="操作",e.selectArray=[],e.isClickedProject=[],e.listInfoArray={};var d="",g=[],m=t.businessPath+"/wfl_timesheet_view/get_timesheet_list",f={params:{p_employee_number:window.localStorage.empno,p_start_date:"20160406",p_end_date:"",p_project_name:"",p_project_id:"",p_project_person_number:"",p_page:"1",p_line_number:"7"}},h=(new Date).getDate();10>h?f.params.p_end_date=getLastMonthDate(new Date):h>10&&20>h?f.params.p_end_date=getCurrentDate(new Date):h>20&&(f.params.p_end_date=getCurrentMonthLastDate(new Date)),function(){s.showLoading("加载中..."),e.listInfoArray=new r(e,m,f)}(),e.$on("$ionicView.enter",function(e){}),e.$on("$destroy",function(e){log("tsApproveListCtrl.$destroy")}),c("undoSelectAll"),e.doSelectAction=function(){"操作"==e.actionName?(e.actionName="取消",e.showDetailArrow=!1,angular.element(".ts-approve-list-item").css("paddingLeft","10%")):"取消"==e.actionName&&(e.actionName="操作",e.showDetailArrow=!0,angular.element(".ts-approve-list-item").css("paddingLeft","10px"),c("undoSelectAll"))},e.onDrag=function(){e.showConnectBlock=!1},e.onDragUp=function(){e.showConnectBlock=!0},e.watchScroll=function(){d=n.getScrollPosition().top,e.$apply(function(){0>d?e.showConnectBlock=!1:d>=0&&400>d?(e.showRocket=!1,e.showConnectBlock=!0):d>=400&&(e.showRocket=!0)})},e.tsListRefresh=function(){i(function(){e.$broadcast("scroll.refreshComplete")},1e3)},e.getAttentionInfo=function(o,t){o.stopPropagation(),warn(t),l.show({template:'<div class="warn-attention-icon">'+t[0].description+"</div>",scope:e,buttons:[{text:'<div class="warn-cancel-icon"></div>',type:"button-clear",onTap:function(e){}}]})},e.goTsLsTop=function(){angular.element("#rocket").addClass("ng-hide"),n.scrollTop(!0)},a.fromTemplateUrl("build/pages/application/timesheet-approve/modal/ts-filter-modal.html",{scope:e}).then(function(o){e.tsFilterModal=o}),e.filterTsInfo=function(){e.tsFilterModal.show()},e.goApproveDetail=function(t,a,n,l,i){e.showDetailArrow?(warn(l,i),o.go("tab.tsApproveDetail",{employeeNumber:a,projectId:n,startDate:l,endDate:i})):(g[t]=!g[t],g[t]?e.selectArray[t]=!0:e.selectArray[t]=!1)},e.selectAllList=function(){u=!u,c(u?"selectedAll":"undoSelectAll")},e.passThroughListItem=function(){warn("passThroughDetailItem")},e.refuseListItem=function(){warn("refuseDetailItem")},e.selectScreening=function(o){"projectName"==o?(e.showProjectName=!0,angular.element("#project-name").addClass("active-select"),angular.element("#project-name").removeClass("active-off"),angular.element("#person-select").removeClass("active-select")):"personSelect"==o&&(e.showProjectName=!1,angular.element("#person-select").addClass("active-select"),angular.element("#project-name").addClass("active-off"))},e.selectFilterItem=function(o,t){"projectName"===o?(e.isClickedProject=[],e.isClickedProject[t]=!0):"personSelect"===o&&(e.isClickedPerson=[],e.isClickedPerson[t]=!0)},e.cancelFilter=function(){p()},e.confirmFilter=function(){p()},e.clearFilterParams=function(){e.isClickedProject=[],e.isClickedPerson=[]}}]).service("TsApproveListService",["hmsHttp","baseConfig","hmsPopup",function(e,o,t){var a=function(a,n,l,i){var r=this;r.scope=a,r.url=n,r.params={},r.params=l,r.refurbishParam=i,r.busy=!1,r.totalNumber=0,r.listArray=[],r.projectList=[],r.employeeList=[],"clickRefreshEvent"===r.refurbishParam&&r.scope.$broadcast("scroll.infiniteScrollComplete"),e.post(r.url,r.params).success(function(a){try{if(e.isSuccessfull(a.status)){var n=a.timesheet_approve_response;o.debug&&warn("hi,create a new factory!!\n"+jsonFormat()),r.totalNumber=a.count;try{r.listArray=r.listArray.concat(n.result_list),r.projectList=r.projectList.concat(n.project_list),r.employeeList=r.employeeList.concat(n.project_person_list)}catch(l){r.listArray=[],r.projectList=[],r.employeeList=[]}0==a.count?(r.busy=!1,r.listArray=[]):a.count<=5?r.busy=!1:r.busy=!0,r.scope.$broadcast("scroll.refreshComplete"),r.scope.$broadcast("scroll.infiniteScrollComplete")}else"E"===a.status||"e"==a.status?t.showPopup("提示","<div style='text-align: center'>没有相关数据!</div>"):t.showPopup("提示","<div style='text-align: center'>网络异常,请稍后重试!</div>"),r.scope.$broadcast("scroll.refreshComplete"),r.scope.$broadcast("scroll.infiniteScrollComplete");t.hideLoading()}catch(l){}}.bind(r)).error(function(e){r.params.p_line_number=1,r.busy=!1,t.hideLoading(),r.scope.$broadcast("scroll.refreshComplete"),r.scope.$broadcast("scroll.infiniteScrollComplete"),t.showPopup("提示","<div style='text-align: center'>服务请求异常,请检查网络连接和输入参数后重新操作!</div>")}.bind(r))};return a.prototype.nextPage=function(){var a=this;if(o.debug&&console.log("enter next page!"),a.busy){if(a.busy&&"clickRefreshEvent"===a.refurbishParam)return a.refurbishParam="",void a.scope.$broadcast("scroll.infiniteScrollComplete");a.busy=!0,a.params.p_line_number++,e.post(a.url,a.params).success(function(o){try{e.isSuccessfull(o.status)?a.scope.$broadcast("scroll.infiniteScrollComplete"):a.scope.$broadcast("scroll.infiniteScrollComplete")}catch(t){}}.bind(a)).error(function(e){a.params.p_line_number=1,a.scope.$broadcast("scroll.infiniteScrollComplete"),a.busy=!1,t.hideLoading(),t.showPopup("提示","<div style='text-align: center'>网络异常,请稍后重试!</div>")}.bind(a))}},a}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.tsApproveDetail",{url:"application/tsApproveDetail",views:{"tab-application":{templateUrl:"build/pages/application/timesheet-approve/detail/ts-approve-detail.html",controller:"tsApproveDetailCtrl"}},params:{employeeNumber:"",projectId:"",startDate:"",endDate:""}})}]),tsApproveModule.controller("tsApproveDetailCtrl",["$scope","$state","baseConfig","$ionicHistory","$stateParams","hmsHttp","hmsPopup",function(e,o,t,a,n,l,i){function r(o){e.selectArray=[],s=[],angular.forEach(e.detailInfoArray,function(t,a){"undoSelectAll"==o?(e.selectArray.push(!1),s.push(!1)):"selectedAll"==o&&(e.selectArray.push(!0),s.push(!0))})}var s=[],c=!1;e.detailActionName="操作",e.showActionBar=!1,e.detailInfoArray={},e.selectArray=[];var p=t.businessPath+"/wfl_timesheet_view/query_timesheet_approve_list",u={params:{p_employee_number:n.employeeNumber,p_start_date:n.startDate.toString().replace(/-/g,""),p_end_date:n.endDate.toString().replace(/-/g,""),p_project_id:n.projectId}};i.showLoading("记载中..."),l.post(p,u).success(function(o){i.hideLoading(),l.isSuccessfull(o.status)?e.detailInfoArray=o.timesheet_approve_detail_response:"E"===o.status||"e"==o.status?i.showPopup("提示","<div style='text-align: center'>没有相关数据!</div>"):i.showPopup("提示","<div style='text-align: center'>网络异常,请稍后重试!</div>")}).error(function(e,o){i.hideLoading(),i.showPopup("提示","<div style='text-align: center'>服务请求异常,请检查网络连接和输入参数后重新操作!</div>")}),e.$on("$ionicView.enter",function(e){warn("tsApproveListCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){warn("tsApproveListCtrl.$destroy")}),r("undoSelectAll"),e.dealDetailInfo=function(){"操作"==e.detailActionName?(e.detailActionName="取消",e.showActionBar=!0,angular.element("#tsApproveItem").css("paddingLeft","6%")):"取消"==e.detailActionName&&(e.detailActionName="操作",e.showActionBar=!1,r("undoSelectAll"),angular.element("#tsApproveItem").css("paddingLeft","0"),warn(angular.toJson(e.selectArray,!0)))},e.selectItem=function(o){s[o]=!s[o],s[o]?e.selectArray[o]=!0:e.selectArray[o]=!1},e.selectAllDetail=function(){c=!c,r(c?"selectedAll":"undoSelectAll")},e.passThroughDetailItem=function(){warn("passThroughDetailItem")},e.refuseDetailItem=function(){warn("refuseDetailItem")}}]);
>>>>>>> Feature/t0016
