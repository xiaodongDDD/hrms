function jsonFormat(e){var o=angular.toJson(e,!0);return o}function getCurrentDate(e){var o=e.getFullYear(),t=e.getMonth()+1,a=e.getDate();t=10>t?"0"+t:t,a=10>a?"0"+a:a;var n=o.toString()+t.toString()+a.toString();return n}function getLastMonthDate(e){var o=e.getFullYear(),t=e.getMonth(),a=new Date(o,t,1),n=new Date(a.getTime()-864e5).getDate();t=10>t?"0"+t:t,n=10>n?"0"+n:n;var l=o.toString()+t.toString()+n.toString();return l}function getCurrentMonthLastDate(e){var o=e.getFullYear(),t=e.getMonth()+1,a=new Date(o,t,1),n=new Date(a.getTime()-864e5).getDate();t=10>t?"0"+t:t,n=10>n?"0"+n:n;var l=o.toString()+t.toString()+n.toString();return l}angular.module("baseConfig",[]).constant("baseConfig",{debug:!0,isMobilePlatform:!1,clearTable:!0,nativeScreenFlag:!1,basePath:"http://wechat.hand-china.com/hmbms_hand/api",businessPath:"http://wechat.hand-china.com/hmbms_hand/api/dataEngine",currentVersion:"2.0.0",url:"",pkgIdentifier:"",versionName:"此版本为dev测试环境 2.0.0",appEnvironment:"UAT"});var utilModule=angular.module("utilModule",[]),HmsModule=angular.module("HmsModule",[]),loginModule=angular.module("loginModule",[]),messageModule=angular.module("messageModule",[]),contactModule=angular.module("contactModule",[]),applicationModule=angular.module("applicationModule",[]),myInfoModule=angular.module("myInfoModule",[]),tsApproveModule=angular.module("tsApproveModule",[]);HmsModule.directive("hideTabs",function(e){return{restrict:"A",link:function(o,t,a){o.$on("$ionicView.beforeEnter",function(){o.$watch(a.hideTabs,function(o){console.log("$ionicView.beforeEnter value "+o),o?e.hideTabs=!1:e.hideTabs=!0})}),o.$on("$ionicView.beforeLeave",function(){e.hideTabs=!0,console.log("$ionicView.beforeLeave value ")})}}}),HmsModule.directive("footerSelect",function(){return{restrict:"E",scope:{selectAllItem:"&",passThrough:"&",refuse:"&"},template:'<ion-footer-bar class="foot-bar"><div class="row buttons"><button class="button button-clear ts-button-left" ng-click="selectAllItem()">全选</button><button class="button button-clear ts-button-center" ng-click="passThrough()">通过</button><button class="button button-clear ts-button-right" ng-click="refuse()">拒绝</button></div></ion-footer-bar>',replace:!0,transclude:!1,controller:["$scope",function(e){}],link:function(e,o,t,a){}}}),HmsModule.directive("customHeadBar",function(){return{restrict:"E",scope:{actionName:"@",customTitle:"@",goBackPage:"&",doAction:"&"},template:'<div class="custom-head"><div class="row custom-first-head"><button class="button button-clear back-button" ng-click="goBackPage()"><i class="ion-ios-arrow-back"></i><span class="back-text">返回</span></button><button class="button button-clear action-button" ng-click="doAction()" ng-bind="actionName"></button></div><div class="ts-list-title" ng-bind="customTitle"></div><div class="custom-second-head" ng-transclude></div></div>',replace:!0,transclude:!0,controller:["$scope",function(e){}],link:function(e,o,t,a){}}}),HmsModule.directive("hmsWorkflowList",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{title:"=workflowTitle",icon:"=workflowIcon",type:"=workflowType",typeValue:"=workflowTypeValue",node:"=workflowNode",nodeValue:"=workflowNodeValue",submit:"=workflowSubmit",submitPerson:"=workflowSubmitPerson"},template:'<a class="workflow-list"><div class="workflow-list-logo"><img src="{{icon}}"/></div><div class="workflow-list-header">{{title}}</div><div class="workflow-list-content"><div class="row no-padding"><div class="col col-90 no-padding"><div class="row no-padding"> <div class="col col-33 no-padding color-type">{{type}}</div><div class="col col-67 no-padding color-content">{{typeValue}}</div></div><div class="row no-padding"><div class="col col-33 no-padding color-type">{{node}}</div><div class="col col-67 no-padding color-content">{{nodeValue}}</div></div><div class="row no-padding"><div class="col col-33 no-padding color-type">{{submit}}</div><div class="col col-67 no-padding color-content">{{submitPerson}}</div></div></div><div class="col col-10 no-padding col-center workflow-list-select"><img src="build/img/workflow/select@3x.png"/></div></div></div></a>',controller:["$scope",function(e){}],link:function(e,o,t){}}}),angular.module("HmsModule").directive("hmsslidecalendar",["$animate","$timeout","$compile","$ionicHistory","$ionicScrollDelegate",function(e,o,t,a,n){return{restrict:"E",replace:!0,transclude:!0,scope:{autoPlay:"=",doesContinue:"@",slideInterval:"@",showPager:"@",pagerClick:"&",disableScroll:"@",onSlideChanged:"&",activeSlide:"=?",bounce:"@"},controller:["$scope","$element","$attrs",function(e,t,a){function n(e){return"undefined"!=typeof e}console.log("$element[0] "+angular.toJson(t[0]));var l=e.$eval(e.doesContinue)===!0,i=e.$eval(e.bounce)!==!1,r=n(a.autoPlay)?!!e.autoPlay:!1,s=r?e.$eval(e.slideInterval)||4e3:0;console.log("continuous "+l),console.log("bouncing "+i),console.log("shouldAutoPlay "+r),console.log("slideInterval "+s);var c=new ionic.views.calendar({el:t[0],auto:s,continuous:l,startSlide:e.activeSlide,bouncing:i,slidesChanged:function(){e.currentSlide=c.currentIndex(),o(function(){})},callback:function(t){e.currentSlide=t,e.onSlideChanged({index:e.currentSlide,$index:e.currentSlide}),e.$parent.$broadcast("slideBox.slideChanged",t),e.activeSlide=t,o(function(){})},onDrag:function(){console.log("slider.onDrag "),freezeAllScrolls(!0)},onDragEnd:function(){console.log("slider.onDragEnd "),freezeAllScrolls(!1)}});e.$watch("activeSlide",function(e){console.log("slider.scope.activeSlide "),n(e)&&c.slide(e)}),e.$on("slideBox.nextSlide",function(){console.log("slider.slideBox.nextSlide "),c.next()}),e.$on("slideBox.prevSlide",function(){console.log("slider.slideBox.prevSlide "),c.prev()}),e.$on("slideBox.setSlide",function(e,o){console.log("slider.slideBox.setSlide "),c.slide(o)}),this.__slider=c,e.$on("$destroy",function(){console.log("$destroy ")}),o(function(){})}],template:'<div class="slider"><div class="slider-slides" ng-transclude></div></div>',link:function(o,t,a){e.enabled(t,!1)}}}]),angular.module("utilModule").factory("httpRequestHeader",function(){var e={request:function(e){if(window.localStorage.token&&window.localStorage.empno){var o=(new Date).getTime(),t=CryptoJS.MD5(window.localStorage.token+o);e.headers.timestamp=o,e.headers.token=t,e.headers.loginName=window.localStorage.empno}return e}};return e}),HmsModule.filter("weekDay",function(){return function(e){if(""==e)return e;var o=new Date(e),t=o.getDay();switch(t){case 0:e+="　星期天";break;case 1:e+="　星期一";break;case 2:e+="　星期二";break;case 3:e+="　星期三";break;case 4:e+="　星期四";break;case 5:e+="　星期五";break;case 6:e+="　星期六"}return e}});var log=console.log.bind(console),warn=console.warn.bind(console),error=console.error.bind(console);angular.module("HmsModule").factory("hmsHttp",["$log","$http","hmsPopup",function(e,o,t){var a="HmsHttp",n="isSucessfull",l=a+".noAuthorPost",i=a+".post",r=a+".get",s=function(e){Prompter.hideLoading(),e.go("login")},c={goBackLogin:function(e){s(e)},isSuccessfull:function(o){return e.debug(n+" Start!"),e.debug(l+" status "+o),"S"==o||"SW"==o},post:function(t,a){e.debug(i+" Start!"),e.debug(i+" url "+t),e.debug(i+" paramter "+angular.toJson(a));var n=o.post(t,a).success(function(o){e.debug(i+" success"),e.debug(i+" response "+angular.toJson(o)),e.debug(i+" End!")}).error(function(o,t){e.debug(i+" error"),e.debug(i+" response "+o),e.debug(i+" status "+t),e.debug(i+" End!")});return n},get:function(t){e.debug(r+" Start!"),e.debug(r+" url "+t);var a=o.get(t).success(function(o){e.debug(r+" success"),e.debug(r+" response "+angular.toJson(o)),e.debug(r+" End!")}).error(function(o,t){e.debug(r+" error"),e.debug(r+" response "+o),e.debug(r+" status "+t),e.debug(r+" End!")});return a}};return c}]).service("hmsPopup",["$ionicLoading","$cordovaToast","$ionicPopup","baseConfig",function(e,o,t,a){this.showLoading=function(o){e.show({template:'<ion-spinner icon="ios" class="spinner spinner-ios spinner-stable"></ion-spinner><div style="color: white;font-size: 12px;text-align: center;height:25px;line-height: 25px;">'+o+"</div>"})},this.hideLoading=function(){e.hide()},this.showShortCenterToast=function(t){a.nativeScreenFlag?o.showLongBottom(angular.isDefined(t)?t:"操作失败").then(function(e){},function(e){}):e.show({template:angular.isDefined(t)?t:"操作失败",animation:"fade-in",showBackdrop:!1,maxWidth:200,duration:2e3})},this.showPopup=function(e,o){if(a.nativeScreenFlag){var n=function(){};navigator.notification.alert(e,n,"提示","确定")}else t.show({title:"提示",template:e,buttons:[{text:"确定",type:"button button-cux-popup-confirm"}]})},this.prompt=function(e,o,n,l){if(a.nativeScreenFlag)navigator.notification.prompt(o,l,"填写信息",["确定","退出"],"");else{var i=t.show({template:'<input type="type" ng-model="myScope.data.city">',title:o,subTitle:o,scope:e,buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-positive",onTap:function(o){return e.myScope.data.city?e.myScope.data.city:void o.preventDefault()}}]});i.then(n)}},this.confirm=function(e,o,a){if(ROOTCONFIG.isMobilePlatform)navigator.notification.confirm(e,a,o,["确定","取消"]);else{var n=t.confirm({title:angular.isDefined(o)?o:"提示",template:e,cancelText:"取消",cancelType:"button-cux-popup-cancel",okText:"确定",okType:"button-cux-popup-confirm"});n.then(a)}}}]).factory("hmsReturnView",["$ionicHistory","baseConfig",function(e,o){var t=(window.screen.width-50,{width:""});return{go:function(o){var t=e.currentHistoryId(),a=e.viewHistory().histories[t],n=a.stack.length-1-o;e.backView(a.stack[n]),e.goBack()},returnToState:function(t){var a=e.currentHistoryId(),n=e.viewHistory().histories[a];o.debug&&console.log("history.stack.length : "+n.stack.length);for(var l=n.stack.length-1;l>=0;l--)o.debug&&console.log("history.stack[i].stateName : "+n.stack[l].stateName),n.stack[l].stateName==t&&(e.backView(n.stack[l]),e.goBack())},getStackList:function(e,t){var a=[],n=e.currentHistoryId(),l=e.viewHistory().histories[n];o.debug&&console.log(e.viewHistory());for(var i="#F99D32",r=0;r<l.stack.length;r++){r==l.stack.length-1&&(i="black");var s={viewId:l.stack[r].viewId,stateName:l.stack[r].stateName,title:l.stack[r].title,color:{color:i}};o.debug&&console.log(l.stack[r]),a.push(s)}return a[a.length-1].title=t,a},getWidth:function(){return t}}}]).factory("hmsBackLine",["$ionicHistory","baseConfig",function(e){var o,t=window.screen.width-50,a={width:""},n=0,l=[];return{getViews:function(e){o=e.toString().length,ROOTCONFIG.debug&&console.log(o);for(var i=0;i<l.length;i++)if(e==l[i].name){l=l.slice(0,i+1),n=0;for(var r=0;r<l.length;r++)n=r==l.length-1?n+14*l[r].name.toString().length+8:n+14*l[r].name.toString().length+18+8;console.log(n),t>n?a.width="":a.width=n+"px";for(var s=0;s<l.length-1;s++)l[s].myStyle.color="#F99D32";return console.log(l),l[l.length-1].myStyle.color="black",l}var c={name:e,myStyle:{color:""}};l.push(c),n=0;for(var p=0;i<l.length;p++)n=p==l.length-1?n+14*l[p].name.toString().length+8:n+14*l[p].name.toString().length+18+8;n>t&&(a.width=n+"px");for(var u=0;u<l.length-1;i++)l[u].myStyle.color="#F99D32";return l},getWidth:function(){return a}}}]).factory("$hmsHelp",["$ionicTemplateLoader","$ionicBackdrop","$q","$timeout","$rootScope","$ionicBody","$compile","$ionicPlatform","$ionicModal","IONIC_BACK_PRIORITY",function(e,o,t,a,n,l,i,r,s,c){function p(e,o){o?e.$$hashKey=o:delete e.$$hashKey}function u(e,o){var t=e.$$hashKey;baseConfig.debug&&console.log(arguments);for(var a=1,n=arguments.length;n>a;a++){var l=arguments[a];if(l)for(var i=Object.keys(l),r=0,s=i.length;s>r;r++){var c=i[r];e[c]=l[c]}}return p(e,t),e}function d(){var e={};return e.scope=n.$new(),e.element=angular.element(h),e.responseDeferred=t.defer(),l.get().appendChild(e.element[0]),baseConfig.debug&&debug(e.element),i(e.element)(e.scope),u(e.scope,{title:"",$buttonTapped:function(){baseConfig.debug&&debug("$buttonTapped"),e.responseDeferred.resolve(1)}}),e.show=function(){e.isShown||e.removed||(s.stack.add(e),e.isShown=!0,ionic.requestAnimationFrame(function(){e.isShown&&f(e.element)}))},e.hide=function(o){return baseConfig.debug&&console.log("4 self.hide "+o),o=o||function(){},e.isShown?(s.stack.remove(e),e.isShown=!1,void a(o,250,!1)):o()},e.remove=function(){baseConfig.debug&&console.log("5 self.remove "),!e.removed&&s.stack.isHighest(e)&&(e.hide(function(){e.element.remove(),e.scope.$destroy()}),e.removed=!0)},e}function g(){var e=y[y.length-1];e&&e.responseDeferred.resolve()}function m(){function e(){y.push(o),baseConfig.debug&&console.log("popupStack.push(popup)"),a(o.show,t,!1),o.responseDeferred.promise.then(function(e){var t=y.indexOf(o);return-1!==t&&y.splice(t,1),baseConfig.debug&&console.log("popupStack.length"),y.length>0?y[y.length-1].show():(a(function(){!y.length},400,!1),(w._backButtonActionDone||function(){})()),o.remove(),e})}var o=$HmsHelp._createPopup(),t=0;return y.length>0?(y[y.length-1].hide(),t=b.stackPushDelay):w._backButtonActionDone=r.registerBackButtonAction(g,c.popup),o.responseDeferred.promise.close=function(e){o.removed||o.responseDeferred.resolve(e)},o.responseDeferred.notify({close:o.responseDeferred.close}),e(),o.responseDeferred.promise}function f(e){var o=e[0].querySelector("[autofocus]");o&&o.focus()}var h,b={stackPushDelay:75};h=ionic.Platform.isIOS()?'<div style="position: absolute;top:2px;left: -4px;bottom: 0;right: 0;background: url(img/mainHide.png); background-size: cover;;z-index: 12;"><div style="height: 100%;width: 100%;background: none" ng-click="$buttonTapped()"></div></div>':'<div style="position: absolute;top: -14px;left: -4px;bottom: 0;right: 0;background: url(img/mainHide.png); background-size: cover;;z-index: 12;"><div style="height: 100%;width: 100%;background: none" ng-click="$buttonTapped()"></div></div>';var y=[],w={showPopup:m,_createPopup:d,_popupStack:y};return w}]).factory("hmsFastPath",function(){var e={configFastPath:function(e,o,t){e.screenWidth={width:window.screen.width-50+"px"},e.scrollWidth=o.getWidth();var a=document.getElementsByTagName("ion-view"),n=a[a.length-1].attributes[0].value;e.currentStackList=o.getStackList(t,n),e.goStack=function(e){o.returnToState(e.stateName)}}};return e}),angular.module("myApp",["ionic","ngCordova","loginModule","baseConfig","messageModule","contactModule","applicationModule","myInfoModule","utilModule","tsApproveModule","HmsModule"]),angular.module("myApp").run(function(e){e.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!1),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}),angular.module("myApp").config(["$stateProvider","$urlRouterProvider","$httpProvider","$ionicConfigProvider",function(e,o,t,a){t.interceptors.push("httpRequestHeader"),a.platform.ios.tabs.style("standard"),a.platform.ios.tabs.position("bottom"),a.platform.android.tabs.style("standard"),a.platform.android.tabs.position("standard"),a.platform.ios.navBar.alignTitle("center"),a.platform.android.navBar.alignTitle("center"),a.platform.android.backButton.previousTitleText("").icon("ion-android-arrow-back"),a.platform.ios.views.transition("ios"),a.platform.android.views.transition("android"),e.state("tab",{url:"/tab","abstract":!0,templateUrl:"build/pages/tab/tabs.html",controller:"TabsCtrl"}).state("tab.message",{url:"/message",views:{"tab-message":{templateUrl:"build/pages/message/message.html",controller:"messageCtrl"}}}).state("tab.messageDetail",{url:"/messageDetail",params:{message:{}},views:{"tab-message":{templateUrl:"build/pages/message/detail/messageDetail.html",controller:"messageDetailCtrl"}}}).state("tab.contact",{url:"/contact",views:{"tab-contact":{templateUrl:"build/pages/contact/contact.html",controller:"contactCtrl"}}}).state("tab.application",{url:"/application",views:{"tab-application":{templateUrl:"build/pages/application/application.html",controller:"applicationCtrl"}}}).state("tab.myInfo",{url:"/myInfo",views:{"tab-myInfo":{templateUrl:"build/pages/myInfo/myInfo.html",controller:"myInfoCtrl"}}}).state("guide",{url:"/guide",templateUrl:"build/pages/guide/guide.html",controller:"guideCtrl"}).state("login",{url:"/login",templateUrl:"build/pages/login/login.html",controller:"loginCtrl"}),window.localStorage.token&&""!=window.localStorage.token?o.otherwise("/tab/message"):o.otherwise("/login")}]),angular.module("applicationModule").controller("applicationCtrl",["$scope","$state","baseConfig",function(e,o,t){e.officeApp=[{appName:"会议管理",imageUrl:"build/img/application/meetingManage@3x.png",destUrl:""},{appName:"个人申请",imageUrl:"build/img/application/meetingManage@3x.png",destUrl:""},{appName:"报表分析",imageUrl:"build/img/application/meetingManage@3x.png",destUrl:""},{appName:"人事政策",imageUrl:"build/img/application/meetingManage@3x.png",destUrl:""},{appName:"假期管理",imageUrl:"build/img/application/holidayManage@3x.png",destUrl:"tab.time-off-manage"},{appName:"住宿申请",imageUrl:"build/img/application/dorm-apply/dorm-apply.png",destUrl:"tab.dorm-apply"},{appName:"Timesheet填写",imageUrl:"build/img/application/timesheet@3x.png",destUrl:"tab.timesheet"},{appName:"Timesheet审批",imageUrl:"build/img/application/timesheetExamine@3x.png",destUrl:"tab.tsApproveList"}],e.projectApp=[{appName:"机票预定",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"代办事项",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:"tab.workflow-list"},{appName:"报销单查询",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"首款查询",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"外勤汇报",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"",imageUrl:"",destUrl:""},{appName:"",imageUrl:"",destUrl:""},{appName:"",imageUrl:"",destUrl:""}],e.employeeApp=[{appName:"在线培训",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"知识门户",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"新闻",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""},{appName:"分享社区",imageUrl:"build/img/application/flightBooking@3x.png",destUrl:""}],e.goPage=function(e){t.debug&&console.log("appItem "+angular.toJson(e)),o.go(e.destUrl)},console.log("applicationCtrl.enter"),e.$on("$ionicView.enter",function(e){console.log("applicationCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){console.log("applicationCtrl.$destroy")})}]),angular.module("contactModule").controller("contactCtrl",["$scope","$state",function(e,o){console.log("contactCtrl.enter"),e.$on("$ionicView.enter",function(e){console.log("contactCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){console.log("contactCtrl.$destroy")})}]),angular.module("loginModule").controller("guideCtrl",["$scope","$state",function(e,o){console.log("loginCtrl.enter"),e.toLogin=function(){console.log("跳过导航页到登陆页"),o.go("login")},e.$on("$ionicView.enter",function(e){console.log("guideCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){console.log("guideCtrl.$destroy")})}]),angular.module("loginModule").controller("loginCtrl",["$scope","$state","baseConfig","$ionicLoading","$http","$timeout","$ionicHistory","hmsPopup",function(e,o,t,a,n,l,i,r){e.loginData={},e.currentVersionNum=t.versionName,window.localStorage.empno&&(e.loginData.username=window.localStorage.empno),window.localStorage.checkboxSavePwd||(e.checkboxSavePwd=!0,window.localStorage.checkboxSavePwd="true"),"true"==window.localStorage.checkboxSavePwd?(e.checkboxSavePwd=!0,e.loginData.password=window.localStorage.password):e.checkboxSavePwd=!1,t.debug&&console.log("loginCtrl.enter"),e.savePassword=function(){e.checkboxSavePwd=!e.checkboxSavePwd,t.debug&&console.log("此时密码框的状态为 :",angular.toJson(e.checkboxSavePwd)),""!==e.loginData.password&&(e.checkboxSavePwd===!0?window.localStorage.password=e.loginData.password:window.localStorage.password="")},e.clearUser=function(){e.loginData.username=""},e.clearPassword=function(){e.loginData.password=""},e.doLogin=function(){if(window.localStorage.empno=e.loginData.username,e.checkboxSavePwd?window.localStorage.password=e.loginData.password:window.localStorage.password="",!e.loginData.username||""==e.loginData.username)return void r.showPopup("用户名不能为空");if(!e.loginData.password||""==e.loginData.password)return void r.showPopup("密码不能为空");var a=t.basePath+"/appLogin/user_login/login",l={params:{p_user_name:+e.loginData.username,p_password:e.loginData.password}};r.showLoading("登陆中..."),n.post(a,l).success(function(a){r.hideLoading(),t.debug&&console.log("result success "+angular.toJson(a)),a.status||"S"!=a.con_status?r.showPopup("登陆失败,可能是密码不对!"):(window.localStorage.token=a.pre_token+a.token_key,window.localStorage.empno=e.loginData.username,window.localStorage.checkboxSavePwd=e.checkboxSavePwd,o.go("tab.message"))}).error(function(e,o){r.hideLoading(),t.debug&&console.log("response error "+angular.toJson(e))})},e.$on("$ionicView.enter",function(e){t.debug&&console.log("loginCtrl.$ionicView.enter"),l(function(){i.clearCache(),i.clearHistory()},400)}),e.$on("$destroy",function(e){t.debug&&console.log("loginCtrl.$destroy")})}]),angular.module("messageModule").controller("messageCtrl",["$scope","$state","$timeout","$ionicPlatform",function(e,o,t,a){e.messageList=[],a.ready(function(){window.StatusBar&&StatusBar.styleLightContent()}),e.talk=function(e){console.log("$scope.talk"),o.go("tab.messageDetail",{message:e})},e.refresh=function(){t(function(){e.$broadcast("scroll.refreshComplete")},2e3)},console.log("messageCtrl.enter"),e.$on("$ionicView.enter",function(e){console.log("messageCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){console.log("messageCtrl.$destroy")})}]),angular.module("myInfoModule").controller("myInfoCtrl",["$scope","$state","baseConfig",function(e,o,t){t.debug&&console.log("myInfoCtrl.enter"),e.logout=function(){window.localStorage.token="",window.localStorage.password="",o.go("login")},e.$on("$ionicView.enter",function(e){t.debug&&console.log("myInfoCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){t.debug&&console.log("myInfoCtrl.$destroy")})}]),angular.module("loginModule").controller("TabsCtrl",["$scope","$rootScope","$state","baseConfig",function(e,o,t,a){o.$on("$ionicView.beforeEnter",function(){var o=t.current.name;a.debug&&console.log("$ionicView.beforeEnter statename "+o),"tab.message"!=o&&"tab.application"!=o&&"tab.contact"!=o&&"tab.myInfo"!=o&&(e.hideTabs=!0)}),o.$on("$ionicView.afterEnter",function(){var o=t.current.name;a.debug&&console.log("$ionicView.afterEnter statename "+o),"tab.message"!==o&&"tab.application"!==o&&"tab.contact"!==o&&"tab.myInfo"!==o||(e.hideTabs=!1,e.$apply())})}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.dorm-apply-detail-a",{url:"/dorm-apply-detail-a",views:{"tab-application":{templateUrl:"build/pages/application/dorm-apply/dorm-apply-detail-a.html",controller:"DormApplyDetailFirstCtrl"}}})}]),angular.module("applicationModule").controller("DormApplyDetailFirstCtrl",["$scope","$state","baseConfig","$ionicHistory","dormApplyTypeService","hmsHttp","hmsPopup","$rootScope","$timeout",function(e,o,t,a,n,l,i,r,s){e.applyInfo=n.getInfo(),e.approving=!1,e.rejected=!1,e.approvedResult="","审批中"==e.applyInfo.status?(e.approving=!0,e.rejected=!1,e.approvedResult=""):"已拒绝"==e.applyInfo.status&&(e.approving=!1,e.rejected=!0,e.approvedResult="已拒绝"),e.goBack=function(){a.goBack()},e.cancelApply=function(){var o=t.businessPath+"/wfl_apply_room/cancel_application",n={params:{p_apply_id:e.applyInfo.applyId,p_employee_number:window.localStorage.empno}};i.showLoading("请稍候"),l.post(o,n).success(function(e){i.hideLoading();var o=e.message;i.showShortCenterToast(o),"S"==e.status&&(r.$broadcast("APPLY_CANCELLED"),a.goBack()),t.debug&&console.log("result success "+angular.toJson(e))}).error(function(e,o){i.hideLoading(),t.debug&&console.log("response error "+angular.toJson(e))})}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.dorm-apply-detail-b",{url:"/dorm-apply-detail-b",views:{"tab-application":{templateUrl:"build/pages/application/dorm-apply/dorm-apply-detail-b.html",controller:"DormApplyDetailSecondCtrl"}}})}]),angular.module("applicationModule").controller("DormApplyDetailSecondCtrl",["$scope","$state","baseConfig","$ionicHistory","dormApplyTypeService","hmsHttp","hmsPopup","$rootScope","$timeout",function(e,o,t,a,n,l,i,r,s){e.applyInfo=n.getInfo(),e.checkIn=!1,e.checkOut=!1,e.buttonText="","已入住"==e.applyInfo.status?(e.checkIn=!0,e.checkOut=!1,e.buttonText="续住"):"已退房"==e.applyInfo.status&&(e.checkIn=!1,e.checkOut=!0,e.buttonText="再次预定"),e.goBack=function(){a.goBack()},e.renewContract=function(){var o=t.businessPath+"/wfl_apply_room/overstay_apply_room",n={params:{p_employee_number:window.localStorage.empno,p_checkin_date:"20160815",p_checkout_date:"20160920",p_room_number:e.applyInfo.roomNumber,p_bed_number:e.applyInfo.bedNumber,p_apply_type:e.applyInfo.applyType,p_reason:""}};i.showLoading("请稍候"),l.post(o,n).success(function(e){i.hideLoading();var o=e.message;i.showShortCenterToast(o),"S"==e.status&&(r.$broadcast("APPLY_SUCCESS"),a.goBack()),t.debug&&console.log("result success "+angular.toJson(e))}).error(function(e,o){i.hideLoading(),t.debug&&console.log("response error "+angular.toJson(e))})}}]),angular.module("applicationModule").factory("dormApplyTypeService",function(){var e="";return{getInfo:function(){return e},putInfo:function(o){e=o}}}).factory("dormApplySearchResultService",function(){var e="";return{getInfo:function(){return e},putInfo:function(o){e=o}}}),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.dorm-apply-vacant-room",{url:"/dorm-apply-vacant-room",views:{"tab-application":{templateUrl:"build/pages/application/dorm-apply/dorm-apply-vacant-room.html",controller:"DormApplyVacantRoomCtrl"}}})}]),angular.module("applicationModule").controller("DormApplyVacantRoomCtrl",["$scope","$rootScope","$state","baseConfig","$ionicHistory","dormApplySearchResultService","hmsHttp","hmsPopup","$timeout",function(e,o,t,a,n,l,i,r,s){var c=l.getInfo();e.roomlist=c.result,e.goBack=function(){n.goBack()},e.applyRoom=function(t){var l=a.businessPath+"/wfl_apply_room/apply_room",s={params:{p_employee_number:window.localStorage.empno,p_checkin_date:c.checkinDate,p_checkout_date:c.checkoutDate,p_room_number:e.roomlist[t].room_number,p_bed_number:e.roomlist[t].bed_number,p_apply_type:c.applyType,p_reason:""}};r.showLoading("请稍候"),i.post(l,s).success(function(e){r.hideLoading();var t=e.message;r.showShortCenterToast(t),"S"==e.status&&(n.goBack(-2),o.$broadcast("APPLY_SUCCESS")),a.debug&&console.log("result success "+angular.toJson(e))}).error(function(e,o){r.hideLoading(),a.debug&&console.log("response error "+angular.toJson(e))})}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.dorm-apply",{url:"/dorm-apply",views:{"tab-application":{templateUrl:"build/pages/application/dorm-apply/dorm-apply.html",controller:"DormApplyCtrl"}}})}]),angular.module("applicationModule").controller("DormApplyCtrl",["$scope","$rootScope","$state","baseConfig","$ionicHistory","dormApplyTypeService","hmsHttp","hmsPopup","$ionicScrollDelegate","$timeout",function(e,o,t,a,n,l,i,r,s,c){function p(){e.items=[];var o=a.businessPath+"/wfl_apply_room/query_room_history_list",t={params:{p_employee_number:window.localStorage.empno}};i.post(o,t).success(function(o){a.debug&&console.log("result success "+angular.toJson(o)),e.items=o.result;var t=0;for(t;t<e.items.length;t++)"已入住"==e.items[t].apply_status?(e.items[t].modeCheckIn=!0,e.items[t].modeCheckOut=!1,e.items[t].modeApproving=!1,e.items[t].modeRejected=!1):"已退房"==e.items[t].apply_status?(e.items[t].modeCheckIn=!1,e.items[t].modeCheckOut=!0,e.items[t].modeApproving=!1,e.items[t].modeRejected=!1):"审批中"==e.items[t].apply_status?(e.items[t].modeCheckIn=!1,e.items[t].modeCheckOut=!1,e.items[t].modeApproving=!0,e.items[t].modeRejected=!1):"已拒绝"==e.items[t].apply_status&&(e.items[t].modeCheckIn=!1,e.items[t].modeCheckOut=!1,e.items[t].modeApproving=!1,e.items[t].modeRejected=!0)}).error(function(e,o){r.hideLoading(),a.debug&&console.log("response error "+angular.toJson(e))})}e.descriptionAppearance=!1,e.items=[],p(),e.goBack=function(){n.goBack()},e.createNewDormApply=function(){t.go("tab.new-dorm-apply")},e.viewApplyDetail=function(o){var a=e.items[o],n={status:a.apply_status,checkinDate:a.checkin_date,checkoutDate:a.checkout_date,applyType:a.apply_type,floorNumber:a.floor_number,roomNumber:a.room_number,roomType:a.room_type,bedNumber:a.bed_number,applyId:a.apply_id};l.putInfo(n),"已入住"==n.status||"已退房"==n.status?t.go("tab.dorm-apply-detail-b"):"审批中"!=n.status&&"已拒绝"!=n.status||t.go("tab.dorm-apply-detail-a")},e.judgeApplyType=function(e){var o=e.apply_status;return"已入住"==o||"已退房"==o?!0:"审批中"==o||"已拒绝"==o?!1:void 0},e.showDescription=function(){e.descriptionAppearance=!0},e.hideDescription=function(){e.descriptionAppearance=!1},o.$on("APPLY_SUCCESS",function(){c(function(){s.$getByHandle("dormScroll").scrollTop(!1)},200),p()}),o.$on("APPLY_CANCELLED",function(){c(function(){s.$getByHandle("dormScroll").scrollTop(!1)},200),p()})}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.new-dorm-apply",{url:"/new-dorm-apply",views:{"tab-application":{templateUrl:"build/pages/application/dorm-apply/new-dorm-apply.html",controller:"NewDormApplyCtrl"}}})}]),angular.module("applicationModule").controller("NewDormApplyCtrl",["$scope","$state","baseConfig","$ionicHistory","$ionicModal","hmsHttp","hmsPopup","dormApplySearchResultService",function(e,o,t,a,n,l,i,r){n.fromTemplateUrl("build/pages/application/dorm-apply/modal/new-dorm-apply-choose-apply-type.html",{scope:e}).then(function(o){e.chooseTypePopup=o}),n.fromTemplateUrl("build/pages/application/dorm-apply/modal/new-dorm-apply-choose-room-type.html",{scope:e}).then(function(o){e.chooseRoomPopup=o}),n.fromTemplateUrl("build/pages/application/dorm-apply/modal/new-dorm-apply-choose-project-name.html",{scope:e}).then(function(o){e.chooseProjectPopup=o}),e.defaultApplyType="常驻申请",e.defaultRoomType="单人间",e.defaultProjectInfo={projectName:"",projectId:""},e.showProjectItem=!1,e.applytype=["常驻申请","加班申请","临时申请","项目申请"],e.roomtype=["单人间","四人间"],e.projectlist=[],e.showNumButton=!0,e.inputinfo={floornum:"",roomnum:""};var s=t.businessPath+"/wfl_apply_room/query_project_list",c={params:{p_employee_number:window.localStorage.empno}};i.showLoading("请稍候"),l.post(s,c).success(function(o){i.hideLoading(),"S"==o.status&&(e.projectlist=o.result,e.projectlist=e.projectlist.splice(1,e.projectlist.length-1),e.projectlist.length>0?(e.defaultProjectInfo.projectName=e.projectlist[0].project_name,e.defaultProjectInfo.projectId=e.projectlist[0].project_id,console.log(angular.toJson(e.defaultProjectInfo))):0==e.projectlist.length&&(e.defaultProjectInfo.projectName="无",e.defaultProjectInfo.projectId="")),t.debug&&console.log("result success "+angular.toJson(o))}).error(function(e){i.hideLoading(),t.debug&&console.log("response error "+angular.toJson(e))}),e.goBack=function(){a.goBack()},e.chooseApplyType=function(){e.chooseTypePopup.show()},e.chooseRoomType=function(){e.chooseRoomPopup.show()},e.chooseProjectName=function(){0==e.projectlist.length?i.showShortCenterToast("项目列表为空，请更改申请类型"):e.projectlist.length>0&&e.chooseProjectPopup.show()},e.finishChoosingApplyType=function(o){e.defaultApplyType=o,"项目申请"==e.defaultApplyType?e.showProjectItem=!0:"项目申请"!=e.defaultApplyType&&(e.showProjectItem=!1),e.chooseTypePopup.hide()},e.finishChoosingRoomType=function(o){e.defaultRoomType=o,e.chooseRoomPopup.hide()},e.finishChoosingProjectName=function(o){e.defaultProjectInfo.projectName=e.projectlist[o].project_name,e.defaultProjectInfo.projectId=e.projectlist[o].project_id,e.chooseProjectPopup.hide()},e.chooseDays=function(){"常驻申请"==e.defaultApplyType&&(e.showNumButton=!e.showNumButton)},e.searchVacantRoom=function(){if("无"==e.defaultProjectInfo.projectName&&"项目申请"==e.defaultApplyType)i.showShortCenterToast("项目列表为空，请更改申请类型");else{var a=t.businessPath+"/wfl_apply_room/query_free_room_list",n={
params:{p_employee_number:window.localStorage.empno,p_check_in_date:"20160615",p_check_out_date:"20160820",p_apply_type:e.defaultApplyType,p_room_type:e.defaultRoomType,p_room_number:e.inputinfo.roomnum,p_floor_number:e.inputinfo.floornum,p_project_id:""}};"项目申请"==e.defaultApplyType&&(n.params.p_project_id=e.defaultProjectInfo.projectId),i.showLoading("请稍候"),l.post(a,n).success(function(e){var a=e.message;if(i.hideLoading(),"S"==e.status&&e.result.length>0){var l=e.result,s={applyType:n.params.p_apply_type,checkinDate:n.params.p_check_in_date,checkoutDate:n.params.p_check_out_date,result:l};r.putInfo(s),o.go("tab.dorm-apply-vacant-room")}else"E"==e.status&&i.showShortCenterToast(a);t.debug&&console.log("result success "+angular.toJson(e))}).error(function(e,o){i.hideLoading(),t.debug&&console.log("response error "+angular.toJson(e))})}}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.time-off-manage",{url:"/time-off-manage",views:{"tab-application":{templateUrl:"build/pages/application/time-off-manage/timeOffManageList.html",controller:"TimeOffManageCtrl"}}})}]),angular.module("applicationModule").controller("TimeOffManageCtrl",["$scope","$state","baseConfig","$ionicHistory",function(e,o,t,a){}]),angular.module("messageModule").controller("messageDetailCtrl",["$scope","$state","$stateParams","$ionicHistory",function(e,o,t,a){var n=t.message;console.log("message : "+angular.toJson(n)),e.message=n,e.goBack=function(){a.goBack()},e.$on("$ionicView.enter",function(e){console.log("messageDetailCtrl.$ionicView.enter")}),console.log("messageDetailCtrl.enter"),e.$on("$destroy",function(e){console.log("messageDetailCtrl.$destroy")})}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.workflow-list",{url:"/workflow-list",params:{day:{}},views:{"tab-application":{templateUrl:"build/pages/workflow/list/workflow-list.html",controller:"WorkFLowListCtrl"}}})}]),angular.module("applicationModule").controller("WorkFLowListCtrl",["$scope","$state","$stateParams","$ionicModal","$timeout","baseConfig","TimeSheetService","hmsPopup","WorkFLowListService",function(e,o,t,a,n,l,i,r,s){e.list=[],e.fetchDataFlag=!0,e.pullRefreshDataFlag=!1;var c="build/img/application/profile@3x.png",p="工作流类型",u="当前节点",d="提交人",g=function(o){e.list=[],o?(e.fetchDataFlag=!1,e.pullRefreshDataFlag=!0):e.fetchDataFlag=!0;var t=function(t){var a=t.待审批列表;angular.forEach(a,function(o){var t={title1:o.workflow_name,icon:c,type:p,typeValue:o.workflow_name,node:u,nodeValue:o.current_node,submit:d,submitPerson:o.employee_name};e.list.push(t)}),e.fetchDataFlag=!1,o&&(e.pullRefreshDataFlag=!1,e.$broadcast("scroll.refreshComplete"))},a=function(t){e.fetchDataFlag=!1,o&&(e.pullRefreshDataFlag=!1,e.$broadcast("scroll.refreshComplete"))};s.getTodoList(t,a)};g(!1),a.fromTemplateUrl("build/pages/application/timesheet-approve/modal/ts-filter-modal.html",{scope:e}).then(function(o){e.tsFilterModal=o}),e.filterTsInfo=function(){e.tsFilterModal.show()},e.refresh=function(){e.list=[],e.$apply(),n(function(){g(!0)},300)}}]).service("WorkFLowListService",["hmsHttp","baseConfig","hmsPopup",function(e,o,t){this.getTodoList=function(a,n){var l=o.businessPath+"/wfl_wx_workflow_appr/get_instance_list",i={params:{p_employee_code:window.localStorage.empno,p_flag:"N"}};e.post(l,i).success(function(e){a(e)}).error(function(e,o){t.showPopup("获取代办事项出错,可能是网络问题!"),n(e)})}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.tsApproveDetail",{url:"application/tsApproveDetail",views:{"tab-application":{templateUrl:"build/pages/application/timesheet-approve/detail/ts-approve-detail.html",controller:"tsApproveDetailCtrl"}},params:{employeeNumber:"",projectId:"",startDate:"",endDate:""}})}]),tsApproveModule.controller("tsApproveDetailCtrl",["$scope","$state","baseConfig","$ionicHistory","$stateParams","hmsHttp","hmsPopup",function(e,o,t,a,n,l,i){function r(o){e.selectArray=[],s=[],angular.forEach(e.detailInfoArray,function(t,a){"undoSelectAll"==o?(e.selectArray.push(!1),s.push(!1)):"selectedAll"==o&&(e.selectArray.push(!0),s.push(!0))})}var s=[],c=!1;e.detailActionName="操作",e.showActionBar=!1,e.detailInfoArray={},e.selectArray=[];var p=t.businessPath+"/wfl_timesheet_view/query_timesheet_approve_list",u={params:{p_employee_number:n.employeeNumber,p_start_date:n.startDate.toString().replace(/-/g,""),p_end_date:n.endDate.toString().replace(/-/g,""),p_project_id:n.projectId}};i.showLoading("记载中..."),l.post(p,u).success(function(o){i.hideLoading(),l.isSuccessfull(o.status)?e.detailInfoArray=o.timesheet_approve_detail_response:"E"===o.status||"e"==o.status?i.showPopup("提示","<div style='text-align: center'>没有相关数据!</div>"):i.showPopup("提示","<div style='text-align: center'>网络异常,请稍后重试!</div>")}).error(function(e,o){i.hideLoading(),i.showPopup("提示","<div style='text-align: center'>服务请求异常,请检查网络连接和输入参数后重新操作!</div>")}),e.$on("$ionicView.enter",function(e){warn("tsApproveListCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){warn("tsApproveListCtrl.$destroy")}),r("undoSelectAll"),e.dealDetailInfo=function(){"操作"==e.detailActionName?(e.detailActionName="取消",e.showActionBar=!0,angular.element("#tsApproveItem").css("paddingLeft","6%")):"取消"==e.detailActionName&&(e.detailActionName="操作",e.showActionBar=!1,r("undoSelectAll"),angular.element("#tsApproveItem").css("paddingLeft","0"),warn(angular.toJson(e.selectArray,!0)))},e.selectItem=function(o){s[o]=!s[o],s[o]?e.selectArray[o]=!0:e.selectArray[o]=!1},e.selectAllDetail=function(){c=!c,r(c?"selectedAll":"undoSelectAll")},e.passThroughDetailItem=function(){warn("passThroughDetailItem")},e.refuseDetailItem=function(){warn("refuseDetailItem")}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.tsApproveList",{url:"application/tsApproveList",views:{"tab-application":{templateUrl:"build/pages/application/timesheet-approve/list/ts-approve-list.html",controller:"tsApproveListCtrl"}}})}]),angular.module("tsApproveModule").controller("tsApproveListCtrl",["$scope","$state","baseConfig","$ionicModal","$ionicScrollDelegate","$ionicPopup","$timeout","TsApproveListService","hmsPopup",function(e,o,t,a,n,l,i,r,s){function c(o){e.selectArray=[],g=[],angular.forEach(e.listInfoArray,function(t,a){"undoSelectAll"==o?(e.selectArray.push(!1),g.push(!1)):"selectedAll"==o&&(e.selectArray.push(!0),g.push(!0))})}function p(){e.tsFilterModal.hide(),e.showProjectName=!0,e.isClickedProject=[],e.isClickedPerson=[],angular.element("#project-name").addClass("active-select"),angular.element("#project-name").removeClass("active-off"),angular.element("#person-select").removeClass("active-select")}e.showProjectName=!0,e.showRocket=!1,e.showConnectBlock=!1,e.showDetailArrow=!0;var u=!1;e.actionName="操作",e.selectArray=[],e.isClickedProject=[],e.listInfoArray={};var d="",g=[],m=t.businessPath+"/wfl_timesheet_view/get_timesheet_list",f={params:{p_employee_number:window.localStorage.empno,p_start_date:"20160406",p_end_date:"",p_project_name:"",p_project_id:"",p_project_person_number:"",p_page:"1",p_line_number:"7"}},h=(new Date).getDate();10>h?f.params.p_end_date=getLastMonthDate(new Date):h>10&&20>h?f.params.p_end_date=getCurrentDate(new Date):h>20&&(f.params.p_end_date=getCurrentMonthLastDate(new Date)),function(){s.showLoading("加载中..."),e.listInfoArray=new r(e,m,f)}(),e.$on("$ionicView.enter",function(e){}),e.$on("$destroy",function(e){log("tsApproveListCtrl.$destroy")}),c("undoSelectAll"),e.doSelectAction=function(){"操作"==e.actionName?(e.actionName="取消",e.showDetailArrow=!1,angular.element(".ts-approve-list-item").css("paddingLeft","10%")):"取消"==e.actionName&&(e.actionName="操作",e.showDetailArrow=!0,angular.element(".ts-approve-list-item").css("paddingLeft","10px"),c("undoSelectAll"))},e.onDrag=function(){e.showConnectBlock=!1},e.onDragUp=function(){e.showConnectBlock=!0},e.watchScroll=function(){d=n.getScrollPosition().top,e.$apply(function(){0>d?e.showConnectBlock=!1:d>=0&&400>d?(e.showRocket=!1,e.showConnectBlock=!0):d>=400&&(e.showRocket=!0)})},e.tsListRefresh=function(){i(function(){e.$broadcast("scroll.refreshComplete")},1e3)},e.getAttentionInfo=function(o,t){o.stopPropagation(),warn(t),l.show({template:'<div class="warn-attention-icon">'+t[0].description+"</div>",scope:e,buttons:[{text:'<div class="warn-cancel-icon"></div>',type:"button-clear",onTap:function(e){}}]})},e.goTsLsTop=function(){angular.element("#rocket").addClass("ng-hide"),n.scrollTop(!0)},a.fromTemplateUrl("build/pages/application/timesheet-approve/modal/ts-filter-modal.html",{scope:e}).then(function(o){e.tsFilterModal=o}),e.filterTsInfo=function(){e.tsFilterModal.show()},e.goApproveDetail=function(t,a,n,l,i){e.showDetailArrow?(warn(l,i),o.go("tab.tsApproveDetail",{employeeNumber:a,projectId:n,startDate:l,endDate:i})):(g[t]=!g[t],g[t]?e.selectArray[t]=!0:e.selectArray[t]=!1)},e.selectAllList=function(){u=!u,c(u?"selectedAll":"undoSelectAll")},e.passThroughListItem=function(){warn("passThroughDetailItem")},e.refuseListItem=function(){warn("refuseDetailItem")},e.selectScreening=function(o){"projectName"==o?(e.showProjectName=!0,angular.element("#project-name").addClass("active-select"),angular.element("#project-name").removeClass("active-off"),angular.element("#person-select").removeClass("active-select")):"personSelect"==o&&(e.showProjectName=!1,angular.element("#person-select").addClass("active-select"),angular.element("#project-name").addClass("active-off"))},e.selectFilterItem=function(o,t){"projectName"===o?(e.isClickedProject=[],e.isClickedProject[t]=!0):"personSelect"===o&&(e.isClickedPerson=[],e.isClickedPerson[t]=!0)},e.cancelFilter=function(){p()},e.confirmFilter=function(){p()},e.clearFilterParams=function(){e.isClickedProject=[],e.isClickedPerson=[]}}]).service("TsApproveListService",["hmsHttp","baseConfig","hmsPopup",function(e,o,t){var a=function(a,n,l,i){var r=this;r.scope=a,r.url=n,r.params={},r.params=l,r.refurbishParam=i,r.busy=!1,r.totalNumber=0,r.listArray=[],r.projectList=[],r.employeeList=[],"clickRefreshEvent"===r.refurbishParam&&r.scope.$broadcast("scroll.infiniteScrollComplete"),e.post(r.url,r.params).success(function(a){try{if(e.isSuccessfull(a.status)){var n=a.timesheet_approve_response;o.debug&&warn("hi,create a new factory!!\n"+jsonFormat()),r.totalNumber=a.count;try{r.listArray=r.listArray.concat(n.result_list),r.projectList=r.projectList.concat(n.project_list),r.employeeList=r.employeeList.concat(n.project_person_list)}catch(l){r.listArray=[],r.projectList=[],r.employeeList=[]}0==a.count?(r.busy=!1,r.listArray=[]):a.count<=5?r.busy=!1:r.busy=!0,r.scope.$broadcast("scroll.refreshComplete"),r.scope.$broadcast("scroll.infiniteScrollComplete")}else"E"===a.status||"e"==a.status?t.showPopup("提示","<div style='text-align: center'>没有相关数据!</div>"):t.showPopup("提示","<div style='text-align: center'>网络异常,请稍后重试!</div>"),r.scope.$broadcast("scroll.refreshComplete"),r.scope.$broadcast("scroll.infiniteScrollComplete");t.hideLoading()}catch(l){}}.bind(r)).error(function(e){r.params.p_line_number=1,r.busy=!1,t.hideLoading(),r.scope.$broadcast("scroll.refreshComplete"),r.scope.$broadcast("scroll.infiniteScrollComplete"),t.showPopup("提示","<div style='text-align: center'>服务请求异常,请检查网络连接和输入参数后重新操作!</div>")}.bind(r))};return a.prototype.nextPage=function(){var a=this;if(o.debug&&console.log("enter next page!"),a.busy){if(a.busy&&"clickRefreshEvent"===a.refurbishParam)return a.refurbishParam="",void a.scope.$broadcast("scroll.infiniteScrollComplete");a.busy=!0,a.params.p_line_number++,e.post(a.url,a.params).success(function(o){try{e.isSuccessfull(o.status)?a.scope.$broadcast("scroll.infiniteScrollComplete"):a.scope.$broadcast("scroll.infiniteScrollComplete")}catch(t){}}.bind(a)).error(function(e){a.params.p_line_number=1,a.scope.$broadcast("scroll.infiniteScrollComplete"),a.busy=!1,t.hideLoading(),t.showPopup("提示","<div style='text-align: center'>网络异常,请稍后重试!</div>")}.bind(a))}},a}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.timesheet",{url:"/timesheet",views:{"tab-application":{templateUrl:"build/pages/application/timesheet/query/query.html",controller:"TimeSheetQueryCtrl"}}})}]),angular.module("applicationModule").controller("TimeSheetQueryCtrl",["$scope","$state","baseConfig","$ionicHistory","$timeout","$ionicScrollDelegate","TimeSheetService","hmsHttp",function(e,o,t,a,n,l,r,s){e.calendar=[];var c=!0;e.loadingDataFlag=!0;var p=function(){for(e.calendar=[],i=0;i<5;i++){var o="each-day",t="day-item",a="",n="",l={week:i,list:[]};for(j=0;j<7;j++){var r={day:i+""+j,style_outline:o,style_color:t,money:a,project:n};l.list.push(r)}e.calendar.push(l)}};test=function(){var e=t.businessPath+"/wfl_timesheet_view/get_timesheet_list",o={params:{p_employee_number:"4040",p_start_date:"2015-11-01",p_end_date:"2015-11-01",p_project_name:"",p_project_id:"",p_project_person_number:"",p_page:"1",p_line_number:"5"}};s.post(e,o).success(function(e){t.debug&&console.log("result success "+angular.toJson(e))}).error(function(e,o){t.debug&&console.log("response error "+angular.toJson(e))})},test(),p(),e.writeTimesheet=function(e){o.go("tab.timesheet-write",{day:e})},e.scrollToFixScreen=function(){c?(l.scrollTo(0,400,!0),c=!1):(l.scrollTo(0,0,!0),c=!0)};var u=function(o){var t=o.timesheet,a=0;for(e.calendar=[],i=0;i<5;i++){var n={week:i,list:[]};for(j=0;j<7;j++){var l,r="each-day",s="day-item",c="",p="",u=!1;t[a]?(u="0"!=t[a].lockflag,"Empty"==t[a].status?(r="each-day",s="day-item"):"Draft"==t[a].status?(r="each-day attendance",s="day-item attendance"):"Approved"==t[a].status?(r="each-day approve",s="day-item approve"):"Rejected"==t[a].status&&(r="each-day reject",s="day-item reject"),l={day:t[a].day.replace("0",""),style_outline:r,style_color:s,money:t[a].allowance,project:t[a].proj,each_day:t[a].each_day,lockFlag:u}):l={day:"",style_outline:r,style_color:s,money:c,project:p,each_day:"",lockFlag:u},n.list.push(l),a+=1}e.calendar.push(n)}},d=function(o){p(),e.loadingDataFlag=!0;var a=t.businessPath+"/timesheet_process/fetch_calendar",n={params:{p_employee:window.localStorage.empno,p_month:o+"",p_offset:1}};s.post(a,n).success(function(o){u(o),e.loadingDataFlag=!1,t.debug&&console.log("result success "+angular.toJson(o))}).error(function(o,a){e.loadingDataFlag=!1,e.$apply(),t.debug&&console.log("response error "+angular.toJson(o))})};d("201511"),e.getTimeSheet=function(e){d(e)},e.goBack=function(){a.$ionicGoBack()},t.debug&&console.log("applicationCtrl.enter"),e.$on("$ionicView.enter",function(e){t.debug&&console.log("applicationCtrl.$ionicView.enter")}),e.$on("$destroy",function(e){t.debug&&console.log("applicationCtrl.$destroy")})}]).service("TimeSheetService",["baseConfig","hmsHttp","hmsPopup",function(e,o,t){this.fetchCalendar=function(){var t=e.businessPath+"/timesheet_process/fetch_calendar",a={params:{p_employee:window.localStorage.empno,p_month:"201511",p_offset:1}};o.post(t,a).success(function(o){e.debug&&console.log("result success "+angular.toJson(o))}).error(function(o,t){e.debug&&console.log("response error "+angular.toJson(o))})},this.fetchEachDay=function(a){var n=e.businessPath+"/timesheet_process/fetch_projects",l={params:{p_employee:window.localStorage.empno+"",p_date:"20151013"}};o.post(n,l).success(function(e){a(e)}).error(function(e,o){t.hideLoading(),t.showPopup("获取状态错误,请检查")})}}]),angular.module("myApp").config(["$stateProvider",function(e){e.state("tab.timesheet-write",{url:"/timesheet-write",params:{day:{}},views:{"tab-application":{templateUrl:"build/pages/application/timesheet/write/write.html",controller:"TimeSheetWriteCtrl"}}})}]),angular.module("applicationModule").controller("TimeSheetWriteCtrl",["$scope","$state","$stateParams","$ionicModal","$timeout","baseConfig","TimeSheetService","hmsPopup",function(e,o,t,a,n,l,i,r){var s="ion-ios-checkmark",c="ion-ios-circle-outline";e.projectList=[],e.addressList=[],e.flybackList=[],e.timesheetDetail={currentDay:"",approver:"",currentProject:{},currentAddress:{},currentFlyback:{},travelingAllowance:{flag:!1,style:c},normalAllowance:{flag:!1,style:c},charging:{flag:!1,style:c},description:""},l.debug&&console.log("$stateParams.day "+angular.toJson(t.day)),a.fromTemplateUrl("build/pages/application/timesheet/write/modal/projectModal.html",{scope:e}).then(function(o){e.projectModal=o}),a.fromTemplateUrl("build/pages/application/timesheet/write/modal/addressModal.html",{scope:e}).then(function(o){e.addressModal=o}),a.fromTemplateUrl("build/pages/application/timesheet/write/modal/flybackList.html",{scope:e}).then(function(o){e.flybackModal=o}),e.showProjectModal=function(){e.projectModal.show()},e.hideProjectModal=function(){e.projectModal.hide()},e.showFlybackModal=function(){e.flybackModal.show()},e.hideFlybackModal=function(){e.flybackModal.hide()},e.showAddressModal=function(){e.addressModal.show()},e.hideAddressModal=function(){e.addressModal.hide()};var p=function(o){if(r.hideLoading(),"S"==o.status){var t=o.project,a=o.flyback,n=o.projaddress;"1"===o.every_day.offbase?e.timesheetDetail.travelingAllowance={flag:!0,style:s}:e.timesheetDetail.travelingAllowance={flag:!1,style:c},"Y"===o.every_day.base?e.timesheetDetail.normalAllowance={flag:!0,style:s}:e.timesheetDetail.normalAllowance={flag:!1,style:c},"1"===o.every_day.externalcharge?e.timesheetDetail.charging={flag:!0,style:s}:e.timesheetDetail.charging={flag:!1,style:c},e.timesheetDetail.currentDay=o.every_day.every_day,e.timesheetDetail.approver=o.every_day.approver,e.timesheetDetail.description=o.every_day.descrpt,e.timesheetDetail.allowance=o.every_day.allowance,angular.forEach(t,function(o){return"Y"===o.selected_flag?void(e.timesheetDetail.currentProject=o):void 0}),angular.forEach(n,function(o){return"Y"===o.selected_flag?void(e.timesheetDetail.currentAddress=o):void 0}),angular.forEach(a,function(o){return"Y"===o.fly_select?void(e.timesheetDetail.currentFlyback=o):void 0}),e.projectList=t,e.addressList=n,e.flybackList=a}};e.checkBoxChanged=function(o,t){console.log("$scope.checkBoxChanged item "+angular.toJson(o)),o.flag?(o.flag=!1,o.style=c):(o.flag=!0,o.style=s),"travelingAllowance"==t&&e.timesheetDetail.travelingAllowance.flag&&(e.timesheetDetail.normalAllowance={flag:!1,style:c}),"normalAllowance"==t&&e.timesheetDetail.normalAllowance.flag&&(e.timesheetDetail.travelingAllowance={flag:!1,style:c})},e.submitTimesheet=function(e){l.debug&&console.log("timesheetDetail "+angular.toJson(e))},n(function(){r.showLoading("获取timesheet明细数据"),i.fetchEachDay(p)})}]);