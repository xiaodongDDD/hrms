<ion-view class="contract-detail workflow-detail">

  <ion-header-bar align-title="center" class="bar-stable" style="background:none">
    <div class="buttons">
      <button ng-style="filterBlurStyle(filterBlur)" ng-click="$ionicGoBack()" class="button button-icon icon ion-ios-arrow-back" style="padding:0px;">
        <span class="back-text">返回</span>
      </button>
    </div>
    <h1 ng-style="filterBlurStyle(filterBlur)" class="title">审批详情</h1>
    <div class="buttons">
      <button ng-style="filterBlurStyle(filterBlur)" class="button button-clear" ng-click="showProcDiv()">
        <i class="icon ion-more" style="color: white;font-size: 30px"></i>
      </button>
    </div>
  </ion-header-bar>

  <!--右上角-->
  <div class="contract-processes" ng-class="{true:'show'}[showProc]" ng-show="showProc">
    <div class="left-h-line"></div>
  </div>
  <ion-scroll class="contract-processes" ng-class="{true:'show'}[showProc]" ng-show="showProc">
    <!--<div>-->
      <div class="proc-item" ng-repeat="item in data.historyData track by $index">
        <div class="row item-row">
          <div class="hisMaker"></div>
          <div class="col col-20">
          </div>
          <div class="col col-80">
            <div class="row">
              <div class="col-xs-6" style="width:50%;">
                <label ng-if="item.processNode" style="font-size:13px; color:white;" ng-bind="item.processNode"></label>
              </div>
              <div class="col-xs-6" style="width:50%; white-space:normal;text-align:right;">
                <label ng-if="item.receveTime" style="font-size:11px; text-align:right; color:white;">{{item.receiveDate}}&nbsp;{{item.receiveTime}}</label>
              </div>
            </div>
            <div class="row">
              <div class="col-xs-9" style="width:75%; white-space:normal; display:inline;">
                <label ng-if="item.actor" style="font-size:12px; color:#f5a623;" ng-bind="item.actor"></label>
                <label ng-if="item.detail" style="font-size:12px; color:white;">：{{item.detail}}</label>
              </div>
              <div class="col-xs-3" style="position:relative;width:25%;">
                <img ng-if="item.userId && !isWxWebview" style="position:absolute;bottom:0px;right:0px;" height="18" width="18" src="build/img/tabs/contact-G@3x.png" ng-click="goToAuthorPage(item.userId)" />
              </div>
            </div>
          </div>
        </div>
      </div>
    <!--</div>-->
  </ion-scroll>
  <div class="proc-title" ng-show="showProc">审批历史记录</div>
  <div class="cover" ng-show="showCover" ng-class="{true:'show'}[showCover]" ng-click="closeCover()">
    <div class="cover-header"><span class="cover-close" ng-click="closeCover()"><i class="icon ion-android-close"></i></span></div>
  </div>

  <!--<div class="background"></div>-->

  <ion-content ng-style="filterBlurStyle(filterBlur)" delegate-handle="workflowDetailHandle">
    <div class="loading" ng-if="fetchDataFlag">
      <div class="hms-hide-content">
        <hms-loading></hms-loading>
      </div>
    </div>

    <!--横向流程-->
    <div class="stages-container">
      <ion-scroll direction="x" scrollbar-x="false" overflow-scroll="false" ng-style="workflowDetailScroll">
        <div class="contract-stages">
          <div class="stages-item" ng-repeat="stagesItem in data.stages track by $index">
            <div class="stages-time">
              {{stagesItem.stage}}
            </div>
            <div class="stages-main">
              <div class="stages-line" ng-class="{'highlight':isHighlight(stagesItem),'stages-line-first':isFirst($index),'stages-line-last':isLast($index)}"></div>
              <span ng-class="{'stages-point-normal':!isHighlight(stagesItem),'stages-point-highlight':isHighlight(stagesItem)}">
                <i ng-class="{true:'currentStage'}[stagesItem.currentStage]" class="icon ion-android-star-outline" ng-if="stagesItem.currentStage"></i>
                <label style="line-height:25px;">{{stagesItem.currentStage ? '' : $index}}</label>
              </span>
            </div>
          </div>
        </div>
      </ion-scroll>
    </div>

    <div class="hms-workflow-array" ng-show="data.processInfo.detail_title" style="margin-left:5%; margin-right:5%; margin:top:10px;">
      <div class="hms-singal-array-header">
        <div class="hms-singal-array-name">
          <i class="ion-record"></i>{{data.processInfo.detail_title}}
        </div>
        <div class="hms-singal-array-operation ion-ios-minus-outline" ng-click="hideProcess($event)" ng-if="showProcessFlag">
        </div>
        <div class="hms-singal-array-operation ion-ios-plus-outline" ng-click="showProcess($event)" ng-if="!showProcessFlag">
        </div>
      </div>
      <div class="hms-singal-array-content" ng-if="showProcessFlag">
        <div class="hms-singal-array-line" ng-repeat="arrayItem in data.processInfo.detail">
          <div class="hms-singal-array-key" ng-bind="arrayItem.item_name">
          </div>
          <div class="hms-singal-array-value" ng-bind="arrayItem.item_value">
          </div>
        </div>
      </div>
    </div>
    <div class="hms-workflow-array" ng-repeat="array in data.contractInfo.lines" style="margin-left:5%; margin-right:5%; margin:top:10px;">
      <div class="hms-singal-array-header">
        <div class="hms-singal-array-name">
          <i class="ion-record"></i>{{array.line_big_title}}
        </div>
        <div class="hms-singal-array-operation ion-ios-plus-outline" ng-click="showContract($event)" ng-if="!showContractFlag">
        </div>
        <div class="hms-singal-array-operation ion-ios-minus-outline" ng-click="hideContract($event)" ng-if="showContractFlag">
        </div>
        <div class="hms-multiple-array-sub-header" ng-if="showContractFlag">
          <div class="hms-singal-array-link">
            <a class="hms-array-selector">共{{array.line.length}}条</a>
            <a class="hms-array-selector" ng-click="toLast()"
                ng-class="{true:'no-activated'}[nowContractInfoNum == 0]">上一条</a>
            <a class="hms-array-selector" ng-click="toNext()"
                ng-class="{true:'no-activated'}[noNextDataFlag]">下一条</a>
            <a class="hms-array-selector" ng-click="showEssenceDiv()">查看合同要素</a>
          </div>
          
        </div>
      </div>
      <div class="hms-singal-array-content" ng-if="showContractFlag">
        <div class="hms-singal-array-line" ng-repeat="arrayItem in array.line_title" ng-if="arrayItem.line_title != '合同编号'">
          <div class="hms-singal-array-key" ng-bind="arrayItem.line_title">
          </div>
          <div class="hms-singal-array-value" ng-bind="nowContractInfo[$index].line_value">
          </div>
        </div>
      </div>
    </div>

    <!--scroll bug on iOS-->
    <!--<div class="info" ng-show="data.processInfo.detail_title">
      <div class="info-title">{{data.processInfo.detail_title}}：</div>
      <div class="icon-div" ng-click="hideProcess()" ng-show="showProcessFlag">
        <i class="icon ion-ios-minus-outline icon-title"></i>
      </div>
      <div class="icon-div" ng-click="showProcess()" ng-hide="showProcessFlag">
        <i class="icon ion-ios-plus-outline icon-title"></i>
      </div>
      <div class="info-item" ng-repeat="item in data.processInfo.detail" ng-show="showProcessFlag">
        <span class="info-item-title">{{item.item_name}}</span>
      </div>
    </div>
    <div class="info" ng-repeat="line in data.contractInfo.lines">
      <div class="info-title info-operate">{{line.line_big_title}}</div>
      <div class="icon-div" ng-show="showContractFlag" ng-click="hideContract()">
        <i class="icon ion-ios-minus-outline icon-title"></i>
      </div>
      <div class="icon-div" ng-hide="showContractFlag" ng-click="showContract()">
        <i class="icon ion-ios-plus-outline icon-title"></i>
      </div>
      <div class="item-operate">
        共{{line.line.length}}条&nbsp;&nbsp;
        <span ng-class="{0:'no-data'}[nowContractInfoNum]" ng-click="toLast()">上一条</span>&nbsp;&nbsp;
        <span ng-class="{true:'no-data'}[noNextDataFlag]" ng-click="toNext()">下一条</span>&nbsp;&nbsp;
        <span ng-click="showEssenceDiv()">查看合同要素</span>
      </div>
      <div class="info-item" ng-repeat="line_title in line.line_title" ng-show="showContractFlag" ng-if="line_title.line_title != '存储编号'">
        <span class="info-item-title">{{line_title.line_title}}</span>
        <span class="info-item-content">{{nowContractInfo[$index].line_value}}</span>
      </div>
    </div>-->

    <div class="operate-div" ng-show="showOperateButton">
      <input class="message" type="text" placeholder="请输入意见" ng-model="submitMessage.text" />
      <div class="transpond" ng-click="showTransDiv()">
        <span class="transpond-title">转交人</span>
        <span class="transpond-content">{{transpondId}}&nbsp;&nbsp;{{transpondName}}</span>
        <span class="transpind-more"><i class="icon ion-chevron-right"></i></span>
      </div>
    </div>

    <button class="operate-button" ng-click="showOperate()" ng-show="showOperateButton">操作</button>

  </ion-content>

  <div class="trans-search" ng-class="{'show':showTransFlag[2],'transHide':showTransFlag[1],'':showTransFlag[0]}">
    <div class="ios-header" ng-if="showIosHeader"></div>
    <div class="trans-header">
      <input class="search-input" type="text" placeholder="搜索" ng-model="searchKey" ng-change="shiftTranspond()" /><i class="iconn ion-android-search"></i>
      <button class="search-button" ng-click="showTransDiv()">取消</button>
    </div>
    <div class="trans-content">
      <div class="hms-hide-content" ng-if="fetchTranspondData">
        <hms-loading></hms-loading>
      </div>
      <div class="trans-item" ng-repeat="transpond in transponds" ng-click="selectTranspond(transpond.name,transpond.id)">
        <span class="trans-name">{{transpond.name}}</span>
        <span class="trans-id">{{transpond.id}}</span>
      </div>
    </div>
  </div>

  <div class="desc-div" ng-show="showEssence" ng-class="{true:'show'}[showEssence]">
    <div class="desc-title">合同要素</div>
    <div class="row desc-item" ng-repeat="item in essenceData[nowContractInfoNum].essences">
      <div class="col desc-key">{{item.eName}}</div>
      <div class="col desc-value">{{item.eValue}}</div>
    </div>
  </div>

</ion-view>