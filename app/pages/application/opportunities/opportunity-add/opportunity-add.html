<ion-modal-view style="width: 100vw;background: none;" class="crm hrms-pancel-corlor opportunity-add"
                ng-controller="OpportunityAddCtrl">
  <ion-header-bar align-title="center" class="bar-stable">
    <button class="button button-clear" ng-click="goBack()">{{ 'CANCEL' | T }}</button>
    <h2 class="title">
      {{editFlag ? ("NEW_OPPORTUNITY.EDIT_OPPORTUNITY" | T) : ("NEW_OPPORTUNITY.ADD_OPPORTUNITY" | T) }}
    </h2>
    <button class="button button-clear" ng-click="addOpportunity()">{{ 'SAVE' | T }}</button>
  </ion-header-bar>
  <crm-loading ng-if="showCrmLoading"></crm-loading>
  <ion-content delegate-handle="slide-img">

    <div class="common-input-area">
      <div class="common-input-area-title" ng-click="hideArea(4)">
        <img src="build/img/application/opportunity/opportunity-add/icon_custom_small@3x.png"/>
        {{ 'NEW_OPPORTUNITY.CUSTOMER_INFO' | T }}
        <div>{{hideAreaFlag[4] ? ("SHOW" | T) : ("HIDE" | T) }}</div>
      </div>
      <div ng-if="!hideAreaFlag[4]">
        <hms-select-item
          label-name="titleList.customer"
          input-box="showData.customerName"
          important="true"
          hms-select="showSelectDiv('customer')">
        </hms-select-item>
        <hms-select-item
          ng-if="!editFlag || editCustomerFlag"
          label-name="titleList.incomeScale"
          input-box="showData.incomeScale"
          important="true"
          hms-select="showSelectDiv('income_scale')">
        </hms-select-item>
        <hms-select-item
          ng-if="!editFlag || editCustomerFlag"
          label-name="titleList.isListed"
          input-box="showData.isListed"
          important="true"
          hms-select="showSelectDiv('is_listed')">
        </hms-select-item>
        <hms-select-item
          ng-if="!editFlag || editCustomerFlag"
          label-name="titleList.ownedIndustry"
          input-box="showData.cusIndustry"
          important="true"
          hms-select="showIndustrySelect('customer')"
          show-line="true">
        </hms-select-item>
      </div>
    </div>

    <div class="common-input-area">
      <div class="common-input-area-title" ng-click="hideArea(0)">
        <img src="build/img/application/opportunity/opportunity-add/icon_base_message@3x.png"/>
        {{ 'NEW_OPPORTUNITY.BASE_INFO' | T }}
        <div>{{hideAreaFlag[0] ? ("SHOW" | T) : ("HIDE" | T) }}</div>
      </div>
      <div ng-if="!hideAreaFlag[0]">

        <div class="common-item-input">
          <div class="required" ng-class="{false:'input-error'}[validNameFlag]">{{ 'NEW_OPPORTUNITY.OPPORTUNITY_NAME' |
            T }}{{validNameFlag ? '' : ' (重复!)'}}
          </div>
          <input type="text" placeholder="{{ 'PLEASE_INPUT' | T }}" ng-model="data.fullName" ng-blur="validName()"/>
          <div class="common-light-line-long"></div>
        </div>

        <hms-select-item
          label-name="titleList.opportunityStatus"
          input-box="showData.opportunityStatus"
          important="true"
          hms-select="showSelectDiv('opportunity_status')">
        </hms-select-item>
        <hms-select-item
          ng-if="showWinCompanyFlag"
          label-name="titleList.winningCompetitor"
          input-box="showData.winningCompetitor"
          important="true"
          hms-select="showSelectDiv('winning_competitor')">
        </hms-select-item>
        <hms-select-item
          label-name="titleList.customerContacts"
          input-box="showData.customerContactsName"
          important="true"
          hms-select="showSelectDiv('customer_contacts')">
        </hms-select-item>
        <hms-select-item
          label-name="titleList.ownedIndustry"
          input-box="showData.industry"
          important="true"
          hms-select="showIndustrySelect('opportunity')">
        </hms-select-item>
        <hms-select-item
          label-name="titleList.businessFrom"
          input-box="showData.businessFrom"
          important="true"
          hms-select="showSelectDiv('business_from')">
        </hms-select-item>
        <hms-select-item
          ng-show="isOrigin"
          label-name="titleList.originalFactoryFrom"
          input-box="showData.originalFactoryFrom"
          important="true"
          hms-select="showSelectDiv('business_from_source')">
        </hms-select-item>
        <hms-select-item
          label-name="titleList.theCompany"
          input-box="showData.theCompany"
          important="true"
          hms-select="showSelectDiv('company')">
        </hms-select-item>
        <hms-select-item
          label-name="titleList.theYear"
          input-box="data.theYear"
          important="true"
          hms-select="showSelectDiv('year')">
        </hms-select-item>
        <hms-select-item
          label-name="titleList.prjBeginDate"
          input-box="data.prjBeginDate"
          important="true"
          hms-select="selectDate('startDate')"
          img-url="build/img/application/opportunity/icon_day.png">
        </hms-select-item>
        <hms-select-item
          label-name="titleList.preSignDate"
          input-box="data.preSignDate"
          important="true"
          hms-select="selectDate('signDate')"
          show-line="true"
          img-url="build/img/application/opportunity/icon_day.png">
        </hms-select-item>
      </div>

    </div>

    <div class="common-input-area">
      <div class="common-input-area-title" ng-click="hideArea(1)">
        <img src="build/img/application/opportunity/opportunity-add/icon_pk_blue@3x.png"/>
        {{ 'NEW_OPPORTUNITY.COMPETITORS' | T }}
        <div>{{hideAreaFlag[1] ? ("SHOW" | T) : ("HIDE" | T) }}</div>
      </div>
      <div ng-if="!hideAreaFlag[1]">
        <div ng-repeat="competitor in competitors">
          <div class="common-input-area-subtitle has-bottom-border text-black" ng-class="{true:'has-top-border'}[$index > 0]">
            {{competitor.fullName}}
            <img src="build/img/application/opportunity/opportunity-add/icon_delete@3x.png"
                 ng-click="removeCompetitor($index)"/>
          </div>
          <div>
            <hms-input-item
              label-name="titleList.productName"
              input-box="competitor.productName">
            </hms-input-item>
            <hms-input-item
              label-name="titleList.advantage"
              input-box="competitor.advantage">
            </hms-input-item>
            <hms-input-item
              label-name="titleList.otherDescription"
              input-box="competitor.description">
            </hms-input-item>
          </div>
        </div>

        <div class="common-input-area-subtitle" ng-class="{true:'has-top-border'}[competitors.length > 0]"
             ng-click="showAddCompetitor(true)">
          {{ 'NEW_OPPORTUNITY.ADD_COMPETITORS' | T }}
          <img src="build/img/application/opportunity/opportunity-add/icon_addmore@3x.png"/>
        </div>
      </div>

    </div>

    <div class="common-input-area">
      <div class="common-input-area-title" ng-click="hideArea(2)">
        <img src="build/img/application/opportunity/opportunity-add/icon_team@3x.png"/>
        {{ 'NEW_OPPORTUNITY.BELONG' | T }}
        <div>{{hideAreaFlag[2] ? ("SHOW" | T) : ("HIDE" | T) }}</div>
      </div>
      <div ng-if="!hideAreaFlag[2]">
        <hms-select-item
          label-name="titleList.saleBelong"
          input-box="showData.saleBelong"
          important="true"
          hms-select="showSaleSelect()"
          show-line="true">
        </hms-select-item>
      </div>
    </div>

    <div class="common-input-area">
      <div class="common-input-area-title" ng-click="hideArea(3)">
        <img src="build/img/application/opportunity/opportunity-add/icon_other@3x.png"/>
        {{ 'OTHER' | T }}
        <div>{{hideAreaFlag[3] ? ("SHOW" | T) : ("HIDE" | T) }}</div>
      </div>
      <div ng-if="!hideAreaFlag[3]">
        <hms-input-item
          label-name="titleList.description"
          input-box="data.description"
          show-bottom-line="true">
        </hms-input-item>
      </div>
    </div>

    <div class="common-input-area">
      <div class="common-input-area-title" ng-click="hideArea(5)">
        <img src="build/img/application/opportunity/opportunity-add/icon_phonecall@3x.png"/>
        {{ 'NEW_OPPORTUNITY.ADVANCE_INFORMATION' | T }}
        <div>{{hideAreaFlag[5] ? ("SHOW" | T) : ("HIDE" | T) }}</div>
      </div>
      <div ng-if="!hideAreaFlag[5]">
        <hms-select-item
          label-name="titleList.saleStage"
          input-box="showData.saleStage"
          important="true"
          hms-select="showSelectDiv('opportunity_sale_stage')">
        </hms-select-item>
        <hms-select-item
          label-name="titleList.preSaleEmployee"
          input-box="showData.preSaleEmployee"
          important="true"
          hms-select="showSelectDiv('sale_employee')">
        </hms-select-item>
        <hms-select-item
          label-name="titleList.chargingMode"
          input-box="showData.chargingMode"
          important="true"
          hms-select="showSelectDiv('charging_mode')">
        </hms-select-item>
        <hms-select-item
          label-name="titleList.currency"
          input-box="showData.currency"
          important="true"
          hms-select="showSelectDiv('currency')">
        </hms-select-item>

        <div class="common-item-input">
          <div class="required">{{ 'NEW_OPPORTUNITY.ANTICIPATED_REVENUE' | T }}</div>
          <input type="tel" placeholder="{{ 'PLEASE_INPUT' | T }}" ng-model="data.preMoney"/>
        </div>

        <!--<div class="pre-money-div-outer">-->
          <!--<div class="pre-money-div">-->
            <!--<span>{{ 'NEW_OPPORTUNITY.ANTICIPATED_REVENUE' | T }}</span><b>￥</b>{{data.preMoney}}-->
          <!--</div>-->
          <!--<p>{{ 'NEW_OPPORTUNITY.ADVANCE_DESCRIPTION' | T }}</p>-->
        <!--</div>-->

      </div>
    </div>

    <div class="common-input-area">
      <div class="common-input-area-title" ng-click="hideArea(6)">
        <img src="build/img/application/opportunity/opportunity-add/icon_link_small@3x.png"/>
        {{ 'NEW_OPPORTUNITY.ADVANCE_ESTIMATE' | T }}
        <div>{{hideAreaFlag[6] ? ("SHOW" | T) : ("HIDE" | T) }}</div>
      </div>
      <div ng-if="!hideAreaFlag[6]">
        <div ng-repeat="estimate in estimates" ng-click="editEstimate($index)">
          <div class="common-input-area-subtitle has-bottom-border has-shadow"
               ng-class="{true:'has-top-border'}[$index > 0]">
            No.{{($index + 1) + " " + estimate.unitName}}
            <img src="build/img/application/opportunity/opportunity-add/icon_delete@3x.png"
                 ng-click="removeEstimate($index)"/>
          </div>
          <div>
            <div class="estimate-product">
              <div class="product-info">
                <div class="product-info-content">{{estimate.productTypeName}}</div>
                <div class="product-info-title">{{ 'NEW_OPPORTUNITY.PRODUCT_TYPE' | T }}</div>
              </div>
              <div class="product-info">
                <div class="product-info-content">{{estimate.productName}}</div>
                <div class="product-info-title">{{ 'NEW_OPPORTUNITY.ESTIMATE_PRODUCT' | T }}</div>
              </div>
              <div class="product-info">
                <div class="product-info-content">{{estimate.level2ProductName}}</div>
                <div class="product-info-title">{{ 'NEW_OPPORTUNITY.ESTIMATE_SUB_PRODUCT' | T }}</div>
              </div>
            </div>
            <div class="estimate-cost">
              <div class="number">
                <div>{{estimate.manday}}</div>
                <div>{{ 'NEW_OPPORTUNITY.MAN_DAY' | T }}</div>
              </div>
              <div class="sign bigger">*</div>
              <div class="number">
                <div>{{estimate.unitPrice}}</div>
                <div>{{ 'NEW_OPPORTUNITY.PRICE' | T }} ({{showData.currency}})</div>
              </div>
              <div class="sign">=</div>
              <div class="number">
                <div>{{estimate.manday * estimate.unitPrice}}</div>
                <div>{{ 'NEW_OPPORTUNITY.TOTAL' | T }} ({{showData.currency}})</div>
              </div>
            </div>
          </div>
        </div>

        <div class="common-input-area-subtitle" ng-class="{true:'has-top-border'}[estimates.length > 0]"
             ng-click="showAddEstimate(true,$event)">
          {{ 'NEW_OPPORTUNITY.ADD_ESTIMATE' | T }}
          <img src="build/img/application/opportunity/opportunity-add/icon_addmore@3x.png"/>
        </div>
      </div>
    </div>

    <div class="common-input-area">
      <div class="common-input-area-title" ng-click="hideArea(7)">
        <img src="build/img/application/opportunity/opportunity-add/icon_business2@3x.png"/>
        {{ 'NEW_OPPORTUNITY.RISK' | T }}
        <div>{{hideAreaFlag[7] ? ("SHOW" | T) : ("HIDE" | T) }}</div>
      </div>
      <div ng-if="!hideAreaFlag[7]">
        <hms-input-item
          label-name="titleList.prjRisk"
          input-box="data.prjRisk"
          last-line="true">
        </hms-input-item>
      </div>
    </div>

  </ion-content>

  <!--所属选择区域-->
  <div class="common-fix-div" ng-class="{true:'showUp'}[showSaleSelectFlag]">
    <div class="common-fix-div-header">
      <img src="build/img/application/customer/detail/top_left_arrow@3x.png" ng-click="saleBack()"/>
      请选择
    </div>
    <div class="sifting-area">
      <img src="build/img/application/opportunity/icon_top_search@3x.png">
      <input type="text" placeholder="搜索..."/>
    </div>
    <div class="value-list-header">
      {{showSaleTeam ? showData.saleArea : '所属区域'}}
    </div>
    <div class="list list-has-header">
      <ion-scroll direction="y" has-bouncing="true" scrollbar-y="false" delegate-handle="saleScroll">
        <div class="list-item" ng-repeat="saleArea in saleAreas" ng-click="selectArea(saleArea)" ng-hide="showSaleTeam">
          {{saleArea.saleAreaName}}
          <img src="build/img/application/opportunity/right_arrow@3x.png"/>
        </div>
        <div class="list-item" ng-repeat="saleTeam in saleTeams" ng-click="selectTeam(saleTeam)" ng-show="showSaleTeam">
          {{saleTeam.saleTeamName}}
        </div>
      </ion-scroll>
    </div>
  </div>

  <!--所属行业选择-->
  <div class="common-fix-div" ng-class="{true:'showUp'}[showIndustrySelectFlag]">
    <div class="common-fix-div-header">
      <img src="build/img/application/customer/detail/top_left_arrow@3x.png" ng-click="industryBack()"/>
      请选择
    </div>
    <div class="sifting-area">
      <img src="build/img/application/opportunity/icon_top_search@3x.png">
      <input type="text" placeholder="搜索..."/>
    </div>
    <div class="value-list-header">
      {{showSubIndustry ? showData.majorIndustry : '主行业'}}
    </div>
    <div class="list list-has-header">
      <ion-scroll direction="y" has-bouncing="true" scrollbar-y="false" delegate-handle="industryScroll">
        <div class="list-item" ng-repeat="industry in majorIndustrys" ng-click="selectMajor(industry)" ng-hide="showSubIndustry">
          {{industry.industryName}}
          <img src="build/img/application/opportunity/right_arrow@3x.png"/>
        </div>
        <div class="list-item" ng-repeat="industry in subIndustrys" ng-click="selectSub(industry)" ng-show="showSubIndustry">{{industry.industryName}}</div>
      </ion-scroll>
    </div>
  </div>

</ion-modal-view>
